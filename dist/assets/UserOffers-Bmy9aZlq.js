import{j as e,e8 as t,r,h as s,l as a,q as n,e7 as o,w as l,c as d,a as c,o as i,S as u,Q as m,cQ as x}from"./index-CvIXhaMv.js";const p=e=>Number(e||0).toLocaleString("en-NG",{style:"currency",currency:"NGN",maximumFractionDigits:0});function f({offer:r,onClick:s}){var a;const n=(null==(a=r.updatedAt)?void 0:a.toDate)?r.updatedAt.toDate():null;return e.jsxs("div",{className:"flex items-center p-3 border-b hover:bg-gray-50 cursor-pointer",onClick:s,children:[e.jsx("img",{src:r.productCover||"/placeholder.png",alt:"product",className:"w-14 h-14 rounded-lg object-cover mr-3 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-opensans font-semibold text-gray-900 truncate",children:r.productName||"Item"}),e.jsxs("div",{className:"text-sm font-opensans text-gray-700 mt-0.5 flex items-center gap-2",children:[e.jsx("span",{className:"line-through text-gray-400",children:p(r.listPrice)}),e.jsx("span",{className:"font-semibold",children:p(r.amount)}),"countered"===r.status&&r.counterAmount?e.jsxs(e.Fragment,{children:[e.jsx(t,{className:"text-blue-500"}),e.jsx("span",{className:"font-semibold",children:p(r.counterAmount)})]}):null]}),e.jsx("div",{className:"text-xs text-gray-500 font-opensans mt-0.5 truncate",children:r.vendorShopName||"Vendor"})]}),e.jsxs("div",{className:"ml-3 text-right",children:[e.jsx("div",{className:"inline-block text-[11px] px-2 py-0.5 rounded-full font-opensans "+("accepted"===r.status?"bg-green-100 text-green-800":"declined"===r.status?"bg-red-100 text-red-800":"countered"===r.status?"bg-blue-100 text-blue-800":"bg-gray-100 text-gray-700"),children:r.status}),e.jsx("div",{className:"text-[11px] text-gray-400 font-opensans mt-1",children:n?n.toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):""}),!r.buyerRead&&e.jsx("span",{className:"inline-block w-2.5 h-2.5 bg-customOrange rounded-full mt-1 ml-auto"})]})]})}function h(){const[t,p]=r.useState([]),[h,g]=r.useState(""),[v,b]=r.useState((()=>{const e=localStorage.getItem("userOffersTab");return e&&["action","pending","accepted","declined"].includes(e)?e:"action"})),y=s();r.useEffect((()=>{localStorage.setItem("userOffersTab",v)}),[v]),r.useEffect((()=>{const e=a.currentUser;if(!e)return void y("/login");const t=n(d(c,"offers"),l("buyerId","==",e.uid),o("createdAt","desc")),r=i(t,(e=>{const t=e.docs.map((e=>({id:e.id,...e.data()})));p(t)}));return()=>r()}),[y]);const N=r.useMemo((()=>{var e,r,s,a,n;const o=new Map;for(const d of t){const t=`${d.vendorId||"v"}__${d.productId||"p"}`,l=o.get(t);if(l){const t=(null==(s=null==(r=null==(e=l.latest)?void 0:e.createdAt)?void 0:r.toMillis)?void 0:s.call(r))??0;((null==(n=null==(a=null==d?void 0:d.createdAt)?void 0:a.toMillis)?void 0:n.call(a))??0)>t&&(l.latest=d),d.buyerRead||(l.unread+=1)}else o.set(t,{threadKey:t,vendorId:d.vendorId,productId:d.productId,productName:d.productName,productCover:d.productCover,vendorShopName:d.vendorShopName,unread:d.buyerRead?0:1,latest:d})}const l=h.trim().toLowerCase();return Array.from(o.values()).filter((e=>{var t;if(!l)return!0;const r=(e.productName||"").toLowerCase(),s=(e.vendorShopName||"").toLowerCase(),a=(null==(t=e.latest)?void 0:t.amount)?`i want to get this item for ₦${e.latest.amount}`.toLowerCase():"";return r.includes(l)||s.includes(l)||a.includes(l)})).sort(((e,t)=>{var r,s,a,n,o,l;return((null==(a=null==(s=null==(r=t.latest)?void 0:r.createdAt)?void 0:s.toMillis)?void 0:a.call(s))??0)-((null==(l=null==(o=null==(n=e.latest)?void 0:n.createdAt)?void 0:o.toMillis)?void 0:l.call(o))??0)}))}),[t,h]),j=r.useMemo((()=>{if(!N.length)return[];return N.filter((e=>{var t;const r=(e=>{var t;return(null==(t=null==e?void 0:e.toLowerCase)?void 0:t.call(e))||""})(null==(t=e.latest)?void 0:t.status);return"action"===v?"countered"===r:"pending"===v?"pending"===r:"accepted"===v?"accepted"===r:"declined"!==v||"declined"===r}))}),[N,v]);return e.jsxs(e.Fragment,{children:[e.jsx(u,{title:"My Offers – My Thrift",description:"Track your offers and vendor responses.",url:"https://www.shopmythrift.store/offers"}),e.jsxs("div",{className:"max-w-xl mx-auto h-[100dvh] flex flex-col bg-white",children:[e.jsx("header",{className:"p-4 border-b",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("button",{onClick:()=>y("/profile"),"aria-label":"Go back",className:"p-1 -ml-1 rounded-full hover:bg-gray-100 active:scale-95 transition",children:e.jsx(m,{className:"text-2xl text-gray-700"})}),e.jsx("h1",{className:"text-xl font-ubuntu font-medium text-gray-900",children:"My Offers"})]})}),e.jsx("div",{className:"px-4 py-2 border-b",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{className:"w-full border border-gray-200 rounded-full px-4 py-2 pr-10 text-base font-opensans focus:outline-none focus:ring-2 focus:ring-customOrange",placeholder:"Search product or vendor…",value:h,onChange:e=>g(e.target.value)}),e.jsx(x,{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500"})]})}),e.jsx("div",{className:"px-4 py-2",children:e.jsx("div",{className:"inline-flex gap-2",children:[["pending","Pending"],["accepted","Accepted"],["action","Countered"],["declined","Declined"]].map((([t,r])=>e.jsx("button",{onClick:()=>b(t),className:"px-4 py-1 rounded-full text-xs font-opensans "+(v===t?"bg-customOrange text-white":"border border-gray-300 text-gray-700 hover:bg-gray-50"),children:r},t)))})}),e.jsx("div",{className:"flex-1 overflow-auto",children:0===j.length?e.jsx("div",{className:"h-full flex items-center justify-center text-sm text-gray-500 font-opensans px-6 text-center",children:"Nothing here yet."}):j.map((t=>e.jsx(f,{offer:t.latest,unreadCount:t.unread,onClick:()=>y(`/offers/thread?type=offerThread&vendorId=${t.vendorId}&productId=${t.productId}`)},t.threadKey)))})]})]})}export{h as default};
