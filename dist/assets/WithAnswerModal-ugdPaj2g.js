import{h as e,r as s,d as t,a,ac as n,j as r,M as l,b as o,eL as i,$ as c,y as d,_ as u,s as m,ay as x,c as f,q as h,w as p,o as g}from"./index-CvIXhaMv.js";l.setAppElement("#root");const b=({isOpen:x,onClose:f,inquiryId:h,inquiryData:p})=>{const g=e(),[b,j]=s.useState(!1),[y,w]=s.useState(""),[N,v]=s.useState(""),[C,k]=s.useState(!1),[O,S]=s.useState(!1),[R,q]=s.useState(""),[I,H]=s.useState(null),[P,z]=s.useState("");if(!p)return null;if("closed"!==p.status||p.customerHasRead)return null;const{vendorReply:E,productId:A,productName:L,vendorId:T,question:D}=p;s.useEffect((()=>{if(!A)return;x&&(async()=>{try{const e=t(a,"products",A),s=await d(e);if(s.exists()){const e=s.data();q(e.coverImageUrl||""),H(e.price??null)}}catch(e){}})()}),[x,A]),s.useEffect((()=>{if(!T)return;x&&(async()=>{try{const e=t(a,"vendors",T),s=await d(e);if(s.exists()){const e=s.data();z(e.shopName||"The vendor")}}catch(e){}})()}),[x,T]);const F=s.useCallback((async()=>{if(h)try{const e=t(a,"inquiries",h);await n(e,{customerHasRead:!0})}catch(e){}}),[h]),U=async()=>{await F(),f()},W=()=>{j(!1),w(""),v("")},$=async()=>{await F(),S(!1),f()};return r.jsxs(r.Fragment,{children:[r.jsx(l,{isOpen:x,onRequestClose:U,contentLabel:"Your Question Has Been Answered",style:{content:{position:"absolute",bottom:0,left:0,right:0,top:"auto",borderRadius:"20px 20px 0 0",padding:"20px",backgroundColor:"#ffffff",border:"none",height:"79%",animation:"slide-up 0.3s ease-in-out",overflow:"hidden"},overlay:{backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"flex-end",justifyContent:"center",zIndex:3e3}},children:r.jsxs("div",{className:"flex flex-col h-full",children:[r.jsxs("div",{className:"mb-4 w-full flex items-center justify-between",children:[r.jsxs("h2",{className:"font-opensans text-lg font-semibold text-gray-800",children:[P," has replied to your question"]}),r.jsx(o,{className:"text-black text-xl cursor-pointer",onClick:U})]}),R?r.jsx("img",{src:R,alt:L,className:"w-full h-40 object-cover rounded-md mb-2"}):r.jsx("div",{className:"w-full h-40 bg-gray-200 rounded-md mb-2"}),r.jsxs("div",{className:"mb-4",children:[r.jsx("p",{className:"font-opensans text-lg font-medium text-gray-800",children:L}),null!=I&&r.jsxs("p",{className:"text-base font-opensans text-gray-600",children:["₦",I.toLocaleString()]})]}),r.jsxs("div",{className:"flex-1 shadow-md  overflow-y-auto px-2 mb-4 hide-scrollbar",children:[r.jsx("div",{className:"flex mb-3",children:r.jsx("div",{className:"bg-gray-100 text-gray-800 rounded-lg px-4 py-3 max-w-[80%]",children:r.jsx("p",{className:"text-sm font-opensans",children:D})})}),r.jsx("div",{className:"flex justify-end mb-3",children:r.jsx("div",{className:"bg-customOrange text-white rounded-lg px-4 py-3 max-w-[80%]",children:r.jsx("p",{className:"text-sm font-opensans",children:E})})})]}),r.jsxs("div",{className:"flex flex-col gap-3 px-2 pb-4",children:[r.jsx("button",{onClick:async()=>{await F(),f(),g(`/product/${A}`)},className:"px-6 h-12 w-full text-sm font-opensans bg-customOrange text-white font-medium rounded-full",children:"View Product"}),r.jsx("button",{onClick:()=>{j(!0)},className:"px-6 h-12 w-full text-sm font-opensans bg-transparent border border-gray-400 text-gray-700 font-medium rounded-full",children:"Report Chat"})]})]})}),b&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[3500] flex items-center justify-center",onClick:W,children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-md mx-4 p-4",onClick:e=>e.stopPropagation(),children:[r.jsxs("div",{className:"flex items-center justify-between mb-4",children:[r.jsxs("div",{className:"flex items-center space-x-2",children:[r.jsx("div",{className:"w-7 h-7 bg-orange-100 flex justify-center items-center rounded-full",children:r.jsx(i,{className:"text-customOrange"})}),r.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Report Chat"})]}),r.jsx(o,{className:"text-black text-xl cursor-pointer",onClick:W})]}),r.jsxs("div",{className:"space-y-3 mb-4",children:[["Harassment","Spam","Inappropriate language","Other"].map((e=>r.jsxs("div",{className:"flex items-center cursor-pointer",onClick:()=>{w(e),"Other"!==e&&v("")},children:[r.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex justify-center items-center mr-3 "+(y===e?"border-customOrange":"border-gray-300"),children:y===e&&r.jsx("div",{className:"w-3 h-3 rounded-full bg-customOrange"})}),r.jsx("span",{className:"font-opensans text-gray-800",children:e})]},e))),"Other"===y&&r.jsx("textarea",{rows:3,className:"border w-full rounded font-opensans p-2 text-sm mt-2 resize-none",placeholder:"Tell us what's wrong…",value:N,onChange:e=>v(e.target.value)})]}),r.jsx("div",{className:"flex justify-end",children:r.jsx("button",{disabled:C||!y||"Other"===y&&!N.trim(),className:"bg-customOrange text-white px-10 py-2 rounded-full disabled:opacity-40 flex items-center",onClick:async()=>{if(!y||"Other"===y&&!N.trim())return void u.error("Please select or enter a reason.");k(!0);const e="Other"===y?N.trim():y;try{const s=t(a,"inquiries",h);await n(s,{customerReported:!0,customerReportReason:e,customerReportedAt:m()}),k(!1),j(!1),S(!0)}catch(s){u.error("Could not submit report. Please try again."),k(!1)}},children:C?r.jsx(c,{height:18,width:18,strokeWidth:4,color:"#fff"}):"Send"})})]})}),O&&r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-[4000] flex items-center justify-center",onClick:$,children:r.jsxs("div",{className:"bg-white rounded-lg shadow-lg w-full max-w-sm mx-4 p-6 text-center",onClick:e=>e.stopPropagation(),children:[r.jsx(i,{className:"mx-auto text-4xl text-customOrange mb-4"}),r.jsx("p",{className:"font-opensans text-sm mb-6",children:"Thanks for letting us know. We’re reviewing this chat and will keep you updated."}),r.jsx("button",{onClick:$,className:"mt-2 font-opensans bg-customOrange text-white px-6 py-2 rounded-full",children:"Close"})]})})]})},j=({children:e})=>{const{currentUser:t}=x(),[n,l]=s.useState(!1),[o,i]=s.useState(null),[c,d]=s.useState(null);s.useEffect((()=>{if(!t)return;const e=f(a,"inquiries"),s=h(e,p("customerId","==",t.uid),p("status","==","closed"),p("customerHasRead","==",!1)),n=g(s,(e=>{if(e.empty)return l(!1),i(null),void d(null);const s=e.docs[0],t=s.data(),a=s.id;c!==a&&(d(a),i(t),l(!0))}));return()=>n()}),[t,c]);return r.jsxs(r.Fragment,{children:[e,o&&r.jsx(b,{isOpen:n,onClose:async()=>{l(!1),i(null),d(null)},inquiryId:c,inquiryData:o})]})};export{j as default};
