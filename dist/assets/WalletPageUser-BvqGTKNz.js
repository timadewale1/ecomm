import{j as e,L as t,ay as s,r as a,h as r,B as l,o as n,d as o,a as c,F as i,S as d,Q as m,c5 as u,bq as x,br as h,G as p,H as f,c6 as y,c7 as j,c8 as N,_ as g,ac as b}from"./index-CvIXhaMv.js";import{w}from"./wallet-CwxZTKXc.js";import{h as v}from"./index-CGdwSzPY.js";const S=()=>e.jsx("div",{className:"flex w-full h-full  justify-center items-center",children:e.jsx(t,{className:"  ",animationData:w,loop:!0,autoplay:!0})});function k(){const{currentUserData:t,loading:w,accountDeactivated:k}=s(),[C,O]=a.useState(0),[T,W]=a.useState(""),[A,B]=a.useState(""),[D,I]=a.useState((null==t?void 0:t.walletSetup)??!1),[F,$]=a.useState((()=>{try{const e=localStorage.getItem("userWalletHistory");return e?JSON.parse(e):[]}catch{return[]}})),[M,E]=a.useState((()=>{try{return JSON.parse(localStorage.getItem("hideBalance")||"false")}catch{return!1}})),[H,J]=a.useState(!1),[P,L]=a.useState(!0),[U,z]=a.useState(null),V=r(),[G,q]=a.useState(!1),{openChat:Q}=l(),Y=async()=>{var e;if(!H){J(!0);try{const s="9cac075ea03553597625b06532dc88a6",a="https://prod.mythriftpayments.site/api/v1/create-wallet",r=Math.floor(1e3+9e3*Math.random()).toString(),[l,...n]=(t.displayName||"").split(" "),i=n.join(" ")||"";let d=null==(e=t.phoneNumber)?void 0:e.toString().replace(/\D/g,"");if(!d)throw new Error("Phone number is missing");if(d=d.startsWith("234")?`+${d}`:d.startsWith("0")?`+234${d.slice(1)}`:`+234${d}`,d.length<14)throw new Error("Invalid phone number: must be at least 10 digits");const m={firstName:l||"",lastName:i,email:t.email,myThriftId:t.uid,walletPin:r,phoneNumber:d},u=await fetch(a,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${s}`},body:JSON.stringify(m)}),x=await u.json();if(!x.status)throw new Error(x.message);const h=x.data;await b(o(c,"users",t.uid),{walletSetup:!0,accountName:h.accountName,balance:h.balance,walletId:String(h.walletId),preferredBank:h.preferredBank,accountNumber:h.accountNumber}),g.success("Wallet created successfully")}catch(s){g.error(s.message||"Failed to create wallet")}finally{J(!1)}}};return a.useEffect((()=>{if(!(null==t?void 0:t.uid))return void(w||(z("User not authenticated"),L(!1)));if(k)return z("Account is deactivated. Please contact support."),void L(!1);if("user"!==t.role)return z("Access restricted to users only."),void L(!1);try{const e=localStorage.getItem("userWalletHistory");e&&$(JSON.parse(e))}catch{}const e=n(o(c,"users",t.uid),(e=>{if(!e.exists())return z("User document not found"),void L(!1);const s=e.data();O(s.balance??0),W(s.accountNumber??""),B(s.preferredBank??""),I(s.walletSetup??!1),L(!1),(async e=>{try{const t="9cac075ea03553597625b06532dc88a6",s=`https://prod.mythriftpayments.site/api/v1/wallet-transactions/${e}`,a=await fetch(s,{headers:{Authorization:`Bearer ${t}`}});if(!a.ok)throw new Error(`HTTP ${a.status}`);const r=await a.json();if(!r.status)throw new Error(r.message);const l=r.data.sort(((e,t)=>new Date(t.createdAt)-new Date(e.createdAt))).map((e=>({id:e.id,type:e.amountSlug.startsWith("+")?"paid":"withdrawal",amount:e.amount,date:new Intl.DateTimeFormat("en-US",{month:"short",day:"2-digit",year:"numeric"}).format(new Date(e.createdAt))})));return $(l),localStorage.setItem("userWalletHistory",JSON.stringify(l)),l}catch(t){return g.error(t.message||"Failed to load history"),[]}})(t.uid)}),(e=>{z("Failed to fetch wallet data"),L(!1)}));return()=>e()}),[null==t?void 0:t.uid,w,k,null==t?void 0:t.role]),w||P?e.jsx(i,{}):U?e.jsxs("div",{className:"p-4 w-full mx-auto font-opensans text-center",children:[e.jsx("p",{className:"text-red-600",children:U}),e.jsx("button",{onClick:()=>V("/login"),className:"mt-4 bg-customOrange text-white rounded-full py-2.5 px-6 font-opensans font-medium",children:"Go to Login"})]}):D?e.jsxs(e.Fragment,{children:[e.jsx(d,{title:"Wallet - My Thrift",description:"View your balance and account details in your My Thrift wallet.",url:"https://www.shopmythrift.store/user-wallet"}),e.jsxs("div",{className:"p-4 w-full mx-auto font-opensans",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsx("button",{onClick:()=>V(-1),className:"absolute left-0 p-1",children:e.jsx(m,{className:"text-2xl text-gray-800"})}),e.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Wallet"}),e.jsx(u,{onClick:Q,className:"absolute right-0 text-2xl text-customOrange cursor-pointer",title:"Customer Care"})]}),e.jsxs("div",{className:"relative z-10 pb-12 bg-customDeepOrange rounded-2xl p-4 text-white overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 -right-2",children:e.jsx("img",{src:"./Vector.png",alt:"",className:"w-16 h-24"})}),e.jsx("div",{className:"absolute bottom-0 left-0",children:e.jsx("img",{src:"./Vector2.png",alt:"",className:"w-16 h-16"})}),e.jsx("h2",{className:"text-xs font-opensans font-light mb-1",children:"My Thrift Balance"}),e.jsxs("div",{className:"flex items-center justify-start mb-4 space-x-2",children:[M?e.jsx(v,{className:"text-4xl"}):e.jsxs("p",{className:"text-3xl font-opensans font-bold",children:["₦",C.toLocaleString()]}),e.jsx("button",{onClick:()=>{const e=!M;E(e),localStorage.setItem("hideBalance",JSON.stringify(e))},children:M?e.jsx(x,{className:"text-sm"}):e.jsx(h,{className:"text-sm"})})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-2xl px-4 py-2 -translate-y-5",children:[e.jsx("div",{className:"mb-6"}),e.jsxs("div",{className:"flex justify-between mb-3",children:[e.jsx("span",{className:"font-opensans text-sm text-gray-600",children:"Bank Name"}),e.jsx("span",{className:"text-sm font-opensans font-semibold uppercase",children:A||"N/A"})]}),e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"font-opensans text-sm text-gray-600",children:"Account Number"}),e.jsxs("span",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:"text-sm font-opensans font-semibold",children:T||"N/A"}),T&&e.jsx("button",{onClick:async()=>{if(T)try{await navigator.clipboard.writeText(T),q(!0),g.success("Account number copied!"),setTimeout((()=>q(!1)),2e3)}catch(e){g.error("Failed to copy")}},className:"text-gray-600 hover:text-black",children:G?e.jsx(p,{className:"w-4 h-4 text-customOrange"}):e.jsx(f,{className:"w-4 h-4 text-customOrange"})})]})]})]}),e.jsxs("div",{className:"border border-gray-200 mt-4 rounded-2xl p-4 bg-white",children:[e.jsx("h3",{className:"text-xs font-opensans font-medium mb-2",children:"Transaction History"}),0===F.length?e.jsxs("div",{className:"flex flex-col items-center justify-center py-8",children:[e.jsx(y,{className:"text-5xl text-customOrange"}),e.jsx("p",{className:"text-xs text-center text-gray-500 mt-2",children:"Your recent transactions will appear here"})]}):e.jsx("ul",{className:"space-y-2",children:F.map((t=>e.jsxs("li",{className:"flex justify-between border-b border-gray-200 py-3 last:border-0 hover:bg-gray-50",children:[e.jsxs("span",{className:"flex items-center space-x-2",children:["withdrawal"===t.type?e.jsx(j,{className:"text-xl text-gray-600"}):e.jsx(N,{className:"text-xl text-gray-600"}),e.jsx("span",{className:"text-sm font-semibold",children:"withdrawal"===t.type?"Paid":"Deposit"})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold font-opensans text-base "+("withdrawal"===t.type?"text-gray-700":"text-green-600"),children:["₦",t.amount.toLocaleString()]}),e.jsx("p",{className:"text-xs text-gray-500",children:t.date})]})]},t.id)))})]})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{title:"Wallet Setup - My Thrift",description:"Set up your My Thrift wallet to view your balance and account details.",url:"https://www.shopmythrift.store/user-wallet"}),e.jsxs("div",{className:"p-4 w-full mx-auto font-opensans",children:[e.jsxs("div",{className:"relative flex items-center justify-center mb-6",children:[e.jsx("button",{onClick:()=>V(-1),className:"absolute left-0 p-1",children:e.jsx(m,{className:"text-2xl text-gray-800"})}),e.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Create Wallet"}),e.jsx(u,{onClick:Q,className:"absolute right-0 text-2xl text-customOrange cursor-pointer",title:"Customer Care"})]}),e.jsx(S,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center text-center space-y-4",children:[e.jsx("p",{className:"text-sm text-gray-600 font-opensans -translate-y-16 px-4",children:"Set up your wallet to be able to pay for items directly, making checkout faster and more convenient every time you shop."}),e.jsx("button",{onClick:Y,disabled:H,className:"bg-customOrange text-white rounded-full py-2.5 px-6 font-opensans font-medium disabled:opacity-50",children:H?"Creating Wallet...":"Setup Wallet"})]})]})]})}export{k as default};
