import{r as e,j as t,L as s,bt as a,bw as n,Q as o,bx as i,d as l,a as r,o as c,ac as d,_ as u,c as m,e as p,M as x,by as h,b as f,bz as b,a2 as g,aC as y,q as j,w as v,g as N,s as w,ab as k,bA as S,bh as D,az as C,bB as P,bC as O,a1 as F,I as T,Y as A,A as I,bD as z,bE as $,bF as R,bn as E,h as B,k as U,S as M,bg as Q,bG as q,bH as W,aM as V,bI as Y,bJ as L,bK as G,bL as K,a9 as _,H,G as J,bi as X,bM as Z,bN as ee,bO as te,bP as se,bQ as ae,y as ne}from"./index-CvIXhaMv.js";import{e as oe,i as ie,M as le,A as re}from"./AddProducts-BH3Z2zTW.js";import{g as ce}from"./index-C-KPEfQB.js";import{d as de,e as ue,f as me,g as pe}from"./index-CGdwSzPY.js";import{f as xe}from"./free-mode-c1c6xtYd.js";import{S as he,a as fe}from"./swiper-react-Ew1PjN2i.js";/* empty css               *//* empty css                 */import{S as be}from"./safeImg-D5tiHBmg.js";import{p as ge,a as ye}from"./producttype-CCeY2YpR.js";import"./index-BaqZIR9i.js";import"./index-DfGOTzdC.js";import"./inheritsLoose-BMl3PfwL.js";import"./Transition-DlEawdUv.js";import"./index-DZJSELV0.js";const je=({isOpen:o,title:i,icon:l,message:r,onClose:c,onConfirm:d,loading:u})=>{const[m,p]=e.useState(!1);return e.useEffect((()=>{setTimeout((()=>p(!0)),10)}),[]),o?t.jsx("div",{className:"fixed font-opensans inset-0 bg-black bg-opacity-40 flex items-center justify-center modal2 transition-all duration-100 "+(m?"backdrop-blur-sm":""),children:t.jsxs("div",{className:`space-y-4 flex flex-col justify-center transition-all duration-[50ms] ease-in-out bg-white ${m?"shadow-lg shadow-black/35 border border-white/10 backdrop-blur-md scale-100":"shadow-lg shadow-black/35 scale-75"}\n      p-4 rounded-xl shadow-lg shadow-black/30 w-[80%]`,children:[t.jsxs("div",{className:"flex flex-col items-center text-center space-y-2",children:[t.jsx("h2",{className:"text-lg text-black font-semibold",children:i}),t.jsx("p",{className:"text-[14px] text-black",children:r})]}),t.jsxs("div",{className:"w-full px-3 py-1 flex flex-col items-center rounded-2xl bg-gray-100 space-y-2",children:[i&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:`w-full items-center ${"Delete Product"===i?"text-red-600":"text-customOrange"} text-sm flex justify-between py-2 focus:outline-none cursor-pointer`,onClick:u?null:d,children:[i,u?t.jsx(s,{className:"w-4 h-4",animationData:a,loop:!0,autoplay:!0}):t.jsx("div",{children:l})]}),t.jsx("hr",{className:"w-full text-slate-800"})]}),t.jsxs("div",{className:"w-full items-center text-sm flex justify-between py-2 cursor-pointer",onClick:c,children:["Cancel",t.jsx(n,{className:"w-4 h-4"})]})]})]})}):null},ve=({isOpen:s,onClose:a,children:n,onDel:l})=>{const r=e.useRef(null),[c,d]=e.useState(!1);return e.useEffect((()=>{setTimeout((()=>d(!0)),10)}),[]),e.useEffect((()=>{s&&ce.fromTo(r.current,{opacity:0,y:810},{opacity:1,y:0,duration:.7,ease:"power2.out"})}),[s]),s?t.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-40 flex items-end justify-center modal1 transition-all duration-300 "+(c?"backdrop-blur-sm":""),children:t.jsxs("div",{ref:r,className:"bg-white rounded-t-lg px-2 py-4 flex flex-col items-center w-full md:w-3/4 lg:w-1/2 max-h-screen overflow-y-auto scrollbar-hide",children:[t.jsxs("div",{className:"flex items-center justify-between w-full mb-2 mt-6",children:[t.jsx(o,{className:"text-3xl cursor-pointer",onClick:a}),t.jsx("h2",{className:"text-xl font-opensans text-center font-semibold text-black",children:"Product Details"}),t.jsx("button",{onClick:l,children:t.jsx(i,{className:"h-8 w-8 p-1 text-customOrange"})})]}),t.jsx("div",{className:"w-full p-2",children:n})]})}):null},Ne=({itemId:s,initialIsOn:a,onColor:n="bg-customOrange",offColor:o="bg-gray-300",vendorId:i,name:x})=>{const[h,f]=e.useState(a);e.useEffect((()=>{const e=l(r,"products",s),t=c(e,(e=>{e.exists()&&f(e.data().published)}));return()=>t()}),[s]);const b=async(e,t,s)=>{try{const a=m(r,"vendors",i,"activityNotes");await p(a,{title:e,type:s,note:t,timestamp:new Date})}catch(a){u.error("Error adding activity note: "+a.message)}};return t.jsx("div",{className:`w-11 h-5 flex items-center rounded-full p-1 cursor-pointer ${h?`${n} bg-opacity-5`:o} transition-colors duration-300 ease-in-out`,onClick:async()=>{const e=!h;f(e);const t=l(r,"products",s);try{await d(t,{published:e,isFeatured:!1}),u.success(h?"Product drafted successfully.":"Product published successfully."),h?await b("Drafted Product ðŸ“‚",`You've hidden ${x}! Customers can not see or order this product while it is still drafted.`,"Product Update"):await b("Published Product âœ¨",`You've made ${x} a visible product in your store! This will be part of the first products customers see in your store.`,"Product Update")}catch(a){f(!e)}},children:t.jsx("div",{className:`h-5 w-5 ${h?n:"bg-white"} rounded-full shadow-md transform ${h?"translate-x-5":""} transition-transform duration-300 ease-in-out`})})};x.setAppElement("#root");const we=({isOpen:s,onRequestClose:a,product:n})=>{var o;const[i,c]=e.useState([]),[D,C]=e.useState(null),[P,O]=e.useState(""),[F,T]=e.useState(""),[A,I]=e.useState(""),[z,$]=e.useState(""),[R,E]=e.useState(!1),[B,U]=e.useState("monetary"),[M,Q]=e.useState(!1),[q,W]=e.useState(""),[V,Y]=e.useState(!1),[L,G]=e.useState(!1),K=()=>Y(!1),[_,H]=e.useState(!1);e.useEffect((()=>{setTimeout((()=>H(!0)),10)}),[]),e.useEffect((()=>{(async()=>{try{const e=j(m(r,"inAppDiscounts"),v("isActive","==",!0)),t=await N(e),s=[];t.forEach((e=>{s.push({id:e.id,...e.data()})})),s.push({id:"personal",name:"Run Personal Discount"}),c(s),s.length>0&&(C(s[0]),$(`inApp-${s[0].id}`))}catch(e){}})()}),[]),e.useEffect((()=>{if(!n)return;let e=n.price||0;const t=parseFloat(e),s=parseFloat(P);if(!isNaN(t)&&!isNaN(s)&&t>0&&s<t){const e=t-s,a=Math.round(e/t*100);T(e.toFixed(2)),I(a)}else T(""),I("")}),[n,P]);const J=z.startsWith("inApp")||"personal-monetary"===z,X="personal-freebies"===z;let Z="";J?""===P.trim()?Z="Discount price is required.":parseFloat(P)<300?Z="Discount price must be at least 300.":parseFloat(P)>=parseFloat(n.price)&&(Z="Discount price must be less than the initial price."):X&&""===q.trim()&&(Z="Freebie details are required.");const ee=""===Z;return t.jsxs(t.Fragment,{children:[t.jsxs(x,{isOpen:s,onRequestClose:a,className:"discount-modal",overlayClassName:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center modal1 transition-all duration-100 "+(_?"backdrop-blur-sm":""),children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-2 py-2 ",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("h2",{className:"font-opensans text-lg text-customRichBrown font-semibold",children:D&&"personal"!==D.id?"Inâ€‘App Discount":"Personal Discount"}),t.jsx(h,{className:"text-customOrange text-xl ml-2"})]}),t.jsx(f,{className:"text-black text-xl cursor-pointer",onClick:a})]}),t.jsxs("div",{className:"py-4 px-2 overflow-y-auto max-h-[90vh]",children:[t.jsxs("div",{className:"relative",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Select a Discount Option"}),t.jsx("button",{className:"bg-white w-full text-left text-sm font-opensans border-gray-100 border-2 px-4 py-2 rounded-lg",onClick:()=>E(!R),children:D?D.name:"Select Discount"}),R&&t.jsx("div",{className:"absolute z-50 bg-white w-full rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 mt-2 p-3",children:i.map((e=>t.jsxs("button",{onClick:()=>{C(e),E(!1),"personal"!==e.id?$(`inApp-${e.id}`):$("personal-monetary")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:[e.name," ",e.startDate&&e.endDate?`(Valid from ${new Date(1e3*e.startDate.seconds).toDateString()} to ${new Date(1e3*e.endDate.seconds).toDateString()})`:""]},e.id)))})]}),D&&"personal"===D.id&&t.jsxs("div",{className:"relative mt-4 flex flex-col ",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Select Personal Discount Type"}),t.jsx("button",{className:"ml-2",onClick:()=>Y(!0),children:t.jsx(b,{className:"w-5 h-5 text-customRichBrown"})})]}),t.jsxs("div",{className:"w-full",children:[t.jsx("button",{className:"bg-white w-full text-left text-sm font-opensans border-gray-100 border-2 px-4 py-2 rounded-lg mt-2",onClick:()=>Q(!M),children:"monetary"===B?"Monetary":"Freebies"}),M&&t.jsxs("div",{className:"absolute z-50 bg-white w-full rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 mt-2 p-3",children:[t.jsx("button",{onClick:()=>{U("monetary"),Q(!1),$("personal-monetary")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:"Monetary"}),t.jsx("button",{onClick:()=>{U("freebies"),Q(!1),$("personal-freebies")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:"Freebies"})]})]})]}),(D&&"personal"!==D.id||D&&"personal"===D.id&&"monetary"===B)&&t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Initial Price"}),t.jsxs("div",{className:"w-full border-2 rounded-md px-2 py-2 bg-gray-50 font-opensans font-medium text-black text-sm border-gray-100 text-right",children:["â‚¦",null==(o=null==n?void 0:n.price)?void 0:o.toFixed(2)]}),t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown mt-4",children:"Discount Price"}),t.jsx("input",{type:"text",value:P,onChange:e=>O((e.target.value.replace(/\D/g,"")/100).toFixed(2)),onBlur:()=>{parseFloat(P)<300&&(u.error("Discount price must be at least 300"),O(""))},className:"w-full text-right border-2 font-opensans text-gray-800 border-gray-100 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-customOrange",placeholder:"0.00"}),t.jsxs("div",{className:"mt-4 flex gap-4",children:[t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Subtractive Value"}),t.jsxs("div",{className:"w-full border-2 rounded-md px-2 py-2 bg-gray-50 font-opensans font-medium text-black text-sm border-gray-100 text-right",children:["â‚¦",F]})]}),t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Percentage Cut"}),t.jsxs("div",{className:"w-full border-2 rounded-md px-2 py-2 bg-gray-50 font-opensans font-medium text-black text-sm border-gray-100 text-right",children:[A,"%"]})]})]})]}),D&&"personal"===D.id&&"freebies"===B&&t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Freebie Details"}),t.jsx("input",{type:"text",value:q,onChange:e=>W(e.target.value),className:"w-full border-2 font-opensans text-gray-800 border-gray-100 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-customOrange",placeholder:"Enter details (e.g., Buy 1 Get 1 Free, Free Delivery)"})]}),!ee&&t.jsx("div",{className:"mt-4",children:t.jsx("p",{className:"text-sm font-opensans text-red-600",children:Z})}),t.jsx("div",{className:"flex justify-center mt-6",children:t.jsx("button",{onClick:async()=>{G(!0);try{const e=l(r,"products",n.id),t=l(r,"vendors",n.vendorId),s=m(r,"discounts");let o={};D&&"personal"!==D.id?o={discountType:`inApp-${D.id}`,selectedDiscount:D,initialPrice:parseFloat(n.price),discountPrice:parseFloat(P),subtractiveValue:parseFloat(F),percentageCut:parseFloat(A)}:"personal"===(null==D?void 0:D.id)&&("monetary"===B?o={discountType:"personal-monetary",initialPrice:parseFloat(n.price),discountPrice:parseFloat(P),subtractiveValue:parseFloat(F),percentageCut:parseFloat(A)}:"freebies"===B&&(o={discountType:"personal-freebies",freebieText:q}));const i=l(s),c={vendorId:n.vendorId,type:o.discountType.startsWith("inApp")?"inApp":"personal",isActive:!0,createdAt:w(),...o.discountType.startsWith("personal")&&{discountSubType:"personal-monetary"===o.discountType?"monetary":"freebies"},..."personal-freebies"!==o.discountType&&o.initialPrice&&{initialPrice:o.initialPrice,discountPrice:o.discountPrice,percentageCut:o.percentageCut,subtractiveValue:o.subtractiveValue},..."personal-freebies"===o.discountType&&{freebieText:o.freebieText},...o.selectedDiscount&&{selectedDiscountId:o.selectedDiscount.id,selectedDiscountName:o.selectedDiscount.name}};await k(i,c),await d(t,{discountIds:S(i.id)});const x={discount:o,discountId:i.id};"freebies"!==B&&o.discountPrice&&(x.price=o.discountPrice),await d(e,x),await(async(e,t,s)=>{const a=m(r,"vendors",n.vendorId,"activityNotes"),o={title:e,type:s,timestamp:new Date,note:t};try{await p(a,o)}catch(i){}})("Running a Discount ðŸ·",`You've applied a ${o.discountType.startsWith("inApp")?"store-wide":"personal"} discount on ${n.name}. Check your store for more details!`,"Discount Update"),u.success("Discount saved and applied successfully!"),G(!1),a()}catch(e){u.error("Failed to save the discount. Please try again."),G(!1)}},disabled:!ee,className:"w-full px-4 py-3 rounded-full font-opensans font-medium text-sm flex justify-center items-center "+(ee?"bg-customOrange text-white hover:bg-orange-700":"bg-gray-400 text-gray-200 cursor-not-allowed"),children:L?t.jsx(g,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Save Discount"})})]})]}),t.jsxs(x,{isOpen:V,onRequestClose:K,className:"modal-content-rider h-auto",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-blue-100 flex justify-center items-center rounded-full",children:t.jsx(y,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Personal Discount Details"})]}),t.jsx(f,{className:"text-xl relative -top-2",onClick:K})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[t.jsx("p",{className:"text-xs font-opensans text-black font-medium",children:"Monetary Discount:"}),t.jsx("p",{className:"text-xs font-opensans text-black",children:"With a Monetary Discount, you set an initial price and a discounted price. The system calculates the amount off and the percentage reduction (displayed as a whole number). Ensure that the discount price is at least 300 and less than the initial price."}),t.jsx("p",{className:"text-xs font-opensans text-black font-medium mt-2",children:"Freebies Discount:"}),t.jsx("p",{className:"text-xs font-opensans text-black",children:'When choosing Freebies, no price reduction is applied. Instead, you provide details of the free offer (e.g., "Buy 1 Get 1 Free" or "Free Delivery"). This option is ideal if you wish to offer an incentive without changing the product price.'})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:K,className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full flex items-center",children:"Close"})})]})]})};x.setAppElement("#root");const ke=({isOpen:s,onRequestClose:a,product:n})=>{const[o,i]=e.useState([]),[c,D]=e.useState(null),[C,P]=e.useState(""),[O,F]=e.useState(""),[T,A]=e.useState(""),[I,z]=e.useState(""),[$,R]=e.useState(!1),[E,B]=e.useState(!1),[U,M]=e.useState("monetary"),[Q,q]=e.useState(!1),[W,V]=e.useState(""),[Y,L]=e.useState(!1),[G,K]=e.useState(!1),_=()=>L(!1);e.useEffect((()=>{(async()=>{try{const e=j(m(r,"inAppDiscounts"),v("isActive","==",!0)),t=await N(e),s=[];t.forEach((e=>{s.push({id:e.id,...e.data()})})),s.push({id:"personal",name:"Run Personal Discount"}),i(s),s.length>0&&(D(s[0]),z(`inApp-${s[0].id}`))}catch(e){}})()}),[]),e.useEffect((()=>{if(!n)return;let e=n.price||0;const t=parseFloat(e),s=parseFloat(C);if(!isNaN(t)&&!isNaN(s)&&t>0&&s<t){const e=t-s,a=Math.round(e/t*100);F(e.toFixed(2)),A(a)}else F(""),A("")}),[n,C]);const H=I.startsWith("inApp")||"personal-monetary"===I,J="personal-freebies"===I;let X="";H?""===C.trim()?X="Discount price is required.":parseFloat(C)<300?X="Discount price must be at least 300.":parseFloat(C)>=parseFloat(n.price)&&(X="Discount price must be less than the initial price."):J&&""===W.trim()&&(X="Freebie details are required.");const Z=""===X;return t.jsxs(t.Fragment,{children:[t.jsxs(x,{isOpen:s,onRequestClose:a,className:"discount-modal",overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-200 px-2 py-2",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("h2",{className:"font-opensans text-lg text-customRichBrown font-semibold",children:c&&"personal"!==c.id?"Inâ€‘App Discount":"Personal Discount"}),t.jsx(h,{className:"text-customOrange text-xl ml-2"})]}),t.jsx(f,{className:"text-black text-xl cursor-pointer",onClick:a})]}),t.jsxs("div",{className:"py-4 px-2 overflow-y-auto max-h-[90vh]",children:[t.jsxs("div",{className:"relative",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Select a Discount Option"}),t.jsx("button",{className:"bg-white w-full text-left text-sm font-opensans border-gray-100 border-2 px-4 py-2 rounded-lg",onClick:()=>R(!$),children:c?c.name:"Select Discount"}),$&&t.jsx("div",{className:"absolute z-50 bg-white w-full rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 mt-2 p-3",children:o.map((e=>t.jsxs("button",{onClick:()=>{D(e),R(!1),"personal"!==e.id?z(`inApp-${e.id}`):z("personal-monetary")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:[e.name," ",e.startDate&&e.endDate?`(Valid from ${new Date(1e3*e.startDate.seconds).toDateString()} to ${new Date(1e3*e.endDate.seconds).toDateString()})`:""]},e.id)))})]}),c&&"personal"===c.id&&t.jsxs("div",{className:"relative mt-4 flex flex-col ",children:[t.jsxs("div",{className:"flex items-center",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Select Personal Discount Type"}),t.jsx("button",{className:"ml-2",onClick:()=>L(!0),children:t.jsx(b,{className:"w-5 h-5 text-customRichBrown"})})]}),t.jsxs("div",{className:"w-full",children:[t.jsx("button",{className:"bg-white w-full text-left text-sm font-opensans border-gray-100 border-2 px-4 py-2 rounded-lg mt-2",onClick:()=>q(!Q),children:"monetary"===U?"Monetary":"Freebies"}),Q&&t.jsxs("div",{className:"absolute z-50 bg-white w-full rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 mt-2 p-3",children:[t.jsx("button",{onClick:()=>{M("monetary"),q(!1),z("personal-monetary")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:"Monetary"}),t.jsx("button",{onClick:()=>{M("freebies"),q(!1),z("personal-freebies")},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1 hover:bg-gray-100 rounded-md",children:"Freebies"})]})]})]}),(c&&"personal"!==c.id||c&&"personal"===c.id&&"monetary"===U)&&t.jsx("div",{className:"mt-4",children:t.jsx("div",{className:"mt-4 flex gap-4",children:t.jsxs("div",{className:"flex-1",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Percentage Cut"}),t.jsxs("div",{className:"w-full border-2 rounded-md px-2 py-2 bg-gray-50 font-opensans font-medium text-black text-sm border-gray-100 text-right",children:[T,"%"]})]})})}),c&&"personal"===c.id&&"freebies"===U&&t.jsxs("div",{className:"mt-4",children:[t.jsx("label",{className:"block text-sm font-medium font-opensans text-customRichBrown",children:"Freebie Details"}),t.jsx("input",{type:"text",value:W,onChange:e=>V(e.target.value),className:"w-full border-2 font-opensans text-gray-800 border-gray-100 rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-customOrange",placeholder:"Enter details (e.g., Buy 1 Get 1 Free, Free Delivery)"})]}),!Z&&t.jsx("div",{className:"mt-4",children:t.jsx("p",{className:"text-sm font-opensans text-red-600",children:X})}),t.jsx("div",{className:"flex justify-center mt-6",children:t.jsx("button",{onClick:async()=>{K(!0);try{const e=l(r,"products",n.id),t=l(r,"vendors",n.vendorId),s=m(r,"discounts");let o={};c&&"personal"!==c.id?o={discountType:`inApp-${c.id}`,selectedDiscount:c,initialPrice:parseFloat(n.price),discountPrice:parseFloat(C),subtractiveValue:parseFloat(O),percentageCut:parseFloat(T)}:"personal"===(null==c?void 0:c.id)&&("monetary"===U?o={discountType:"personal-monetary",initialPrice:parseFloat(n.price),discountPrice:parseFloat(C),subtractiveValue:parseFloat(O),percentageCut:parseFloat(T)}:"freebies"===U&&(o={discountType:"personal-freebies",freebieText:W}));const i=l(s),x={vendorId:n.vendorId,type:o.discountType.startsWith("inApp")?"inApp":"personal",isActive:!0,createdAt:w(),...o.discountType.startsWith("personal")&&{discountSubType:"personal-monetary"===o.discountType?"monetary":"freebies"},..."personal-freebies"!==o.discountType&&o.initialPrice&&{initialPrice:o.initialPrice,discountPrice:o.discountPrice,percentageCut:o.percentageCut,subtractiveValue:o.subtractiveValue},..."personal-freebies"===o.discountType&&{freebieText:o.freebieText},...o.selectedDiscount&&{selectedDiscountId:o.selectedDiscount.id,selectedDiscountName:o.selectedDiscount.name}};await k(i,x),await d(t,{discountIds:S(i.id)});const h={discount:o,discountId:i.id};"freebies"!==U&&o.discountPrice&&(h.price=o.discountPrice),await d(e,h),await(async(e,t,s)=>{const a=m(r,"vendors",n.vendorId,"activityNotes"),o={title:e,type:s,timestamp:new Date,note:t};try{await p(a,o)}catch(i){}})("Running a Discount ðŸ·",`You've applied a ${o.discountType.startsWith("inApp")?"store-wide":"personal"} discount on ${n.name}. Check your store for more details!`,"Discount Update"),u.success("Discount saved and applied successfully!"),K(!1),a()}catch(e){u.error("Failed to save the discount. Please try again."),K(!1)}},disabled:!Z,className:"w-full px-4 py-3 rounded-full font-opensans font-medium text-sm flex justify-center items-center "+(Z?"bg-customOrange text-white hover:bg-orange-700":"bg-gray-400 text-gray-200 cursor-not-allowed"),children:G?t.jsx(g,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Save Discount"})})]})]}),t.jsxs(x,{isOpen:Y,onRequestClose:_,className:"modal-content-rider h-auto",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-blue-100 flex justify-center items-center rounded-full",children:t.jsx(y,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Personal Discount Details"})]}),t.jsx(f,{className:"text-xl relative -top-2",onClick:_})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[t.jsx("p",{className:"text-xs font-opensans text-black font-medium",children:"Monetary Discount:"}),t.jsx("p",{className:"text-xs font-opensans text-black",children:"With a Monetary Discount, you set an initial price and a discounted price. The system calculates the amount off and the percentage reduction (displayed as a whole number). Ensure that the discount price is at least 300 and less than the initial price."}),t.jsx("p",{className:"text-xs font-opensans text-black font-medium mt-2",children:"Freebies Discount:"}),t.jsx("p",{className:"text-xs font-opensans text-black",children:'When choosing Freebies, no price reduction is applied. Instead, you provide details of the free offer (e.g., "Buy 1 Get 1 Free" or "Free Delivery"). This option is ideal if you wish to offer an incentive without changing the product price.'})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:_,className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full flex items-center",children:"Close"})})]}),t.jsx("div",{children:t.jsx(je,{isOpen:E,onClose:()=>B(!1),message:"Are you sure you want to add this discount to the selected product(s)?",icon:t.jsx(de,{className:"w-4 h-4"}),title:"Add Discount"})})]})},Se=ie();x.setAppElement("#root");const De=({vendorId:s,selectedProduct:a,onClose:n})=>{var o,i,c;const[m,p]=e.useState((null==a?void 0:a.name)||""),[x,h]=e.useState((null==a?void 0:a.description)||""),[f,b]=e.useState("number"==typeof(null==a?void 0:a.price)?a.price.toFixed(2):(null==(o=null==a?void 0:a.price)?void 0:o.toString())||""),[g,y]=e.useState(!1),[j,v]=e.useState((null==(i=null==a?void 0:a.stockQuantity)?void 0:i.toString())||""),[N,k]=e.useState((null==a?void 0:a.defectDescription)||""),[S,E]=e.useState((null==a?void 0:a.category)||""),B=[{label:"Men",value:"Mens"},{label:"Women",value:"Womens"},{label:"Kids",value:"Kids"},{label:"All",value:"all"}],U=[{label:"Brand New",value:"brand new"},{label:"Thrift",value:"thrift"},{label:"Defect:",value:"Defect:"}],[M,Q]=e.useState(null),[q,W]=e.useState(null),[V,Y]=e.useState((e=>{const t="string"==typeof e?e:(null==e?void 0:e.value)||(null==e?void 0:e.label)||"",s=String(t).trim();if(!s)return"";const a=U.find((e=>e.value.toLowerCase()===s.toLowerCase()))||(s.toLowerCase().startsWith("defect")?{value:"Defect:"}:null);return a?a.value:s})((null==a?void 0:a.condition)||"")),[L,G]=e.useState(null!=(null==a?void 0:a.isFashion)?a.isFashion?"fashion":"everyday":localStorage.getItem("matildaItemClass")||"fashion"),[K,_]=e.useState([{color:"",sizes:[{size:"",stock:"",isActive:!0}]}]),[H,J]=e.useState(!1),[X,Z]=e.useState((null==a?void 0:a.subProducts)||[]),[ee,te]=e.useState([]),[se,ae]=e.useState(Array.isArray(null==a?void 0:a.imageUrls)&&a.imageUrls.length?a.imageUrls.map((e=>({preview:e}))):[]),[ne,ie]=e.useState(0),le=e.useRef(null),[re,ce]=e.useState((null==a?void 0:a.tags)||[]),[de,me]=e.useState(""),[pe,ve]=e.useState(!1),[Ne,we]=e.useState(!1),[ke,De]=e.useState(null);e.useEffect((()=>{const e=D(),t=C(e,(e=>{e?De(e):u.error("No user is signed in.")}));return()=>t()}),[]);const Ce=e.useRef(null);e.useEffect((()=>{if(M&&q){const e=M.value.trim(),t=ge[e];let s=[];if(Array.isArray(t))s=t;else if("object"==typeof t&&null!==t){s=t[q.value.replace(/\s+/g,"")]||[]}if(s&&s.length>0){const e=s.map((e=>({label:e,value:e})));te(e),Oe(s)}else te([]),Oe([])}else te([]),Oe([])}),[M,q]),e.useEffect((()=>{const e=null==a?void 0:a.id;if(!e)return;if(Ce.current===e)return;Ce.current=e;const t=!!a.isFashion;G(t?"fashion":"everyday");const s=(t?ye:oe).find((e=>e.type===a.productType));if(s&&Q({label:s.type,value:s.type,subTypes:s.subTypes}),a.subType&&W({label:a.subType,value:a.subType}),t){const e=[];(a.variants||[]).forEach((t=>{const s=e.find((e=>e.color===t.color)),a={size:t.size,stock:String(t.stock??""),isActive:!0};s?s.sizes.push(a):e.push({color:t.color,sizes:[a]})})),e.length&&_(e),Array.isArray(a.subProducts)&&a.subProducts.length&&(J(!0),Z(a.subProducts.map((e=>({subProductId:e.subProductId,color:e.color,size:e.size,stock:e.stock,images:Array.isArray(e.images)?e.images:[]})))))}if(Array.isArray(a.imageUrls)){const e=[...a.imageUrls],t=a.coverImageUrl,s=t?e.indexOf(t):-1;s>0&&(e.splice(s,1),e.unshift(t)),ae(e.map((e=>({preview:e})))),ie(0)}}),[null==a?void 0:a.id]);const[Pe,Oe]=e.useState([]);e.useEffect((()=>{if(!M)return void Oe([]);const e=M.value,t=ge[e];let s=[];if(Array.isArray(t))s=t;else if(t&&"object"==typeof t)if(null==q?void 0:q.value){const e=t[q.value.replace(/\s+/g,"")]||t[q.value]||[];Array.isArray(e)&&(s=e)}else s=Object.values(t).flat();Oe(s)}),[M,q]);const Fe=e=>{const t=(e||"").replace(/\D/g,"");return((Number(t)||0)/100).toFixed(2)},Te=P();e.useEffect((()=>{var e;(null==(e=le.current)?void 0:e.update)&&le.current.update()}),[se.length]);const Ae=e=>(null==e?void 0:e.preview)?e.preview:"string"==typeof e?e:"",Ie=("fashion"===L?ye:oe).map((e=>({label:e.type,value:e.type,subTypes:e.subTypes}))),ze=(e,t,s,a)=>{const n=[...K];n[e].sizes[t][s]=a,_(n)},[$e,Re]=e.useState(!1);return e.useEffect((()=>{const e=setTimeout((()=>Re(!0)),10);return()=>clearTimeout(e)}),[]),t.jsxs("div",{className:"fixed font-opensans inset-0 bg-black bg-opacity-40 flex justify-center modal1 transition-all duration-300 "+($e?"backdrop-blur-sm":""),children:[t.jsxs("div",{className:"relative w-full p-6 rounded-t-2xl shadow-md transform transition-all duration-[300ms] ease-in-out overflow-y-auto "+($e?"translate-y-0 bg-white shadow-lg shadow-black/35 border border-white/10 backdrop-blur-md":"translate-y-full bg-gradient-to-br from-white/5 to-white/5 via-white/10 shadow-lg shadow-black/35 border border-white/10"),style:{transitionProperty:"transform, background-color, background-image"},children:[t.jsx("button",{onClick:n,className:"sticky",children:t.jsx(O,{className:"text-2xl"})}),t.jsx("div",{children:se.length>0?t.jsxs("div",{className:"relative w-full h-64 sm:h-80 rounded-lg overflow-hidden mb-4",children:[t.jsx(he,{modules:[xe],slidesPerView:1,spaceBetween:5,allowTouchMove:!0,onSwiper:e=>{le.current=e},onSlideChange:e=>ie(e.activeIndex),className:"product-images-swiper",children:se.map(((e,s)=>t.jsxs(fe,{children:[" ",t.jsxs("div",{className:"relative w-full h-full",children:[0===s&&t.jsx("span",{className:"absolute z-10 top-2 left-2 text-[10px] px-2 py-1 bg-black/60 text-white rounded",children:"Cover"}),t.jsx(be,{src:Ae(e)||"",alt:`${(null==a?void 0:a.name)||"product"} image ${s+1}`,className:"object-cover w-full h-64"})]})]},((e,t)=>e&&e.preview||("string"==typeof e?e:`img-${t}`))(e,s))))}),t.jsx("div",{className:"absolute bottom-4 z-10 w-full flex justify-center",children:se.map(((e,s)=>t.jsx("div",{className:"cursor-pointer mx-1 rounded-full transition-all duration-300 "+(s===ne?"bg-customOrange h-3 w-3":"bg-gray-300 h-2 w-2"),onClick:()=>(e=>{var t;null==(t=le.current)||t.slideTo(e)})(s)},`dot-${s}`)))})]}):t.jsx("div",{className:"w-full h-64 flex items-center justify-center mb-4 bg-gray-100 rounded-lg",children:t.jsx("span",{className:"text-gray-400 text-sm font-opensans",children:"No images yet"})})}),t.jsx(F,{children:se.length>0&&ne>0&&t.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"flex justify-start m-2",children:t.jsx("button",{type:"button",onClick:()=>{ae((e=>{if(!e.length||0===ne)return e;const t=[...e],[s]=t.splice(ne,1);return t.unshift(s),t})),ie(0),setTimeout((()=>{var e,t,s,a;null==(t=null==(e=le.current)?void 0:e.update)||t.call(e),null==(a=null==(s=le.current)?void 0:s.slideTo)||a.call(s,0)}),0)},className:"text-xs font-opensans font-semibold text-customOrange",children:"Set as cover Image"})})}),t.jsx("div",{className:"w-full max-w-md mx-auto flex justify-between items-center bg-gray-200 rounded-full p-1 mb-6",children:["fashion","everyday"].map((e=>{const s=L===e;return t.jsx("button",{onClick:()=>{G(e),"everyday"===e&&J(!1),Q(null),W(null)},className:"w-1/2 py-2 rounded-full text-xs font-opensans font-semibold "+(s?"bg-white text-customOrange":"text-gray-800"),children:"fashion"===e?"Fashion / Wardrobe":"Lifestyle Items"},e)}))}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Product Name"}),t.jsx("input",{type:"text",value:m,onChange:e=>p(e.target.value),className:"w-full h-12 p-3 border-2 rounded-lg font-opensans focus:outline-none focus:border-customOrange",required:!0})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Product Category"}),t.jsx(A,{options:B,value:B.find((e=>e.value===S))||null,onChange:e=>E((null==e?void 0:e.value)||""),components:Se,className:"w-full text-sm font-opensans",classNamePrefix:"custom-select",placeholder:"Select Category",isSearchable:!0,styles:{control:e=>({...e,height:"3rem",borderColor:"#D1D5DB",borderRadius:"0.5rem",fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black",paddingLeft:"0.75rem"}),input:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black"}),placeholder:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"#6B7280"})}})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Product Type"}),t.jsx(A,{options:Ie,value:M,onChange:e=>{Q(e),W(null)},components:Se,className:"w-full text-sm font-opensans",classNamePrefix:"custom-select",placeholder:"Select Product Type",isSearchable:!0,styles:{control:e=>({...e,height:"3rem",borderColor:"#D1D5DB",borderRadius:"0.5rem",fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black",paddingLeft:"0.75rem"}),input:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black"}),placeholder:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"#6B7280"})}})]}),t.jsx(F,{children:(null==(c=null==M?void 0:M.subTypes)?void 0:c.length)?t.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Product Subtype"}),t.jsx(A,{options:M.subTypes.map((e=>"string"==typeof e?{label:e,value:e}:{label:e.name,value:e.name})),value:q,onChange:e=>W(e),components:Se,className:"w-full text-sm font-opensans",classNamePrefix:"custom-select",placeholder:"Select Subtype",isSearchable:!0,styles:{control:e=>({...e,height:"3rem",borderColor:"#D1D5DB",borderRadius:"0.5rem",fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black",paddingLeft:"0.75rem"}),input:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black"}),placeholder:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"#6B7280"})}})]}):null}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Price (â‚¦)"}),t.jsx("input",{inputMode:"numeric",placeholder:"e.g. 5000 â†’ type 500000 for â‚¦5,000.00",value:f,onChange:e=>{b(Fe(e.target.value)),parseFloat(Fe(e.target.value))<300?y(!0):y(!1)},className:"w-full h-12 p-3 border-2 rounded-lg font-opensans focus:outline-none focus:border-customOrange"}),t.jsx(F,{children:g?t.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"text-red-600 text-sm",children:"Price must not be less than 300"}):""})]}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Product Condition"}),t.jsx(A,{options:U,value:U.find((e=>e.value===V))||null,onChange:e=>Y((null==e?void 0:e.value)||""),components:Se,className:"w-full text-sm font-opensans",classNamePrefix:"custom-select",placeholder:"Select Condition",isSearchable:!0,styles:{control:e=>({...e,height:"3rem",borderColor:"#D1D5DB",borderRadius:"0.5rem",fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black",paddingLeft:"0.75rem"}),input:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black"}),placeholder:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"#6B7280"})}})]}),t.jsx(F,{children:"Defect:"===V&&t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Defect Description"}),t.jsx("textarea",{value:N,onChange:e=>k(e.target.value),rows:3,className:"w-full p-3 border rounded-lg font-opensans focus:outline-none focus:border-customOrange",placeholder:"Describe the defect..."})]})}),t.jsx(F,{children:"everyday"===L&&t.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Stock Quantity"}),t.jsx("input",{type:"number",min:0,value:j,onChange:e=>v(e.target.value),className:"w-full h-12 p-3 border-2 rounded-lg font-opensans focus:outline-none focus:border-customOrange"})]})}),t.jsx(F,{children:"fashion"===L&&t.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6",children:[t.jsxs("div",{className:"flex items-center justify-between mb-2",children:[t.jsx("label",{className:"font-opensans font-medium text-sm text-black",children:"Variants"}),t.jsx("button",{type:"button",onClick:()=>_((e=>[...e,{color:"",sizes:[{size:"",stock:"",isActive:!0}]}])),className:"text-xs font-opensans font-semibold text-customOrange",children:"+ Add Color"})]}),K.map(((e,s)=>t.jsxs("div",{className:"border border-gray-200 rounded-lg p-3 mb-3",children:[t.jsxs("div",{className:"flex relative items-center gap-2 mb-3",children:["fashion"===L&&t.jsxs(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,delay:.15},className:"flex-1",children:[t.jsx("label",{className:"block text-black mb-1 font-opensans text-sm",children:"Color"}),t.jsx("input",{type:"text",value:e.color,placeholder:"One color per variant",onChange:e=>((e,t)=>{const s=[...K];s[e].color=t,_(s)})(s,e.target.value),className:"w-full h-10 p-2 border rounded-lg font-opensans focus:outline-none focus:border-customOrange"})]}),s>0&&t.jsx("button",{type:"button",onClick:()=>{return e=s,_((t=>t.filter(((t,s)=>s!==e))));var e},className:"text-xl absolute top-0 right-0 font-opensans text-red-600 self-end",children:t.jsx(O,{})})]}),"fashion"===L&&t.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,delay:.3},className:"space-y-2",children:e.sizes.map(((a,n,o)=>{const i=e.sizes.filter(((e,t)=>t!==n)).map((e=>e.size)),l=ee.filter((e=>!i.includes(e.value)));return t.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-black mb-1 font-opensans text-xs",children:"Size"}),t.jsx(A,{options:l,value:{label:a.size,value:a.size},onChange:e=>{ze(s,n,"size",e.value)},placeholder:"Select Size",isSearchable:!0,className:"w-full",classNamePrefix:"custom-select",styles:{control:e=>({...e,height:"3rem",borderColor:"#D1D5DB",borderRadius:"0.5rem",fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black",paddingLeft:"0.75rem"}),input:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"black"}),placeholder:e=>({...e,fontFamily:"Open Sans, sans-serif",fontSize:"1rem",color:"#6B7280"})}})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-black mb-1 font-opensans text-xs",children:"Stock"}),t.jsx("input",{type:"number",min:1,value:a.stock,onChange:e=>ze(s,n,"stock",e.target.value),className:"w-full h-12 p-2 border rounded-lg font-opensans focus:outline-none focus:border-customOrange"})]}),"fashion"===L&&n===o.length-1&&t.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,delay:.6},children:t.jsx("button",{type:"button",onClick:()=>(e=>{const t=[...K];t[e].sizes.push({size:"",stock:"",isActive:!0}),_(t)})(s),className:"text-[13px] font-opensans font-semibold text-customOrange",children:"+ Add Size"})}),"fashion"===L&&o.length>1&&t.jsx(T.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.2,delay:.45},className:"flex items-center justify-end font-semibold "+(n!==o.length-1?"col-span-2":""),children:t.jsx("button",{type:"button",onClick:()=>((e,t)=>{const s=[...K];s[e].sizes.splice(t,1),_(s)})(s,n),className:"text-[13px] font-opensans text-red-600",children:"- Remove size"})})]},n)}))})]},s)))]})}),t.jsxs("div",{className:"mb-4",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Description"}),t.jsx("textarea",{rows:4,value:x,onChange:e=>h(e.target.value),className:"w-full p-3 border rounded-lg font-opensans focus:outline-none focus:border-customOrange"})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("label",{className:"font-opensans font-medium mb-1 text-sm text-black",children:"Tags"}),t.jsx("input",{type:"text",value:de,onChange:e=>me(e.target.value),onKeyDown:e=>{if("Enter"===e.key&&de.trim()){e.preventDefault();const t=de.trim();re.includes(t)||ce((e=>[...e,t])),me("")}"Backspace"===e.key&&!de&&re.length&&ce((e=>e.slice(0,-1)))},placeholder:"Type a tag and press Enter",className:"w-full h-12 p-3 border-2 rounded-lg font-opensans focus:outline-none focus:border-customOrange"}),re.length>0&&t.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:re.map(((e,s)=>t.jsx("span",{className:"px-2 py-1 bg-gray-100 rounded-full text-xs",children:e},`${e}-${s}`)))})]}),t.jsxs("div",{className:"flex items-center justify-end gap-2 mt-6",children:[t.jsx("button",{type:"button",onClick:n,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-opensans text-sm",children:"Cancel"}),t.jsx("button",{type:"button",onClick:()=>{we(!0)},disabled:pe,className:"px-4 py-2 rounded-lg bg-customOrange text-white font-opensans font-semibold text-sm shadow-sm disabled:opacity-60",children:pe?"Savingâ€¦":"Save changes"})]})]}),t.jsx(je,{isOpen:Ne,onClose:()=>we(!1),onConfirm:async()=>{if(ve(!0),!a)return u.error("No product selected."),void ve(!1);try{await I(ke.uid,"product_edit",{},{dayLimit:5})}catch(e){return u.error(e.message),we(!1),ve(!1),void ve(!1)}if(!(m&&f&&0!==se.length&&V&&S&&M&&x))return u.error("Please fill in all required fields."),we(!1),void ve(!1);if("Defect:"===V&&!N)return u.error("Please enter a defect description."),we(!1),void ve(!1);if(f<300)return u.error("Product price must not be less than 300"),we(!1),void ve(!1);if("everyday"===L){if(!j||Number(j)<1)return u.error("Please enter a stock quantity of at least 1."),we(!1),void ve(!1)}else{if(!K.length)return u.error("Please add at least one variant."),we(!1),void ve(!1);for(const[e,t]of K.entries()){if(!t.color)return u.error(`Please enter a color for variant ${e+1}.`),we(!1),void ve(!1);if(!t.sizes.length)return u.error(`Please add at least one size for variant ${e+1}.`),we(!1),void ve(!1);for(const[s,a]of t.sizes.entries()){if(!a.size||!a.stock)return u.error(`Enter size & stock for variant ${e+1}, size ${s+1}.`),we(!1),void ve(!1);if(a.stock<1)return u.error(`Enter a value more than zero for variant ${e+1}, size ${s+1}.`),we(!1),void ve(!1)}}if(H&&!X.length)return u.error("Please add at least one sub-product or turn off variations."),we(!1),void ve(!1)}try{const e=[];for(const a of se)if(null==a?void 0:a.file){const t=z(Te,`${s}/products/${m}/${a.file.name}`);await $(t,a.file),e.push(await R(t))}else(null==a?void 0:a.preview)?e.push(a.preview):"string"==typeof a&&e.push(a);const t="fashion"===L;let o=0,i=[],c=[];if(t){if(i=K.flatMap((e=>{const t=(e.color||"").trim();return e.sizes.map((e=>{const s=Number(e.stock||0);return o+=s,{color:t,size:e.size,stock:s}}))})),X&&X.length>0)for(const a of X){const e=[];for(const n of a.images||[])if(null==n?void 0:n.name){const t=`${s}/products/${m}/subProducts/${a.color}_${a.size}/${n.name}`,o=z(Te,t);await $(o,n),e.push(await R(o))}else e.push(n);const t=Number(a.stock||0);o+=t,c.push({subProductId:a.subProductId,color:a.color.trim(),size:a.size,stock:t,images:e})}}else o=Number(j||0);const p={name:m.trim(),description:x.trim(),price:parseFloat(f),coverImageUrl:e[0]||"",imageUrls:e,isFashion:t,stockQuantity:t?o:Number(j||0),condition:V,category:S,productType:(null==M?void 0:M.value)||"",subType:(null==q?void 0:q.value)||"",tags:re,updatedAt:w(),published:a.published,isDeleted:a.isDeleted,editCount:(a.editCount||0)+1,variants:t?i:[],subProducts:t?X:[]};"Defect:"===V&&N&&(p.defectDescription=N.trim());const h=l(r,"products",a.id);await d(h,p),u.success("Product updated successfully"),n()}catch(t){u.error("Error updating product: "+t.message),we(!1),ve(!1)}finally{ve(!1)}},message:"This will replace your product information with the information you have provided. Proceed?",icon:t.jsx(ue,{className:"w-4 h-4"}),title:"Save Edit Changes",loading:pe})]})},Ce=()=>{var s;const[a,n]=e.useState([]),[o,u]=e.useState(!0),[x,h]=e.useState(null),[f,b]=e.useState("Active"),[y,N]=e.useState(null),[w,k]=e.useState(0),[S,P]=e.useState(!1),[O,F]=e.useState(!1),[A,I]=e.useState(!1),[z,$]=e.useState(!1),[R,oe]=e.useState(!1),[ie,ce]=e.useState(""),[xe,he]=e.useState(!1),[fe,be]=e.useState({}),[ge,ye]=e.useState(!1),[Se,Ce]=e.useState(!1),[Pe,Oe]=e.useState(!1),[Fe,Te]=e.useState(!1),[Ae,Ie]=e.useState(!1),[ze,$e]=e.useState(!1),[Re,Ee]=e.useState(!1),[Be,Ue]=e.useState(!1),[Me,Qe]=e.useState(!1),{vendorData:qe}=e.useContext(E),[We,Ve]=e.useState([]),[Ye,Le]=e.useState(0),[Ge,Ke]=e.useState(null),[_e,He]=e.useState(!1),[Je,Xe]=e.useState(!1),Ze=D(),et=B(),tt=U(),{highlightId:st}=tt.state||{};e.useEffect((()=>{let e;if(y&&S){const t=l(r,"products",y.id);e=c(t,(e=>{e.exists()&&N({id:e.id,...e.data()})}))}return()=>{e&&e()}}),[y,S]),e.useEffect((()=>{const e=C(Ze,(e=>{e?(h(e.uid),at(e.uid)):(X.error("Unauthorized access or no user is signed in."),u(!1),et("/login"))}));return()=>e()}),[Ze,et]),e.useEffect((()=>{}),[]),e.useEffect((()=>{if(!x)return;let e;return(async()=>{e=await at(x)})(),nt(),()=>{e&&e()}}),[x]);const at=e=>{Ie(!0);const t=j(m(r,"products"),v("vendorId","==",e),v("isDeleted","==",!1));return c(t,(async e=>{const t=[],s=se(r);e.docs.forEach((e=>{const a={id:e.id,...e.data()};0===a.stockQuantity&&a.isFeatured&&(s.update(e.ref,{isFeatured:!1}),a.isFeatured=!1),t.push(a)})),s.isEmpty||await s.commit(),n(t),k(t.length),Ie(!1)}))},nt=()=>{const e=j(m(r,"products"),v("isFeatured","==",!0),v("vendorId","==",x));c(e,(e=>{Le(e.size)}))};e.useEffect((()=>{if(y){const e=l(r,"products",y.id),t=c(e,(e=>{e.exists()&&Te(e.data().published)}));return()=>t()}}),[y,x]);const ot=()=>{Ve([]),He((e=>!e)),Xe(!1),Ke(null),$e(!1)},it=()=>{$e(!0),Ve([])},lt=e=>{Ve((t=>t.includes(e)?t.filter((t=>t!==e)):[...t,e]))},rt=()=>{if(0===We.length)return!1;const e=a.filter((e=>We.includes(e.id))),t=e.every((e=>e.published)),s=e.every((e=>!e.published));return"Active"===f&&t||"Drafts"===f&&s};e.useEffect((()=>{st&&!Ae&&setTimeout((()=>{const e=document.getElementById(`product-${st}`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlight-animation"),setTimeout((()=>e.classList.remove("highlight-animation")),2e3))}),300)}),[st,Ae,a]);const ct=async()=>{Ce(!0);try{for(const e of We){const t=l(r,"products",e);await d(t,{published:"Drafts"===f,isFeatured:!1})}X.success("Drafts"===f?"Selected products published successfully.":"Selected products unpublished successfully."),Ve([]),He((e=>!e)),Xe(!1),Ke(null),ce(""),$e(!1),I(!1)}catch(e){X.error("Error changing publish state: "+e.message)}finally{Ce(!1)}},dt=()=>{P(!1),F(!1),Qe(!1),N(null),xe&&(he(!1),be({}))},[ut,mt]=e.useState("null"),pt=`https://mx.shopmythrift.store/product/${ut||"null"}?shared=true`,[xt,ht]=e.useState(!1),ft=async(e,t,s)=>{try{const a=m(r,"vendors",x,"activityNotes");await p(a,{title:e,type:s,note:t,timestamp:new Date})}catch(a){X.error("Error adding activity note: "+a.message)}},bt=()=>{he((e=>!e)),be({})},gt=()=>Object.values(fe).some((e=>(null==e?void 0:e.quantity)&&parseInt(e.quantity,10)>0)),yt=(e,t,s)=>{be((a=>({...a,[t]:{...a[t],[e]:s}})))},jt=(e,t=20)=>e?e.length<=t?e:e.substring(0,t)+"...":"",vt=e=>e.reduce(((e,t)=>(e[t.color]||(e[t.color]=[]),e[t.color].push(t),e)),{}),Nt=a.filter((e=>0===e.stockQuantity)).length,wt=a.filter((e=>"Active"===f?"addDisc"===Ge?e.published&&e.stockQuantity>0&&!e.discountId&&!e.discount:"remDisc"===Ge?e.published&&e.stockQuantity>0&&e.discountId&&e.discount:e.published&&e.stockQuantity>0:"OOS"===f?"addDisc"===Ge?0===e.stockQuantity&&!e.discountId&&!e.discount:"remDisc"===Ge?0===e.stockQuantity&&e.discountId&&e.discount:0===e.stockQuantity:"addDisc"===Ge?!e.published&&!e.discountId&&!e.discount:"remDisc"===Ge?!e.published&&e.discountId&&e.discount:!e.published)).sort(((e,t)=>e.isFeatured===t.isFeatured?0:e.isFeatured?-1:1)),kt=e=>e.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2});return t.jsxs(t.Fragment,{children:[t.jsx(M,{title:"Your Store - My Thrift",description:"Manage your products on My Thrift",url:"https://www.shopmythrift.store/vendor-products"}),t.jsxs("div",{className:"mb-40 mx-3 my-7 flex flex-col justify-center space-y-5 font-opensans bg-white",children:[t.jsx(Q,{}),t.jsx("div",{className:"flex justify-end",children:t.jsxs("div",{className:"relative flex justify-center items-center",children:[_e&&!Je&&!ze&&t.jsxs("div",{className:"absolute top-10 right-[28px] items-center flex flex-col justify-center  w-[300px] h-[104px] p-4 space-y-1 bg-white border shadow-lg rounded-2xl z-50 text-[16px]",children:[t.jsx("div",{className:"flex justify-between w-full items-center py-2 cursor-pointer",onClick:()=>{Ke("manage"),it()},children:t.jsx("p",{className:"font-semibold text-black",children:"Product Management"})}),t.jsx("hr",{className:"w-[250px]"}),t.jsx("div",{className:"flex relative justify-between w-full items-center py-2 cursor-pointer",onClick:()=>{Xe(!0)},children:t.jsx("p",{className:"font-semibold text-black",children:"Manage Discounts"})})]}),Je&&!ze&&t.jsx("div",{className:"absolute top-10 right-[28px] items-center flex flex-col justify-center  w-[300px] h-[52px] p-4 space-y-1 bg-white border shadow-lg rounded-2xl z-50 text-[16px]",children:t.jsxs("div",{className:"flex relative justify-between w-full items-center py-2 cursor-pointer",onClick:()=>{Ke("remDisc"),it()},children:[t.jsx("p",{className:"font-semibold text-black",children:"Remove Discounts"}),t.jsx(me,{className:"text-2xl"})]})}),ze&&We.length<1&&t.jsxs("div",{className:"absolute top-10 right-[28px] items-center flex justify-between  w-[300px] h-[52px] p-4 bg-white border shadow-lg rounded-2xl z-50 text-[16px]",children:[t.jsx("p",{className:"font-semibold text-black",children:"Select a Product"}),t.jsx(q,{})]}),_e?t.jsx("p",{className:"cursor-pointer text-[16px] my-2.5",onClick:ot,children:"Cancel"}):t.jsx("div",{className:"cursor-pointer relative rounded-full w-11 h-11 bg-customOrange bg-opacity-10 flex justify-center items-center",onClick:ot,children:t.jsx(W,{className:"w-6 h-6"})})]})}),t.jsxs("div",{className:"relative bg-customDeepOrange w-full h-c120 rounded-2xl flex flex-col justify-center px-4 py-2",children:[t.jsx("div",{className:"absolute top-0 right-0",children:t.jsx("img",{src:"./Vector.png",alt:"",className:"w-16 h-24"})}),t.jsx("div",{className:"absolute bottom-0 left-0",children:t.jsx("img",{src:"./Vector2.png",alt:"",className:"w-16 h-16"})}),t.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[t.jsxs("p",{className:"text-white text-lg",children:["Active"===f?f:"Drafts"===f?"Drafted":"Out of Stock"," ","Products"]}),t.jsx("p",{className:"text-white text-3xl font-bold",children:Ae?t.jsx(V,{width:38,height:28,className:"opacity-50"}):wt.length})]})]}),t.jsxs("div",{className:"flex justify-center space-x-5 items-center",children:[t.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[t.jsx("p",{className:"text-sm cursor-pointer "+("Active"===f?"text-customOrange":"text-black"),onClick:()=>b("Active"),children:"Active"}),t.jsx("div",{className:"h-1",children:"Active"===f&&t.jsx("hr",{className:"text-customOrange opacity-40  w-11"})})]}),t.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[t.jsxs("p",{className:"text-sm cursor-pointer flex space-x-1 "+("OOS"===f?"text-customOrange":"text-black"),onClick:()=>b("OOS"),children:["Out of Stock"," ",Nt>0&&t.jsx("span",{className:"bg-red-500 text-white text-xs rounded-full flex items-center justify-center w-5 h-5 animate-ping",children:Nt})]}),t.jsx("div",{className:"h-1",children:"OOS"===f&&t.jsx("hr",{className:"text-customOrange opacity-40  w-11"})})]}),t.jsxs("div",{className:"flex flex-col justify-center items-center space-y-3",children:[t.jsx("p",{className:" text-sm cursor-pointer "+("Drafts"===f?"text-customOrange":"text-black"),onClick:()=>b("Drafts"),children:"Drafts"}),t.jsx("div",{className:"h-1",children:"Drafts"===f&&t.jsx("hr",{className:"text-customOrange opacity-40  w-11"})})]})]}),"Active"===f&&(()=>{const e=a.filter((e=>e.discount&&!e.isDeleted&&e.published));return e.length>0&&t.jsx("div",{className:"px-2 py-1 bg-green-50 rounded-lg -translate-y-2 shadow",children:t.jsxs("p",{className:"text-xs font-semibold font-opensans text-green-600",children:["Discount Campaign Active: You are currently offering discounts on ",e.length," product",e.length>1?"s":"",". Your followers will be notifiedðŸŽŠ"]})})})(),t.jsx("div",{className:` ${wt<1&&" justify-center items-center text-center"} ${wt.length>0&&!Ae&&"grid grid-cols-2 gap-4"}`,children:wt&&wt.length>0&&!Ae?wt.map((e=>{var s,a;const o=null==(s=e.subProducts)?void 0:s.some((e=>0===e.stock)),i=null==(a=e.variants)?void 0:a.some((e=>0===e.stock));return t.jsxs("div",{id:`product-${e.id}`,className:"cursor-pointer p-2",onClick:t=>ze?lt(e.id):(e=>{N(e),mt(e.id),P(!0)})(e),children:[t.jsxs("div",{className:`\n        relative w-44 h-44 rounded-xl bg-customSoftGray overflow-hidden\n        ${st===e.id?"ring-4 ring-customOrange animate-pulse":""}\n      `,children:[(o||i)&&"OOS"!==f&&t.jsx("div",{className:"absolute bottom-2 right-2 w-4 h-4 bg-customOrange rounded-full animate-ping"}),ze?t.jsx("div",{onClick:t=>{t.stopPropagation(),lt(e.id)},className:"absolute top-2 left-2",children:We.includes(e.id)?t.jsx(Y,{className:"text-customOrange w-6 h-6"}):t.jsx(L,{className:"text-customOrange w-6 h-6"})}):"Active"===f&&(!e.isFeatured&&Ye<4||e.isFeatured)&&t.jsx("div",{onClick:t=>{t.stopPropagation(),(async e=>{const t=(new Date).getTime();if(e.isFeatured){const s=e.pinnedAt||0;if(t-s<432e5)return void X.error("You cannot unfeature a product within 12 hours of featuring it.")}try{const s=l(r,"products",e.id),a=!e.isFeatured;await d(s,{isFeatured:a,...a&&{pinnedAt:t}}),n((s=>s.map((s=>s.id===e.id?{...s,isFeatured:a,pinnedAt:a?t:null}:s)))),Le((e=>a?e+1:e-1)),a?(await ft("Product Starred â­",`You've made ${e.name} one of your featured products! This will be part of the first products customers see in your store.`,"Product Update"),X.success("Product featured successfully.")):X.success("Product unfeatured successfully."),nt()}catch(s){X.error("Error Featuring/unfeaturing product: "+s.message)}})(e)},className:"absolute top-2 right-2 bg-white rounded-full p-1",children:e.isFeatured?t.jsx(G,{className:"text-customOrange w-5 h-5"}):t.jsx(K,{className:"text-customOrange w-5 h-5"})}),!ze&&e.discount&&t.jsx("div",{className:"absolute top-2 left-2 flex items-center",children:e.discount.discountType.startsWith("personal-freebies")?t.jsx("div",{className:"bg-customPink text-customOrange text-sm px-2 py-1 font-medium rounded-md",children:jt(e.discount.freebieText)}):t.jsxs("div",{className:"bg-customPink text-customOrange text-sm font-medium px-2 py-1 rounded-md",children:["-",e.discount.percentageCut,"%"]})}),t.jsx("img",{src:e.coverImageUrl,alt:e.name,className:"w-full h-full object-cover rounded-xl bg-customSoftGray"})]}),t.jsxs("div",{className:"mt-2 flex flex-col space-y-1",children:[t.jsx("div",{className:"flex",children:t.jsx("p",{className:"text-xs font-semibold font-opensans text-black truncate w-32",children:e.name})}),t.jsx("div",{className:"flex justify-between",children:t.jsxs("p",{className:"text-xs font-semibold font-opensans text-black",children:["Total Stock: ",e.stockQuantity]})}),t.jsxs("p",{className:"text-xs font-medium font-opensans text-black",children:["â‚¦",kt(e.price)]}),!e.published&&t.jsx("p",{className:"text-xs font-semibold font-opensans text-customOrange",children:"Unpublished Product"}),e.discount&&t.jsx("p",{className:"text-xs font-opensans font-semibold text-customRichBrown",children:e.discount.discountType.startsWith("inApp")?"In-App Discount":"personal-monetary"===e.discount.discountType?"Personal Monetary Discount":`Freebie: ${jt(e.discount.freebieText)}`})]})]},e.id)})):"Active"!==f||Ae?"OOS"!==f||Ae?Ae?t.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:120,height:12}),t.jsx(V,{width:105,height:12}),t.jsx(V,{width:70,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:78,height:12}),t.jsx(V,{width:135,height:12}),t.jsx(V,{width:98,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:98,height:12}),t.jsx(V,{width:155,height:12}),t.jsx(V,{width:66,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:78,height:12}),t.jsx(V,{width:135,height:12}),t.jsx(V,{width:98,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:88,height:12}),t.jsx(V,{width:105,height:12}),t.jsx(V,{width:90,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:68,height:12}),t.jsx(V,{width:145,height:12}),t.jsx(V,{width:88,height:12})]}),t.jsxs("div",{className:"flex flex-col space-y-2",children:[t.jsx(V,{width:176,height:176}),t.jsx(V,{width:70,height:12}),t.jsx(V,{width:115,height:12}),t.jsx(V,{width:67,height:12})]})]}):!Ae&&t.jsx("p",{className:"text-xs mt-24 font-opensans",children:"ðŸ“ You have no saved draft products yet. Start a new listing and save it as a draft anytime!"}):t.jsx("p",{className:"text-xs font-opensans mt-24",children:"ðŸ“¦ You currently have no items marked as out of stock."}):t.jsx("p",{className:"text-xs font-opensans mt-24",children:"ðŸ“­ Your store has no active products yet. Upload items to start attracting customers!"})})]}),!ze&&t.jsx("button",{onClick:()=>{F(!0)},className:`fixed bottom-24 right-5 flex justify-center items-center ${(null==qe?void 0:qe.isApproved)?"bg-customOrange":"bg-customOrange opacity-35 cursor-not-allowed"} text-white rounded-full w-11 h-11 shadow-lg focus:outline-none`,disabled:!(null==qe?void 0:qe.isApproved),children:t.jsx("span",{className:"text-3xl",children:t.jsx(_,{})})}),ze&&We.length>0&&"manage"===Ge?t.jsxs(T.div,{initial:{y:"100%"},animate:{y:0},exit:{x:"100%"},transition:{type:"spring",stiffness:100,damping:20},className:`fixed bottom-0 z-[1001] flex px-4 ${rt()?"justify-between":"justify-center"} py-3 bg-white text-white w-full h-[94px] shadow-lg focus:outline-none`,children:[rt()&&t.jsx("p",{className:"text-lg font-semibold font-opensans text-customRichBrown cursor-pointer",children:"Active"===f?t.jsx("p",{className:"text-lg font-semibold text-customRichBrown",onClick:()=>{ce("unpublish"),I(!0)},children:"Unpublish"}):t.jsx("p",{className:"text-lg font-semibold font-opensans text-customRichBrown cursor-pointer",onClick:()=>{ce("publish"),I(!0)},children:"Publish"})}),t.jsx("p",{className:"text-lg font-semibold font-opensans text-customRichBrown mb-4 cursor-pointer",onClick:()=>(ce("bulkDelete"),void I(!0)),children:"Delete"})]}):ze&&We.length>0&&t.jsx(T.div,{initial:{y:"100%"},animate:{y:0},exit:{x:"100%"},transition:{type:"spring",stiffness:100,damping:20},className:"fixed bottom-0 z-[1001] flex px-4 justify-center py-3 bg-white text-white w-full h-[94px] shadow-lg focus:outline-none",children:t.jsx("p",{className:"text-lg font-semibold font-opensans text-customRichBrown",children:"addDisc"===Ge?t.jsx("p",{className:"text-lg font-semibold text-customRichBrown cursor-pointer",onClick:()=>{ce("addDiscount"),Ue(!0)},children:"Add Discount"}):"remDisc"===Ge&&t.jsx("p",{className:"text-lg font-semibold font-opensans text-customRichBrown cursor-pointer",onClick:()=>{ce("removeDiscount"),I(!0)},children:"Remove Discount"})})}),y&&t.jsx(ve,{isOpen:S,onClose:dt,onDel:()=>{ce("delete"),I(!0)},children:t.jsxs("div",{children:[y.coverImageUrl&&t.jsx("img",{src:y.coverImageUrl,alt:y.name,className:"w-full h-72 p-1 object-cover bg-customSoftGray rounded-md mb-3"}),t.jsx("div",{className:"flex overflow-x-auto space-x-4 mb-3 snap-x snap-mandatory",children:y.imageUrls&&y.imageUrls.length>0&&y.imageUrls.map(((e,s)=>t.jsx("img",{src:e,alt:`Product ${s+1}`,className:"flex-shrink-0 w-24 h-24 object-cover bg-customSoftGray rounded-md mr-2 snap-center"},s)))}),t.jsxs("div",{className:"flex items-center mb-4 justify-between",children:[t.jsx("p",{className:"text-lg text-black font-opensans font-semibold ",children:y.name}),y.published&&t.jsx("button",{className:"text-white cursor-not-allowed",onClick:async()=>{if(!xt)try{await navigator.clipboard.writeText(pt),ht(!0),setTimeout((()=>ht(!1)),3e3)}catch(e){X.error("Failed to copy!")}},children:xt?t.jsx(J,{className:"text-2xl text-customOrange"}):t.jsx(H,{className:"text-2xl text-customOrange"})})]}),t.jsxs("div",{className:"p-3 mb-4 flex flex-col  bg-gray-50  rounded-lg w-full  justify-between space-y-3",children:[t.jsxs("p",{className:"text-black font-semibold  font-opensans text-sm",children:["Price:"," ",t.jsxs("span",{className:"font-normal",children:["â‚¦",kt(y.price)]})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Product Category:"," ",t.jsx("span",{className:"font-normal",children:y.category})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Quantity:"," ",t.jsx("span",{className:`${y.stockQuantity<1&&"text-red-500"}`,children:y.stockQuantity>0?y.stockQuantity:"Out of stock"})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),t.jsxs("p",{className:"text-black font-semibold  font-opensans text-sm",children:["Product Type:"," ",t.jsx("span",{className:"font-normal",children:y.productType})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Product Condition:"," ",t.jsx("span",{className:"font-normal",children:y.condition})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Product Sub-type:"," ",t.jsx("span",{className:"font-normal",children:y.subType})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("div",{className:"text-black font-opensans font-semibold text-sm",children:[t.jsx("p",{className:"text-black font-semibold text-sm mb-2",children:"Product Description"})," ",t.jsx("p",{className:"text-black font-normal text-sm leading-6",children:y.description})]}),"Defect:"===y.condition&&t.jsxs(t.Fragment,{children:[" ",t.jsxs("p",{className:"text-red-400 font-opensans font-semibold text-sm",children:["Defect Description:"," ",t.jsx("span",{className:"font-normal",children:y.defectDescription})]}),t.jsx("hr",{className:"text-customOrange opacity-40"})]})]}),y&&y.discount&&t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("h3",{className:"text-lg font-semibold font-opensans mb-2",children:"Product Discount Details"}),t.jsxs("div",{className:"flex justify-between space-x-1 items-center text-red-600 mb-2 font-medium font-opensans text-base cursor-pointer",onClick:()=>$(!0),children:[t.jsx("div",{children:"Disable"}),t.jsx(me,{className:"text-2xl"})]})]}),y.discount?t.jsxs("div",{className:"flex items-center  justify-between py-1 px-2 bg-green-100 rounded-full",children:[t.jsx("span",{className:"text-sm font-semibold font-opensans text-green-800",children:y.discount.discountType.startsWith("inApp")?"Inâ€‘App Discount":"personal-monetary"===y.discount.discountType?"Personal Monetary Discount":"personal-freebies"===y.discount.discountType?`Freebie: ${jt(y.discount.freebieText)}`:""}),t.jsx("span",{className:"bg-green-600 text-white text-xs px-2 py-1 rounded-full",children:"Active"})]}):t.jsxs("div",{className:"flex items-center font-opensans justify-between p-2 bg-gray-200 rounded-full",children:[t.jsx("span",{className:"text-sm font-semibold  text-gray-600",children:"Discount"}),t.jsx("span",{className:"bg-gray-400 text-white text-xs px-2 py-1 rounded-full",children:"Inactive"})]}),(y.discount.discountType.startsWith("inApp")||"personal-monetary"===y.discount.discountType)&&t.jsx(t.Fragment,{children:t.jsxs("div",{className:"p-3 mb-4 flex w-full bg-gray-50  rounded-lg mt-3 flex-col justify-between space-y-3",children:[t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Initial Price:",t.jsxs("span",{className:"font-normal",children:[" ","â‚¦",kt(y.discount.initialPrice)]})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Discount Price:",t.jsxs("span",{className:"font-normal",children:[" ","â‚¦",kt(y.discount.discountPrice)]})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Percentage:",t.jsxs("span",{className:"font-normal",children:[" ",y.discount.percentageCut,"%"]})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Amount Off:",t.jsxs("span",{className:"font-normal",children:[" ","â‚¦",kt(y.discount.subtractiveValue)]})]})]})})]}),(null==(s=null==y?void 0:y.variants)?void 0:s.length)>1&&t.jsx("p",{className:"text-lg font-opensans text-black font-semibold mb-2",children:y.variants.length-1==1?"Product Variant":"Product Variants"}),t.jsx("div",{className:"px-2 ",children:t.jsx("div",{className:"flex w-full font-opensans overflow-x-auto space-x-4 snap-x snap-mandatory",children:(e=>{const s=vt(e);return Object.entries(s).map((([e,s],a)=>{const n=s.some((e=>0===e.stock));return t.jsxs("div",{className:"bg-customSoftGray p-3 rounded-lg relative",children:[n&&"OOS"!==f&&t.jsx("div",{className:"absolute top-2 right-2 w-3 h-3 bg-customOrange rounded-full animate-ping"}),t.jsxs("p",{className:"text-black font-semibold text-sm mb-2",children:["Color: ",e]}),t.jsxs("table",{className:"w-custVCard text-left border-collapse",children:[t.jsx("thead",{children:t.jsxs("tr",{className:"space-x-8",children:[t.jsx("th",{className:"text-black font-semibold text-sm pb-2 border-b border-customOrange border-opacity-40",children:"Size"}),t.jsx("th",{className:"text-black text-right font-semibold text-sm pb-2 border-b border-customOrange border-opacity-40",children:"Quantity"})]})}),t.jsx("tbody",{children:s.map((e=>{var s;const a=`${e.color}-${e.size}`;return t.jsx(t.Fragment,{children:t.jsxs("tr",{className:"space-x-8",children:[t.jsx("td",{className:"py-2 text-sm font-normal border-b border-customOrange border-opacity-40",children:e.size}),t.jsx("td",{className:"py-2 text-sm text-right font-normal border-b border-customOrange border-opacity-40 "+(e.stock<1?"text-red-500":""),children:xe?t.jsx("input",{type:"number",className:"border text-right no-spinner p-1 ml-2 rounded-[10px] focus:outline-customOrange h-6 w-24",value:(null==(s=fe[a])?void 0:s.quantity)||"",onChange:e=>{const t=e.target.value;t>=0?yt("quantity",a,t):X.error("Please enter a non-negative value.")}}):e.stock>0?e.stock:"Out of stock"})]},a)})}))})]})]},a)}))})(y.variants||[])})}),y.subProducts&&y.subProducts.length>0&&t.jsx("p",{className:"text-lg font-opensans text-black font-semibold my-2",children:(y.subProducts.length,"Sub-Products")}),t.jsx("div",{className:"w-full",children:y.subProducts&&y.subProducts.map((e=>{var s;return t.jsxs("div",{className:"flex items-center relative",children:[0===e.stock&&"OOS"!==f&&t.jsx("div",{className:"absolute bottom-6 right-2 w-3 h-3 bg-customOrange rounded-full animate-ping"}),t.jsx("div",{className:"w-28 h-28",children:t.jsx("img",{src:e.images,alt:"",className:"object-cover bg-customSoftGray rounded-md w-full h-24"})}),t.jsxs("div",{className:"px-3 mb-4 flex w-full flex-col justify-between space-y-3 ",children:[t.jsxs("p",{className:"text-black font-semibold font-opensans text-sm",children:["Color: ",t.jsx("span",{className:"font-normal",children:e.color})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),t.jsxs("p",{className:"text-black font-opensans font-semibold text-sm",children:["Size: ",t.jsxs("span",{className:"font-normal",children:[e.size," "]})]}),t.jsx("hr",{className:"text-customOrange opacity-40   "}),xe?t.jsxs(t.Fragment,{children:[t.jsx("p",{className:"text-customOrange text-sm",children:"Stock Quantity"}),t.jsx("input",{type:"number",className:"border no-spinner p-1 ml-2 rounded-[10px] focus:outline-customOrange",value:(null==(s=fe[e.subProductId])?void 0:s.quantity)||"",onChange:t=>{t.target.value>=0?yt("quantity",e.subProductId,t.target.value):X.error("Please enter a non-negative value.")}})]}):t.jsxs("p",{className:"font-semibold text-sm "+(0===e.stock?"text-red-500":"text-black"),children:["Quantity:"," ",t.jsx("span",{className:"font-normal",children:e.stock})]})]})]},e.subProductId)}))}),t.jsx("hr",{className:"border-gray-100  mt-4"}),y&&t.jsxs("div",{className:"text-lg flex items-center space-x-1 text-customOrange mt-4 mb-2 font-medium font-opensans",children:[t.jsx("div",{children:"Actions"})," ",t.jsx("span",{children:t.jsx(Z,{className:"text-2xl"})})]}),y&&t.jsxs("div",{className:"p-3 my-4 flex flex-col  bg-gray-50  rounded-lg w-full font-opensans justify-between space-y-3",children:[!y.discount&&t.jsxs("div",{className:"flex space-x-1 items-center justify-between font-medium text-base cursor-pointer text-black",onClick:()=>Ee(!0),children:[t.jsx("div",{children:"Start a discount"}),t.jsx(de,{className:"text-2xl text-customOrange"})]}),!(y.stockQuantity<1)&&t.jsx("hr",{className:"text-customOrange opacity-40"}),!(y.stockQuantity<1)&&t.jsxs("div",{className:"flex space-x-1 justify-between items-center font-medium text-base cursor-pointer text-black",onClick:()=>(ce("markSoldOut"),void I(!0)),children:[t.jsx("div",{children:'Mark As "Sold-Out"'}),t.jsx(pe,{className:"text-2xl text-customOrange"})]}),!(y.stockQuantity<1)&&t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("div",{className:"flex relative space-x-1 justify-between items-center font-medium text-base cursor-pointer text-black "+(y.editCount>0?"text-gray-400":""),onClick:()=>{0===(y.editCount??0)?Qe(!Me):(ce("editUnavailable"),I(!0))},children:[t.jsx("div",{children:"Edit Product"}),t.jsx(ue,{className:"text-2xl "+(y.editCount>0?"text-gray-400":"text-customOrange")})]}),t.jsx("hr",{className:"text-customOrange opacity-40"}),t.jsxs("div",{className:"flex justify-between",children:[t.jsx("p",{className:"text-black font-opensans text-base font-medium",children:"Unpublish/Publish Product"}),t.jsx(Ne,{itemId:y.id,initialIsOn:Fe,vendorId:x,name:y.name})]})]}),t.jsx("div",{className:"sticky bottom-0 left-0 w-full py-8 px-2 translate-y-7 bg-gradient-to-t from-white via-white/95 to-transparent z-10",children:xe?t.jsxs("div",{className:"flex justify-between items-center space-x-4",children:[t.jsx(T.button,{onClick:async()=>{ye(!0);try{const e=y.variants||[],t=y.subProducts||[],s=l(r,"products",y.id),a=e.map((e=>{var t;const s=`${e.color}-${e.size}`,a=parseInt(null==(t=fe[s])?void 0:t.quantity,10);return isNaN(a)?e:{...e,stock:a}})),n=t.map((e=>{var t;const s=parseInt(null==(t=fe[e.subProductId])?void 0:t.quantity,10);return isNaN(s)?e:{...e,stock:s}})),o=a.reduce(((e,t)=>e+(t.stock||0)),0)+n.reduce(((e,t)=>e+(t.stock||0)),0);await d(s,{variants:a,subProducts:n,stockQuantity:o}),X.success("Product restocked successfully."),await ft("Restocked Product ðŸ”„",`You restocked ${y.name}! Customers can now buy more of this product from your store.`,"Product Update"),he(!1),be({})}catch(e){X.error("Error restocking product: "+e.message)}finally{ye(!1)}},whileTap:{scale:1.1},className:`flex glow-button justify-center items-center w-full h-12 bg-customOrange text-white font-opensans font-semibold rounded-full ${!gt()&&"opacity-25"}`,disabled:!gt(),children:ge?t.jsx(g,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Submit Restock"}),t.jsx(T.button,{whileTap:{scale:1.1},onClick:bt,className:"glow-button w-full h-12 font-opensans bg-customSoftGray font-semibold rounded-full text-customRichBrown border border-customRichBrown",children:"Cancel"})]}):t.jsx(T.button,{whileTap:{scale:1.1},onClick:bt,className:"glow-button w-full h-12 bg-customOrange text-white font-opensans font-semibold rounded-full",children:"Restock Item"})})]})}),y&&Re&&t.jsx(we,{isOpen:Re,onRequestClose:()=>{Ee(!1)},product:y}),O&&t.jsx(le,{isOpen:O,onClose:dt,children:t.jsx(re,{vendorId:x,closeModal:dt,onProductAdded:()=>at(x)})}),Me&&t.jsx(De,{selectedProduct:y,vendorId:x,onClose:()=>Qe(!1)}),z&&t.jsx(je,{isOpen:z,onClose:dt,onConfirm:async()=>{oe(!0);try{const e=l(r,"products",y.id);let t=y.discount.initialPrice;"personal-freebies"!==y.discount.discountType?await d(e,{price:t,discount:null,discountId:null}).then(n((e=>e.map((e=>e.id===y.id?{...e,price:t,discount:null,discountId:null}:e))))):await d(e,{discount:null,discountId:null}).then(n((e=>e.map((e=>e.id===y.id?{...e,discount:null,discountId:null}:e))))),await ft("Discount Disabled âŒ",`You've disabled the discount on ${y.name}. Customers can now only buy this at the original price.`,"Product Update"),X.success("Discount disabled successfully."),oe(!1),nt()}catch(e){X.error("Error disabling discount: "+e.message),oe(!1)}$(!1),oe(!1)},message:"Are you sure you want to disable this discount?",icon:t.jsx(me,{className:"w-4 h-4"}),title:"Disable Product Discount",loading:R}),A&&("delete"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:async()=>{Ce(!0);try{const e=y.id;await d(l(r,"products",e),{isDeleted:!0,published:!1});const t=l(r,"vendors",x);await d(t,{productIds:ae(e)}),await ft("Deleted Product ðŸ—‘",`You removed ${y.name} from your store! This product no longer exists in your store and customers that have it in their carts will be notified.`,"Product Update"),n(a.filter((e=>e.id!==y.id))),X.success("Product deleted successfully."),dt()}catch(e){X.error("Error deleting product: "+e.message)}finally{Ce(!1),ce(""),I(!1),at(x)}},message:"Are you sure you want to delete this product?",icon:t.jsx(i,{className:"w-4 h-4"}),title:"Delete Product",loading:Se}):"bulkDelete"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:async()=>{Ce(!0);const e=l(r,"vendors",x),t=We.length;try{for(const t of We){const s=l(r,"products",t);await d(s,{published:!1,isDeleted:!0}),await d(e,{productIds:ae(t)})}X.success("Selected products deleted successfully."),Ve([]),He((e=>!e)),Xe(!1),Ke(null),$e(!1),I(!1),ce(""),await ft(`Deleted ${t>1?"Products":"a Product"}ðŸ—‘`,`You removed ${t} product${t>1?"s":""} from your store! ${t>1?"These products":"This product"} no longer exist in your store and customers that have ${t>1?"them":"it"} in their carts will be notified.`,"Product Update")}catch(s){X.error("Error deleting products: "+s.message)}finally{Ce(!1)}},message:"Are you sure you want to delete these products?",icon:t.jsx(i,{className:"w-4 h-4"}),title:"Delete Product(s)",loading:Se}):"publish"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:ct,message:"Are you sure you want to publish these products?",icon:t.jsx(ee,{className:"w-4 h-4"}),title:"Publish Products",loading:Se}):"unpublish"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:ct,message:"Are you sure you want to unpublish these products?",icon:t.jsx(te,{className:"w-4 h-4"}),title:"Unpublish Products",loading:Se}):"editUnavailable"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),message:"Cannot edit a product more than once at base level...",loading:Pe}):"markSoldOut"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:async()=>{Oe(!0);try{const e=y.variants||[],t=y.subProducts||[],s=l(r,"products",y.id),a=e.map((e=>({...e,stock:0}))),n=t.map((e=>({...e,stock:0})));await d(s,{variants:a,subProducts:n,stockQuantity:0}),X.success('Product is now marked as "Sold Out"'),await ft("Product Sold Out ðŸš«",`You've marked ${y.name} as "Sold Out". Customers will not be able to buy this product until it is restocked.`,"Product Update")}catch(e){X.error("Error marking as Sold Out: "+e.message)}finally{Oe(!1),I(!1),ce("")}},message:'Marking as "Sold-Out" will set the stock of all variants and sub-products to zero. Are you sure you want to proceed?',icon:t.jsx(pe,{className:"w-4 h-4"}),title:"Mark as Sold-Out",loading:Pe}):"removeDiscount"===ie?t.jsx(je,{isOpen:A,onClose:()=>I(!1),onConfirm:async()=>{if(0===We.length)return;Ce(!0);const e=[];try{for(const t of We){const s=l(r,"products",t),a=await ne(s);if(!a.exists())continue;const n=a.data(),o=n.discount,i=null==o?void 0:o.initialPrice;"personal-freebies"!==(null==o?void 0:o.discountType)?(await d(s,{price:i,discount:null,discountId:null}),e.push({...n,id:t,price:i,discount:null,discountId:null})):(await d(s,{discount:null,discountId:null}),e.push({...n,id:t,discount:null,discountId:null}))}await ft("Discounts Disabled âŒ","You've disabled the discount on some products. Customers can now only buy them at their original prices.","Product Update"),X.success("Discounts removed from selected product(s)."),Ve([]),ce(""),He((e=>!e)),Xe(!1),Ke(null),$e(!1),I(!1)}catch(t){X.error("Error in bulk discount removal: "+t.message)}finally{Ce(!1)}},message:"Are you sure you want to remove discount from the selected product(s)?",icon:t.jsx(me,{className:"w-4 h-4"}),title:"Remove Discount",loading:Se}):null),"addDiscount"===ie&&t.jsx(ke,{isOpen:Be,onRequestClose:()=>{Ue(!1),ce("")},product:We})]})};export{Ce as default};
