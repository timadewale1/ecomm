import{R as e,r as t,h as r,k as a,bh as n,_ as i,j as o,S as s,a2 as c,cJ as l,cK as u,cL as d,cM as f,ao as p,ap as h,cN as m,y as v,d as g,a as y,ab as w}from"./index-CvIXhaMv.js";var x=function(e){return"object"==typeof e&&null!==e},b=function(t){var r=t.value,a=void 0===r?"":r,n=t.numInputs,i=void 0===n?4:n,o=t.onChange,s=t.onPaste,c=t.renderInput,l=t.shouldAutoFocus,u=void 0!==l&&l,d=t.inputType,f=void 0===d?"text":d,p=t.renderSeparator,h=t.placeholder,m=t.containerStyle,v=t.inputStyle,g=t.skipDefaultStyles,y=void 0!==g&&g,w=e.useState(0),b=w[0],P=w[1],N=e.useRef([]),j=function(){return a?a.toString().split(""):[]},T="number"===f||"tel"===f;e.useEffect((function(){N.current=N.current.slice(0,i)}),[i]),e.useEffect((function(){var e;u&&(null===(e=N.current[0])||void 0===e||e.focus())}),[u]);var k=function(){if("string"==typeof h){if(h.length===i)return h;h.length}},A=function(e){return(T?!isNaN(Number(e)):"string"==typeof e)&&1===e.trim().length},O=function(e){var t=e.target.value;A(t)&&(V(t),E(b+1))},S=function(e){var t=e.nativeEvent,r=e.target.value;if(!A(r)){if(r.length===i)r.split("").some((function(e){return!A(e)}))||(R(r.split("")),E(i-1));null===t.data&&"deleteContentBackward"===t.inputType&&(e.preventDefault(),V(""),E(b-1)),e.target.value=""}},D=function(){P(b-1)},C=function(e){var t=j();[e.code,e.key].includes("Backspace")?(e.preventDefault(),V(""),E(b-1)):"Delete"===e.code?(e.preventDefault(),V("")):"ArrowLeft"===e.code?(e.preventDefault(),E(b-1)):"ArrowRight"===e.code||e.key===t[b]?(e.preventDefault(),E(b+1)):"Spacebar"!==e.code&&"Space"!==e.code&&"ArrowUp"!==e.code&&"ArrowDown"!==e.code||e.preventDefault()},E=function(e){var t,r,a=Math.max(Math.min(i-1,e),0);N.current[a]&&(null===(t=N.current[a])||void 0===t||t.focus(),null===(r=N.current[a])||void 0===r||r.select(),P(a))},V=function(e){var t=j();t[b]=e[0],R(t)},R=function(e){var t=e.join("");o(t)},I=function(e){var t;e.preventDefault();var r=j(),a=b,n=e.clipboardData.getData("text/plain").slice(0,i-b).split("");if(!T||!n.some((function(e){return isNaN(Number(e))}))){for(var o=0;o<i;++o)o>=b&&n.length>0&&(r[o]=null!==(t=n.shift())&&void 0!==t?t:"",a++);E(a),R(r)}};return e.createElement("div",{style:Object.assign({display:"flex",alignItems:"center"},x(m)&&m),className:"string"==typeof m?m:void 0,onPaste:s},Array.from({length:i},(function(e,t){return t})).map((function(t){var r,a,n;return e.createElement(e.Fragment,{key:t},c({value:null!==(r=j()[t])&&void 0!==r?r:"",placeholder:null!==(n=null===(a=k())||void 0===a?void 0:a[t])&&void 0!==n?n:void 0,ref:function(e){return N.current[t]=e},onChange:O,onFocus:function(e){return function(e){return function(t){P(t),e.target.select()}}(e)(t)},onBlur:D,onKeyDown:C,onPaste:I,autoComplete:"off","aria-label":"Please enter OTP character ".concat(t+1),style:Object.assign(y?{}:{width:"1em",textAlign:"center"},x(v)?v:{}),className:"string"==typeof v?v:void 0,type:f,inputMode:T?"numeric":"text",onInput:S},t),t<i-1&&("function"==typeof p?p(t):p))})))};const P=()=>{const[e,x]=t.useState(""),[P,N]=t.useState(!1),[j,T]=t.useState(!1),[k,A]=t.useState(30),O=r(),S=a(),{vendorData:D,mode:C}=S.state||{},E=n();t.useEffect((()=>{let e;return k>0&&(e=setTimeout((()=>{A(k-1)}),1e3)),()=>clearTimeout(e)}),[k]);const V=()=>{window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),delete window.recaptchaVerifier),window.recaptchaVerifier=new l(E,"recaptcha-container-verify",{size:"invisible",callback:()=>{},"expired-callback":()=>{i.error("reCAPTCHA expired. Please try again.")}})};t.useEffect((()=>(V(),()=>{window.recaptchaVerifier&&(window.recaptchaVerifier.clear(),delete window.recaptchaVerifier)})),[]),t.useEffect((()=>{D||(i.error("No vendor data found. Please start the sign-up process again."),O("/vendor-signup"))}),[D,O]);const R=async e=>{const t=new Date,r={uid:e,firstName:D.firstName,lastName:D.lastName,email:D.email,phoneNumber:D.phoneNumber,role:"vendor",profileComplete:!1,createdSince:t,lastUpdate:t,isApproved:!1};try{await w(g(y,"vendors",e),r)}catch(a){i.error("Failed to save vendor information.")}},I=e=>{switch(e.code){case"auth/email-already-in-use":i.error("This email is already registered. Please log in.");break;case"auth/invalid-verification-code":i.error("You have entered a wrong OTP code. Please try again.");break;case"auth/phone-number-already-exists":case"auth/credential-already-in-use":i.error("This phone number is already registered. Please log in.");break;case"auth/weak-password":i.error("Password should be at least 6 characters.");break;case"auth/invalid-email":i.error("Invalid email format.");break;default:i.error("Error signing up vendor: "+e.message)}};return o.jsxs(o.Fragment,{children:[o.jsx(s,{title:"Verify OTP - My Thrift",description:"Verify OTP code for your My Thrift account",url:"https://www.shopmythrift.store/vendor-verify-otp"}),o.jsxs("div",{className:"h-screen bg-white p-3 flex flex-col justify-between",children:[o.jsxs("div",{className:"text-left mt-20",children:[o.jsx("h1",{className:"text-3xl font-bold font-opensans text-customRichBrown mb-2",children:"Enter OTP Code"}),o.jsxs("p",{className:"text-gray-600 font-opensans text-sm ",children:["A code that was sent to"," ",o.jsx("span",{className:"text-black font-opensans",children:null==D?void 0:D.phoneNumber})]})]}),o.jsxs("div",{className:"mb-28 flex justify-center items-center flex-col",children:[o.jsx(b,{value:e,onChange:e=>x(e),numInputs:6,renderInput:(e,r)=>t.createElement("input",{...e,key:r,style:{width:"3rem",height:"3rem",margin:"0.5rem",fontSize:"1.5rem",borderRadius:"8px",border:"none",boxShadow:"0 0 0 1px #ccc",outline:"none",textAlign:"center",lineHeight:"3rem",verticalAlign:"middle",padding:"0"},onFocus:e=>e.target.style.boxShadow="0 0 0 2px #E26A2C",onBlur:e=>e.target.style.boxShadow="0 0 0 1px #ccc"})}),o.jsx("p",{onClick:async()=>{if(!(k>0||j)){T(!0);try{V();const e=window.recaptchaVerifier,t=await u(E,D.phoneNumber,e);window.confirmationResult=t,i.success("OTP resent successfully!"),A(30)}catch(e){i.error("Failed to resend OTP: Timeout, Please restart proccess.")}finally{T(!1)}}},className:"mt-4 text-sm font-opensans  font-semibold "+(k>0||j?"text-gray-400 cursor-not-allowed":"text-customOrange cursor-pointer"),children:j?"Resending...":k>0?`Resend in ${k}s`:"Resend"})]}),o.jsx("div",{id:"recaptcha-container-verify",style:{display:"none"}}),o.jsx("div",{className:"mb-6",children:o.jsx("button",{onClick:async()=>{if(!e||e.length<6)i.error("Please enter the OTP before proceeding.");else{N(!0);try{const t=window.confirmationResult;if(!t)return i.error("Your OTP session has expired. Please resend the OTP."),void N(!1);const r=d.credential(t.verificationId,e),a=(await f(E,r)).user;if("signup"===C){const e=p.credential(D.email,D.password);await h(a,e);const t={url:"https://shopmythrift.store/confirm-email",handleCodeInApp:!0};await m(a,t),i.success("Account created successfully. A verification email has been sent to your email. Please verify your email and log in."),await R(a.uid),i.success("Account created successfully. Please verify your email and log in."),O("/vendorlogin")}else if("login"===C){const e=await v(g(y,"vendors",a.uid));if(e.exists()){const t=e.data();if(t.isDeactivated)return i.error("Your vendor account is deactivated. Please contact support."),void(await E.signOut());t.profileComplete?(i.success("Login successful!"),O("/vendordashboard")):O("/complete-profile")}else i.error("Vendor data not found"),await E.signOut()}}catch(t){"auth/invalid-verification-code"===t.code?i.error("You have entered a wrong OTP code. Please try again."):I(t)}finally{N(!1)}}},disabled:P,className:"w-full h-12 rounded-full bg-customOrange font-opensans text-white font-medium text-sm hover:bg-orange-600 flex items-center justify-center",children:P?o.jsx(c,{width:"25",height:"25",strokeColor:"white",strokeWidth:"4"}):"Verify OTP"})})]})]})};export{P as default};
