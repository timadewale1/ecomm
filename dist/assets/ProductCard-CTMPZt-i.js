import{u as e,r as t,a as s,bb as i,j as a,au as n,e as o,O as r,h as c,bI as d,aZ as l,Q as m,a9 as u,bj as x}from"./index-B6_tP4YQ.js";import{c as p,d as f}from"./index-BzTvhx-M.js";import{h}from"./userWriteHandler-DCDkCU98.js";const v=(e,t="")=>{const s="https://firebasestorage.googleapis.com/v0/b/yourapp.appspot.com/o/";if(!e.startsWith(s))return e;return`https://ik.imagekit.io/mythrift/${e.slice(66)}${t?`&tr=${t}`:""}`},g=({product:g,isLoading:j,showVendorName:b=!0})=>{var y,N;const w=e(),[k,I]=t.useState(!1),{currentUser:D}=s(),{addFavorite:P,removeFavorite:$,isFavorite:F}=i(),L=F(null==g?void 0:g.id),[C,T]=t.useState(null);t.useEffect((()=>{(async()=>{if(g.vendorId)try{const e=o(r,"vendors",g.vendorId),t=await c(e);if(t.exists()){const e=t.data();T(e.marketPlaceType)}}catch(e){}})()}),[g.vendorId]);const O=e=>e.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),Q=(null==g?void 0:g.coverImageUrl)||(null==(y=null==g?void 0:g.imageUrls)?void 0:y[0]),S=v(Q,"w-60,q-20,bl-6"),W=v(Q);return a.jsx(a.Fragment,{children:a.jsxs("div",{className:"product-card relative mb-2 cursor-pointer "+(0===g.stockQuantity?"opacity-50 pointer-events-none":""),onClick:()=>{!j&&(null==g?void 0:g.stockQuantity)>0&&w(`/product/${g.id}`)},style:{width:"100%",margin:"0"},children:[a.jsxs("div",{className:"relative",children:[j?a.jsx(n,{height:160}):a.jsxs(a.Fragment,{children:[g.discount&&a.jsx("div",{className:"absolute top-2 zen right-2 ",children:g.discount.discountType.startsWith("personal-freebies")?a.jsx("div",{className:"bg-customPink text-customOrange text-xs px-2 py-1.5 font-opensans font-medium rounded",children:g.discount.freebieText}):a.jsxs("div",{className:"bg-customPink text-customOrange text-xs px-2 py-1.5 font-opensans font-medium rounded",children:["-",g.discount.percentageCut,"%"]})}),g.discount&&g.discount.discountType.startsWith("inApp")&&a.jsx("img",{src:"/Ribbon.svg",alt:"Discount Ribbon",className:"absolute top-0 left-0 w-12 h-12 "}),a.jsxs("div",{className:"relative h-52 w-full rounded-lg overflow-hidden",children:[a.jsx("img",{src:S,alt:g.name,className:"absolute top-0 left-0 w-full h-full object-cover blur-sm brightness-95 transition-opacity duration-300 "+(k?"opacity-0":"opacity-100")}),a.jsx("img",{src:W,alt:g.name,loading:"lazy",onLoad:()=>I(!0),className:"absolute top-0 left-0 w-full h-full object-cover transition-opacity duration-300 "+(k?"opacity-100":"opacity-0")})]})]}),a.jsx("div",{className:"absolute bottom-2 right-2 cursor-pointer bg-white p-1 rounded-full shadow-lg",onClick:async e=>{e.stopPropagation();const t=L;if(L?($(g.id),d.info(`Removed ${g.name} from favorites!`)):(P(g),d.success(`Added ${g.name} to favorites!`)),D)try{await h(D.uid,"favorite",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:10,hourLimit:80,dayLimit:120});const e=o(r,"users",D.uid,"favorites",g.id),s=o(r,"vendors",g.vendorId);t?await l(e):(await m(e,{productId:g.id,vendorId:g.vendorId,name:g.name,price:g.price,createdAt:new Date}),await u(s,{likesCount:x(1)}))}catch(s){t?P(g):$(g.id),d.error(s.message||"Failed to update favorites. Please try again.")}},children:L?a.jsx(p,{className:"text-red-500 text-2xl"}):a.jsx(f,{className:"text-gray-800 text-2xl"})}),0===g.stockQuantity&&a.jsx("div",{className:"absolute inset-0 bg-gray-900 bg-opacity-70 flex items-center justify-center rounded-lg",children:a.jsx("p",{className:"text-red-700 font-semibold text-2xl animate-pulse",children:"Sold Out!"})})]}),a.jsxs("div",{className:"mt-2",children:[a.jsx("div",{className:"flex font-opensans font-light items-center",children:j?a.jsx(n,{width:100}):a.jsxs("div",{className:"flex items-center space-x-1",children:[(e=>{if(!e)return null;const t=e.toLowerCase();return t.includes("defect")?a.jsx("p",{className:"text-xs text-red-500",children:e}):t.includes("brand new")?a.jsx("p",{className:"text-xs text-green-500",children:"Brand New"}):t.includes("thrift")?a.jsx("p",{className:"text-xs text-yellow-500",children:"Thrift"}):a.jsx("p",{className:"text-xs text-red-500",children:e})})(g.condition),"Defect:"===g.condition&&g.defectDescription&&a.jsx("span",{className:"text-xs text-red-500",children:(null==(N=g.defectDescription)?void 0:N.length)>17?g.defectDescription.slice(0,17)+"...":g.defectDescription})]})}),a.jsx("h3",{className:"text-sm font-opensans font-medium mt-1",children:j?a.jsx(n,{width:100}):g.name}),a.jsxs("div",{className:"flex flex-col mt-1",children:[a.jsx("p",{className:"text-black text-lg font-opensans font-bold",children:j?a.jsx(n,{width:50}):`₦${O(g.price)}`}),g.discount&&g.discount.initialPrice&&"personal-freebies"!==g.discount.discountType&&a.jsxs("p",{className:"text-sm font-opensans text-gray-500 line-through",children:["₦",O(g.discount.initialPrice)]})]}),b&&g.vendorName&&a.jsx("p",{className:"text-xs font-opensans font-light text-gray-600 underline cursor-pointer",onClick:e=>{e.stopPropagation(),"virtual"===C?w(`/store/${g.vendorId}`):"marketplace"===C&&w(`/marketstorepage/${g.vendorId}`)},children:g.vendorName})]})]})})};export{g as P};
