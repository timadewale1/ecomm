import{j as e,b as s,u as t,d as a,r,s as l,G as i,au as n,o,ar as c,ad as d,e as x,O as m,h as f,_ as u,H as h,D as p,E as g,I as j,b_ as b,a9 as v,bj as y,C as w}from"./index-B6_tP4YQ.js";import{a as N}from"./index-AmrmWShL.js";import{R as k}from"./react-stars-BTZUCP3-.js";import{L as C}from"./index-CGC7HsBi.js";import{d as L}from"./index-YqizTpTw.js";import{$ as S}from"./module-rdBSHQ9l.js";import{a as R}from"./index-DVu8OWaS.js";import{h as P}from"./userWriteHandler-DCDkCU98.js";import{S as E}from"./SEO-CG8nsGhn.js";import{P as A}from"./ProgressBar-B8ykVE4P.js";import"./index-Bx5UHif0.js";import"./emotion-unitless.esm-sScrWPmR.js";import"./index-CfSqzuTe.js";import"./index-BaqZIR9i.js";const I=({filled:s})=>e.jsx("svg",{width:"38",height:"38",viewBox:"0 0 24 24",fill:s?"#ffd700":"#e0e0e0",xmlns:"http://www.w3.org/2000/svg",style:{marginRight:"8px",borderRadius:"4px"},children:e.jsx("path",{d:"M12 17.3L18.2 21L16.5 14L22 9.3L14.8 8.6L12 2L9.2 8.6L2 9.3L7.5 14L5.8 21L12 17.3Z",stroke:"none",fillRule:"evenodd"})}),F=()=>{const{id:F}=s(),U=t(),D=a(),[O,z]=r.useState([]),[B,T]=r.useState(null),[$,G]=r.useState(!0),[M,V]=r.useState(null),[W,q]=r.useState(!1),[Q,Y]=r.useState(""),[_,H]=r.useState(!1),[K,Z]=r.useState("All"),[J,X]=r.useState(0),[ee,se]=r.useState(!1),[te,ae]=r.useState(!0),[re,le]=r.useState(!1),[ie,ne]=r.useState({5:0,4:0,3:0,2:0,1:0}),[oe,ce]=r.useState(!1);r.useEffect((()=>{l(w,(e=>{e?(async e=>{try{const s=(await f(x(m,"users",e))).data();V(s),s.displayName&&s.birthday?ce(!0):ce(!1)}catch(s){}})(e.uid):(V(null),ce(!1))}))}),[]),r.useEffect((()=>{(async()=>{try{const e=x(m,"vendors",F),s=await f(e);if(s.exists()){const e=s.data();T(e)}else u.error("Vendor not found!")}catch(e){u.error("Error fetching vendor data: "+e.message)}finally{ae(!1)}})()}),[F]),r.useEffect((()=>{(async()=>{if(M&&F)try{const e=h(m,"orders"),s=p(e,g("userId","==",M.uid),g("vendorId","==",F),g("progressStatus","==","Delivered")),t=await j(s);se(!t.empty)}catch(e){se(!1)}else se(!1)})()}),[M,F]);const de=async()=>{try{const e=h(m,"vendors",F,"reviews"),s=(await j(e)).docs.map((e=>({id:e.id,...e.data()})));let t=s;"All"!==K&&(t=s.filter((e=>e.rating===K)));const a=t.filter((e=>e.reviewText));z(a);const r={5:s.filter((e=>5===e.rating)).length,4:s.filter((e=>4===e.rating)).length,3:s.filter((e=>3===e.rating)).length,2:s.filter((e=>2===e.rating)).length,1:s.filter((e=>1===e.rating)).length};ne(r)}catch(e){}finally{ae(!1)}};r.useEffect((()=>{F&&de()}),[F]),r.useEffect((()=>{F&&de()}),[F,K]);const xe=["damn","hell","fool","werey","ode","idiot","shit","crap","bastard","bitch","asshole","dick","piss","prick","cunt","fuck","motherfucker","fucker","cock","pussy","twat","whore","slut","nigger","chink","spic","wanker","bollocks","bugger","tosser","shithead","douchebag","jackass","retard"];r.useEffect((()=>(document.body.style.overflow=W||_?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[W,_]);const me=(null==B?void 0:B.ratingCount)>0?B.rating/B.ratingCount:0,fe=Object.values(ie).reduce(((e,s)=>e+s),0),ue=e=>e/fe*100;return e.jsxs(e.Fragment,{children:[e.jsx(E,{title:`Reviews for ${(null==B?void 0:B.shopName)||"Vendor"} - My Thrift`,url:`https://www.shopmythrift.store/reviews/${F}`}),e.jsxs("div",{className:"px-2 py-4",children:[e.jsxs("div",{className:"sticky py-3 top-0 bg-white ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2",children:[e.jsx(i,{className:"text-3xl cursor-pointer",onClick:()=>U(-1)}),e.jsx("h1",{className:"text-xl font-opensans font-semibold flex-grow text-center",children:"Reviews"}),!M||ee?e.jsx(N,{className:"text-3xl cursor-pointer",onClick:()=>{M?q(!0):H(!0)}}):e.jsx("div",{className:"w-8 h-8"})]}),e.jsx("div",{className:"flex justify-between mb-3 w-full overflow-x-auto space-x-2 scrollbar-hide",children:["All",5,4,3,2,1].map((s=>e.jsx("button",{onClick:()=>Z(s),className:"flex-shrink-0 h-12 px-3 py-2 text-xs font-bold font-opensans text-black border border-gray-400 rounded-full "+(K===s?"bg-customOrange text-white":"bg-transparent"),children:"All"===s?s:`${s} stars`},s)))}),e.jsx("div",{className:"border-b border-gray-300 w-screen translate-y-3 relative left-1/2 transform -translate-x-1/2"})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("div",{className:"flex items-center justify-start my-4",children:e.jsx("div",{className:" rounded-full flex flex-col ",children:te?e.jsx(n,{square:!0,height:80,width:80}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-5xl font-opensans font-semibold",children:me.toFixed(1)}),e.jsx("div",{className:"flex text-xs mt-2",children:Array.from({length:5}).map(((s,t)=>e.jsx(o,{className:t<Math.floor(me)?"text-yellow-500":"text-gray-300"},t)))}),e.jsx("span",{className:"text-xs mt-1 font-poppins  text-gray-600",children:B.ratingCount})]})})}),e.jsx("div",{className:"my-4  w-full",children:fe>0?[5,4,3,2,1].map((s=>e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"w-6 text-xs font-opensans font-light",children:s}),e.jsx(A,{now:ue(ie[s]||0),className:"flex-1 mx-2",style:{height:"14px",backgroundColor:"#f5f3f2",borderRadius:"10px",overflow:"hidden"},children:e.jsx("div",{style:{backgroundColor:"#f9531e",height:"100%",width:`${ue(ie[s]||0)}%`,borderRadius:"10px"}})})]},s))):e.jsx("p",{className:"text-xs font-opensans text-gray-600",children:"No ratings available yet."})})]}),e.jsxs("div",{className:"p-2",children:[O.map((s=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[s.userPhotoURL?e.jsx("img",{src:s.userPhotoURL,alt:s.userName,className:"w-11 h-11 rounded-full mr-3"}):e.jsx("div",{className:"w-11 h-11 rounded-full bg-gray-200 flex items-center justify-center mr-3",children:e.jsx(R,{className:"text-gray-500 text-xl"})}),e.jsx("div",{children:e.jsx("h2",{className:"font-semibold text-xs",children:s.userName})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex space-x-1",children:Array.from({length:s.rating},((s,t)=>e.jsx(o,{className:"text-yellow-500"},t)))}),e.jsx("span",{className:"ratings-text font-medium font-opensans text-gray-500",children:new Date(1e3*s.createdAt.seconds).toLocaleDateString()})]}),e.jsx("p",{className:"mt-2 text-black font-opensans text-sm",children:s.reviewText})]},s.id))),e.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-center items-center mb-2",children:[e.jsx(o,{className:"text-yellow-500 text-lg mr-2"}),e.jsx("h2",{className:"text-xs font-opensans font-semibold",children:"Reviews from Verified Buyers"})]}),e.jsx("p",{className:"text-xs font-opensans text-gray-700",children:"All reviews on this page are submitted by verified buyers."})]})})]}),W&&B&&e.jsxs("div",{className:"fixed inset-0 bg-white z-50",children:[e.jsxs("div",{className:"flex items-center px-2 py-4 mb-2",children:[e.jsx(i,{className:"text-3xl cursor-pointer",onClick:()=>q(!1)}),e.jsxs("h1",{className:"text-lg ml-4 font-opensans font-semibold",children:["Rate ",B.shopName]}),e.jsx("div",{})]}),e.jsx("div",{className:"border-b border-gray-300 w-full mb-2"}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"flex justify-center mb-2 ",children:e.jsx("div",{className:"relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:B.coverImageUrl?e.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:B.coverImageUrl,alt:B.shopName}):e.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:"https://images.saatchiart.com/saatchi/1750204/art/9767271/8830343-WUMLQQKS-7.jpg",alt:""})})}),e.jsx("div",{className:"flex justify-center"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(e.Fragment,{children:[e.jsx(o,{className:"text-yellow-400",size:16}),e.jsxs("span",{className:"flex text-xs font-opensans items-center ml-2",children:[me.toFixed(1),e.jsx(c,{className:"mx-1 text-gray-300 font-opensans dot-size"}),B.ratingCount||0," ratings"]})]})}),e.jsx("div",{className:"w-fit text-center bg-customGreen p-2 flex items-center justify-center rounded-full mt-3 mx-auto",children:e.jsx("div",{className:"mt-2 flex flex-wrap items-center -translate-y-1 justify-center text-textGreen text-xs space-x-1",children:te?e.jsx(n,{width:80,height:24,count:4,inline:!0}):B.categories.map(((s,t)=>e.jsxs(d.Fragment,{children:[t>0&&e.jsx(c,{className:"mx-1 dot-size text-dotGreen"}),e.jsx("span",{children:s})]},t)))})}),e.jsx("h1",{className:"font-opensans text-sm mt-4 font-semibold",children:"Rate this shop"}),e.jsx("div",{className:"mt-2 mb-3 flex justify-center",children:e.jsx(k,{count:5,onChange:e=>X(e),size:24,activeColor:"#ffd700",emptyIcon:e.jsx(I,{filled:!1}),filledIcon:e.jsx(I,{filled:!0})})}),e.jsx("textarea",{value:Q,onFocus:()=>{document.querySelector("textarea").scrollIntoView({behavior:"smooth"})},onChange:e=>{const s=e.target.value;Y(s),(e=>{const s=e.toLowerCase();return xe.some((e=>s.includes(e)))})(s)?G(!1):G(!0)},placeholder:"Describe your experience with this shop (Optional)",className:"w-full p-2 border h-20 text-xs text-gray-900 rounded mb-4 "+($?"border-gray-300":"border-red-500"),style:{resize:"none"}}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 p-4 bg-white",children:e.jsx("button",{onClick:async()=>{if($)if(oe)try{if(le(!0),!F||!M)return u.error("You must be logged in to submit a review."),void le(!1);if(!J)return u.error("Please select a rating."),void le(!1);try{await P(M.uid,"review",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:8,hourLimit:40})}catch(e){return le(!1),void u.error(e.message)}const s=h(m,"vendors",F,"reviews");await b(s,{reviewText:""!==Q.trim()?Q:null,rating:J,userName:M.username||M.displayName,userPhotoURL:M.photoURL||null,createdAt:new Date});const t=x(m,"vendors",F);await v(t,{ratingCount:y(1),rating:y(J)}),q(!1),Y(""),X(0),de(),u.success("Review added successfully!")}catch(s){u.error("Error adding review, please try again.")}finally{le(!1)}else u.error("Please complete your profile before submitting a review.");else u.error("Your review contains inappropriate language.")},className:($?"bg-customOrange":"bg-gray-400")+" text-white font-opensans font-medium h-12 px-6 rounded-full w-full flex items-center justify-center",disabled:re||!$,children:re?e.jsx(S,{strokeColor:"#ffffff",strokeWidth:"5",animationDuration:"0.75",width:"24",visible:!0}):"Post"})})]})]}),_&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center",onClick:e=>{e.target===e.currentTarget&&H(!1)},children:e.jsxs("div",{className:"bg-white w-9/12 max-w-md rounded-lg px-3 py-4 flex flex-col",onClick:e=>e.stopPropagation(),children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:e.jsx(L,{className:"text-customRichBrown"})}),e.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Please Log In"})]}),e.jsx(C,{onClick:()=>H(!1),className:"text-black text-xl mb-6 cursor-pointer"})]}),e.jsx("p",{className:"mb-6 text-xs font-opensans text-gray-800 ",children:"You need to be logged in to add a review. Please log in to your account, or create a new account if you donâ€™t have one, to continue."}),e.jsxs("div",{className:"flex space-x-16",children:[e.jsx("button",{onClick:()=>{U("/signup",{state:{from:D.pathname}}),H(!1)},className:"flex-1 bg-transparent py-2 text-customRichBrown font-medium text-xs font-opensans border-customRichBrown border rounded-full",children:"Sign Up"}),e.jsx("button",{onClick:()=>{U("/login",{state:{from:D.pathname}}),H(!1)},className:"flex-1 bg-customOrange py-2 text-white text-xs font-opensans rounded-full",children:"Login"})]})]})})]})]})};export{F as default};
