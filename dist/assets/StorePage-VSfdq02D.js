import{b as e,r as s,a as t,c as a,u as r,d as n,bw as o,bE as l,bF as i,bk as c,j as d,L as m,R as x,bG as u,bD as h,A as f,G as p,au as j,ar as g,ad as b,F as w,aY as N,H as y,O as v,e as k,h as C,bx as S,_ as F,Q as I,as as L,a9 as E,bj as $,aZ as M}from"./index-B6_tP4YQ.js";import{h as O}from"./userWriteHandler-DCDkCU98.js";import{P}from"./productnotfound-BYH9w9yZ.js";import{P as A}from"./ProductCard-CTMPZt-i.js";import{g as D,h as T}from"./index-_8P_0wxn.js";import{c as Y,d as z}from"./index-YqizTpTw.js";import{M as U}from"./index-c29tLOqg.js";import{n as R,i as B,o as H}from"./index-BZTi0IwX.js";import{b as _}from"./index-Czi2OGzl.js";import{L as G}from"./index-CGC7HsBi.js";import{S as V}from"./SEO-CG8nsGhn.js";import{$ as W}from"./module-rdBSHQ9l.js";import{u as q}from"./useDispatch-DS0xcVHe.js";import"./index-BzTvhx-M.js";import"./index-Bx5UHif0.js";import"./warning-DM8AoHwU.js";import"./emotion-unitless.esm-sScrWPmR.js";U.setAppElement("#root");const Q=()=>{const[e,t]=s.useState(!1);s.useEffect((()=>{if(!localStorage.getItem("reviewBannerShown")){t(!0),localStorage.setItem("reviewBannerShown","true");const e=setTimeout((()=>{t(!1)}),1e4);return()=>clearTimeout(e)}}),[]);return d.jsxs("div",{className:"absolute z-50 w-64 bg-customBrown text-white px-2 py-2 rounded-lg shadow-lg flex flex-col items-start space-y-1 transform -translate-x-1/2 translate-y-40 left-1/2 transition-opacity duration-500 "+(e?"opacity-100":"opacity-0 pointer-events-none"),style:{maxWidth:"99%"},children:[d.jsx("span",{className:"font-semibold font-opensans text-sm",children:"Click here to rate vendor!"}),d.jsx("span",{className:"text-xs font-opensans",children:"Shopped from here? Share your experience with other shoppers!ðŸ§¡"}),d.jsx("button",{onClick:()=>{t(!1)},className:"absolute top-1 right-4",children:d.jsx(R,{className:"text-white text-lg"})}),d.jsx("div",{className:"absolute bottom-[-7px] left-1/2 transform -translate-x-1/2 w-4 h-4 bg-customBrown rotate-45"})," "]})},X=()=>{const{id:X}=e(),[Z,J]=s.useState({}),[K,ee]=s.useState(!1),[se,te]=s.useState(!1),[ae,re]=s.useState(!1),{currentUser:ne}=t(),oe=q(),[le,ie]=s.useState("All"),[ce,de]=s.useState(""),[me,xe]=s.useState(!1),[ue,he]=s.useState(!1),[fe,pe]=s.useState(null),{entities:je,loading:ge,error:be}=a((e=>e.storepageVendors)),we=je[X]||{},Ne=we.vendor,ye=we.products||[],ve=we.loadingMore,ke=we.noMore,Ce=r(),Se=n(),Fe=new URLSearchParams(Se.search).has("shared"),[Ie,Le]=s.useState(!1),[Ee,$e]=s.useState(!1),{isActive:Me,vendorId:Oe,pileItems:Pe,stockpileExpiry:Ae,loading:De}=a((e=>e.stockpile));s.useEffect((()=>{"1"===new URLSearchParams(Se.search).get("stockpile")&&ne&&(oe(o({vendorId:X})),Le(!0))}),[Se.search,ne,oe,X]),s.useEffect((()=>{Ne||oe(l(X))}),[X,oe,Ne]),s.useEffect((()=>{Ne&&0===ye.length&&oe(i({vendorId:X,loadMore:!1}))}),[Ne,ye.length,X,oe]),s.useEffect((()=>{const e=()=>{const e=window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-150;Ne&&e&&!ve&&!ke&&oe(i({vendorId:X,loadMore:!0}))};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[Ne,ve,ke,X,oe]),je[X],s.useEffect((()=>{te(!1);(async()=>{if(ne&&Ne)try{const e=y(v,"follows"),s=k(e,`${ne.uid}_${Ne.id}`);(await C(s)).exists()?te(!0):te(!1)}catch(e){}})()}),[ne,Ne]);const Te=()=>{$e(!1)},Ye=Ae?c(Ae).format("ddd, MMM Do YYYY"):null;s.useEffect((()=>(document.body.style.overflow=K?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[K]);const ze=e=>{J((s=>{if(s[e]){const{[e]:t,...a}=s;return a}return{...s,[e]:!0}}))};if(ge||!Ne&&!be)return d.jsx(m,{});const Ue=ye.filter((e=>e.name.toLowerCase().includes(ce.toLowerCase())&&("All"===le||e.productType===le))).sort(((e,s)=>"priceAsc"===fe?parseFloat(e.price)-parseFloat(s.price):"priceDesc"===fe?parseFloat(s.price)-parseFloat(e.price):0));if(!Ne)return d.jsxs("div",{className:"flex flex-col px-6 justify-center items-center h-3/6",children:[d.jsx(x,{className:"w-full h-full",animationData:P,loop:!0,autoplay:!0}),d.jsx("h1",{className:"text-xl text-center font-bold font-opensans text-red-500",children:"Vendor is not found. You entered a wrong link or the vendor is not available."}),d.jsxs("button",{className:" mt-20  py-2 rounded-full  font-medium flex items-center font-opensans px-5 justify-center transition-colors duration-200 bg-customOrange text-white",onClick:()=>{Ce(ne?"/browse-markets":"/confirm-state")},children:[" ","Go Home"]})]});const Re=()=>{de("")},Be=Ne.ratingCount>0?Ne.rating/Ne.ratingCount:0,He=["All",...new Set(ye.map((e=>e.productType)))],_e=Ue.filter(((e,s,t)=>t.findIndex((s=>s.id===e.id))===s));return d.jsxs(d.Fragment,{children:[Me&&Oe===X&&d.jsxs(d.Fragment,{children:[d.jsx("button",{onClick:()=>{$e(!0),ne&&oe(S({userId:ne.uid,vendorId:X}))},className:"fixed bottom-6 right-3 z-50 \r\n                       w-14 h-14 rounded-full \r\n                       flex items-center justify-center\r\n                       bg-customOrange text-white\r\n                       shadow-xl",children:d.jsx(u,{size:24})}),d.jsx(U,{isOpen:Ee,onRequestClose:Te,className:"fixed bottom-0 left-1/2 transform -translate-x-1/2  w-full max-h-[80vh] rounded-t-3xl bg-white p-4 overflow-y-auto",overlayClassName:"fixed z-50 inset-0 bg-black bg-opacity-50 flex justify-center items-end",closeTimeoutMS:200,children:d.jsxs("div",{children:[d.jsxs("div",{className:"flex justify-between items-center mb-3",children:[d.jsx("h2",{className:"text-xl font-opensans  font-semibold text-gray-800",children:"Your Current Pile"}),d.jsx(R,{onClick:Te,className:"text-xl text-gray-600"})]}),d.jsx("div",{className:"border-b border-gray-300 mb-3"}),De?d.jsx("div",{className:"flex justify-center items-center h-40",children:d.jsx(m,{})}):d.jsxs(d.Fragment,{children:[Ye&&d.jsxs("p",{className:"mb-4 text-sm font-opensans text-gray-500",children:["Your pile expires on"," ",d.jsx("span",{className:"font-medium text-customOrange",children:Ye})]}),0===Pe.filter((e=>"Declined"!==e.progressStatus)).length?d.jsx("p",{children:"No items found"}):Pe.filter((e=>"Declined"!==e.progressStatus)).map(((e,s)=>d.jsxs("div",{className:"flex items-center mb-3",children:[d.jsx("img",{src:e.imageUrl,alt:e.name,className:"w-16 h-16 object-cover rounded-md"}),d.jsx("div",{className:"ml-3",children:d.jsx("p",{className:"font-medium text-black font-opensans text-sm",children:e.name})})]},s)))]})]})})]}),d.jsx(V,{title:`${Ne.shopName} - My Thrift`,description:`Shop ${Ne.shopName} on My Thrift`,image:`${Ne.coverImageUrl}`,url:`https://www.shopmythrift.store/store/${X}`}),d.jsxs("div",{className:"p-3 mb-24",children:[d.jsx(Q,{}),d.jsx("div",{className:"sticky top-0 bg-white h-20 z-10 flex items-center border-b border-gray-300 w-full",children:me?d.jsxs("div",{className:"flex items-center w-full relative px-2",children:[d.jsx(h,{onClick:()=>{xe(!1),Re()},className:"cursor-pointer text-2xl mr-2"}),d.jsx("input",{type:"text",value:ce,onChange:e=>{de(e.target.value)},placeholder:"Search store...",className:"flex-1 border rounded-full font-opensans text-black text-sm border-gray-300 px-3 py-2 font-medium focus:outline-none"}),ce&&d.jsx(B,{className:"text-xl text-gray-500 cursor-pointer absolute right-4",onClick:Re})]}):Fe?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"flex items-center",children:d.jsx(f,{onClick:()=>Ce("/newhome"),className:"text-2xl cursor-pointer"})}),d.jsx("div",{className:"flex-1 flex justify-center items-center",children:d.jsx("img",{src:"/logo512.png",alt:"Logo",className:"object-contain max-h-[72px]"})}),d.jsx("div",{className:"flex items-center mr-2 relative",children:d.jsx(Y,{className:"text-black text-3xl cursor-pointer",onClick:()=>xe(!0)})})]}):d.jsxs("div",{className:"flex items-center justify-between w-full ",children:[d.jsx(p,{onClick:()=>Ce(-1),className:"cursor-pointer text-3xl"}),d.jsx("h1",{className:"flex-grow text-center font-opensans text-lg font-semibold",children:Ne.shopName}),d.jsx(Y,{className:"text-black text-3xl cursor-pointer",onClick:()=>xe(!0)})]})}),d.jsx("div",{className:"flex justify-center mt-6",children:d.jsxs("div",{className:"relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:[ge?d.jsx(j,{circle:!0,height:128,width:128}):Ne.coverImageUrl?d.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:Ne.coverImageUrl,alt:Ne.shopName}):d.jsx("span",{className:"text-center font-bold",children:Ne.shopName}),d.jsx("button",{onClick:()=>{const e=`https://mx.shopmythrift.store/store/${Ne.id}?shared=true`;navigator.share?navigator.share({title:Ne.shopName,text:`Check out ${Ne.shopName} on My Thrift!`,url:e}).catch((e=>{})):(navigator.clipboard.writeText(e),F.success("Store link copied to clipboard!"))},className:"absolute bottom-1 right-1 bg-white rounded-full p-1 shadow-md hover:bg-gray-100",children:d.jsx(H,{className:"text-xl text-gray-900"})})]})}),d.jsx("div",{className:"flex justify-center mt-2",style:{cursor:"pointer"},onClick:()=>{Ce(`/reviews/${X}`)},children:ge?d.jsx(j,{width:100,height:24}):d.jsxs(d.Fragment,{children:[d.jsx(D,{className:"text-yellow-400",size:16}),d.jsxs("span",{className:"flex text-xs font-opensans items-center ml-2",children:[Be.toFixed(1),d.jsx(g,{className:"mx-1 text-gray-300 font-opensans dot-size"}),Ne.ratingCount||0," ratings"]})]})}),d.jsx("div",{className:"w-fit text-center bg-customGreen p-2 flex items-center justify-center rounded-full mt-3 mx-auto",children:d.jsx("div",{className:"mt-2 flex flex-wrap items-center -translate-y-1 justify-center text-textGreen text-xs space-x-1",children:ge?d.jsx(j,{width:80,height:24,count:4,inline:!0}):Ne.categories.map(((e,s)=>d.jsxs(b.Fragment,{children:[s>0&&d.jsx(g,{className:"mx-1 dot-size text-dotGreen"}),d.jsx("span",{children:e})]},s)))})}),d.jsx("div",{className:"flex items-center justify-center mt-3",children:ge?d.jsx(j,{width:128,height:40}):d.jsx("button",{className:"w-full h-12 rounded-full border font-medium flex items-center font-opensans justify-center transition-colors duration-200 bg-customOrange text-white",onClick:async()=>{if(ne)try{if(re(!0),!(null==Ne?void 0:Ne.id))throw new Error("Vendor ID is undefined");const e=k(v,"follows",`${ne.uid}_${Ne.id}`),s=k(v,"vendors",Ne.id);await O(ne.uid,"follow",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:8,hourLimit:40}),se?(await M(e),F.success("Unfollowed")):(await I(e,{userId:ne.uid,vendorId:Ne.id,createdAt:L()}),await E(s,{followersCount:$(1)}),F.success("You will be notified of new products and promos.")),te(!se)}catch(e){F.error(`${e.message}`)}finally{re(!1)}else ee(!0)},disabled:ae,children:ae?d.jsx(T,{className:"animate-spin mr-2"}):se?d.jsxs(d.Fragment,{children:[d.jsx(w,{className:"mr-2"}),"Following"]}):d.jsxs(d.Fragment,{children:[d.jsx(N,{className:"mr-2"}),"Follow"]})})}),d.jsx("p",{className:" text-gray-700 mt-3 text-sm font-opensans text-center",children:ge?d.jsx(j,{count:2}):Ne.description}),d.jsxs("div",{className:"p-2 mt-7",children:[d.jsxs("div",{className:"flex items-center mb-3 justify-between",children:[d.jsx("h1",{className:"font-opensans text-lg  font-semibold",children:"Products"}),d.jsxs("div",{className:"relative",children:[ue&&d.jsxs("div",{className:"z-50 absolute bg-white w-44 h-20 rounded-2.5xl shadow-[0_0_10px_rgba(0,0,0,0.1)] -left-24 top-2 p-3 flex flex-col justify-between",children:[d.jsx("span",{className:"text-xs font-opensans ml-2 cursor-pointer "+("priceAsc"===fe?"text-customOrange":"text-black"),onClick:()=>{pe("priceAsc"),he(!ue)},children:"Low to High"}),d.jsx("hr",{className:"text-slate-300"}),d.jsx("span",{className:"text-xs font-opensans ml-2 cursor-pointer "+("priceDesc"===fe?"text-customOrange":"text-black"),onClick:()=>{pe("priceDesc"),he(!ue)},children:"High to Low"})]}),d.jsxs("span",{className:"flex text-xs font-opensans items-center",children:["Sort by Price:"," ",d.jsx(_,{className:"text-customOrange cursor-pointer ml-1",onClick:()=>he(!ue)})]})]})]}),d.jsx("div",{className:"flex  mb-4 w-full overflow-x-auto space-x-2 scrollbar-hide",children:He.map((e=>d.jsx("button",{onClick:()=>(e=>{ie(e)})(e),className:"flex-shrink-0 h-12 px-4 py-2 text-xs font-semibold font-opensans text-black border border-gray-200 rounded-full "+(le===e?"bg-customOrange text-white":"bg-transparent"),children:e},e)))}),ge||ve&&0===Ue.length?d.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:Array.from({length:6}).map(((e,s)=>d.jsx(j,{height:200,width:"100%"},s)))}):Ue.length>0?d.jsxs(d.Fragment,{children:[d.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:_e.map((e=>d.jsx(A,{product:e,isFavorite:!!Z[e.id],onFavoriteToggle:ze,onClick:()=>Ce(`/product/${e.id}`),showVendorName:!1},e.id)))}),ve&&d.jsx("div",{className:"flex justify-center my-4",children:d.jsx(W,{strokeColor:"#f9531e",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})})]}):d.jsx("div",{className:"flex justify-center items-center w-full text-center",children:d.jsxs("p",{className:"font-opensans text-gray-800 text-xs",children:["ðŸ“­ ",d.jsx("span",{className:"font-semibold",children:Ne.shopName})," ","hasnâ€™t added any products to their online store yet. Follow this vendor and you will be notified when they upload products!"]})})]}),K&&d.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:e=>{e.target===e.currentTarget&&ee(!1)},children:d.jsxs("div",{className:"bg-white w-9/12 max-w-md rounded-lg px-3 py-4 flex flex-col",onClick:e=>e.stopPropagation(),children:[d.jsxs("div",{className:"flex justify-between items-center mb-4",children:[d.jsxs("div",{className:"flex space-x-4",children:[d.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:d.jsx(z,{className:"text-customRichBrown"})}),d.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Please Log In"})]}),d.jsx(G,{onClick:()=>ee(!1),className:"text-black text-xl mb-6 cursor-pointer"})]}),d.jsx("p",{className:"mb-6 text-xs font-opensans text-gray-800 ",children:"You need to be logged in to follow this vendor to recieve notifications. Please log in to your account, or create a new account if you donâ€™t have one, to continue."}),d.jsxs("div",{className:"flex space-x-16",children:[d.jsx("button",{onClick:()=>{Ce("/signup",{state:{from:Se.pathname}}),ee(!1)},className:"flex-1 bg-transparent py-2 text-customRichBrown font-medium text-xs font-opensans border-customRichBrown border rounded-full",children:"Sign Up"}),d.jsx("button",{onClick:()=>{Ce("/login",{state:{from:Se.pathname}}),ee(!1)},className:"flex-1 bg-customOrange py-2 text-white text-xs font-opensans rounded-full",children:"Login"})]})]})})]})]})};export{X as default};
