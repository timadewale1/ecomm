import{u as e,h as t,f as s,r,i as o,cE as n,cF as i,j as l,S as a,Q as c,bs as u,bu as d,a2 as m,cG as g,cH as h,cI as w}from"./index-CvIXhaMv.js";function y(){const{category:y}=e(),f=(e=>{const t=String(e||"").replace("-"," ").trim().toLowerCase();return["men","mens","man"].includes(t)?"Mens":["women","womens","lady","ladies"].includes(t)?"Womens":["kid","kids","children"].includes(t)?"Kids":["all"].includes(t)?"All":e})(y),x=t(),p=s(),v=`cat:selectedType:${f}`,[b,j]=r.useState((()=>sessionStorage.getItem(v)||"All")),C=`category:${f}:${b}`,S=o((e=>{var t,s;return null==(s=null==(t=e.scroll)?void 0:t.positions)?void 0:s[C]}))??("undefined"!=typeof window?Number(sessionStorage.getItem(`scroll:${C}`)||0):0),{byCategory:N}=o((e=>e.categoryItems)),E=N[f]||{items:[],lastCursor:null,status:"idle",error:null},k=o((e=>e.categoryTypes.byCategory[f]))||[],[L,I]=r.useState(""),[T,$]=r.useState(null),[A,H]=r.useState(!1),[M,O]=r.useState(!1),[R,z]=r.useState(!1),F=r.useRef(null),P=50,W=r.useRef({trying:!1,loadingMore:!1});r.useEffect((()=>{const e=e=>{F.current&&!F.current.contains(e.target)&&z(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)}),[]),r.useEffect((()=>{if("scrollRestoration"in window.history){const e=window.history.scrollRestoration;return window.history.scrollRestoration="manual",()=>{window.history.scrollRestoration=e}}}),[]),r.useEffect((()=>{const e=sessionStorage.getItem(v)||"All";j(e)}),[f]),r.useEffect((()=>{0===E.items.length&&Y()}),[f,b]),r.useEffect((()=>{k.length||p(n({category:f}))}),[f,k.length,p]);const Y=async()=>{O(!0);try{const e=await p(i({category:f,productType:"All"===b?null:b,lastCursor:null,pageSize:P})).unwrap();(!e.lastCursor||e.items.length<P)&&H(!0)}catch{}finally{O(!1)}},D=async()=>{if("loading"!==E.status&&!A)if(E.lastCursor){O(!0);try{const e=await p(i({category:f,productType:"All"===b?null:b,lastCursor:E.lastCursor,pageSize:P})).unwrap();(!e.lastCursor||e.items.length<P)&&H(!0)}finally{O(!1)}}else H(!0)};r.useEffect((()=>{const e=()=>{window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-100&&D()};return window.addEventListener("scroll",e,{passive:!0}),()=>window.removeEventListener("scroll",e)}),[E.lastCursor,E.status,A,b]),r.useEffect((()=>{const e=()=>{const e=window.scrollY||0;p(g({key:C,y:e})),sessionStorage.setItem(`scroll:${C}`,String(e))},t=()=>e(),s=()=>{"hidden"===document.visibilityState&&e()};return window.addEventListener("beforeunload",t),document.addEventListener("visibilitychange",s),()=>{window.removeEventListener("beforeunload",t),document.removeEventListener("visibilitychange",s),e()}}),[p,C]),r.useEffect((()=>{if(!S)return;if(W.current.trying)return;W.current.trying=!0;let e=0;const t=async()=>{e+=1;const s=document.documentElement,r=S+window.innerHeight-20;if(s.scrollHeight>=r)return window.scrollTo(0,S),void(W.current.trying=!1);if(!A&&!W.current.loadingMore&&"loading"!==E.status){W.current.loadingMore=!0;try{await D()}finally{W.current.loadingMore=!1}}e<40?setTimeout(t,100):W.current.trying=!1};if(!E.items.length){const e=setInterval((()=>{E.items.length&&(clearInterval(e),setTimeout(t,0))}),100);return()=>clearInterval(e)}setTimeout(t,0)}),[S,E.items.length,A,E.status]);const G=e=>{$(e),z(!1)},K=E.items.filter((e=>(e.name||"").toLowerCase().includes(L.toLowerCase()))).sort(((e,t)=>"high-to-low"===T?(+t.price||0)-(+e.price||0):"low-to-high"===T?(+e.price||0)-(+t.price||0):0)),Q=["All",...k];return l.jsxs(l.Fragment,{children:[l.jsx(a,{title:`${f} - My Thrift`,description:`Shop ${f} category on My Thrift`,url:`https://www.shopmythrift.store/category/${y}`}),l.jsxs("div",{className:"px-2 py-24",children:[l.jsxs("div",{className:"fixed top-0 left-0 w-full bg-white z-50 px-2 pt-6 shadow-sm",children:[l.jsxs("div",{className:"flex items-center justify-between",children:[l.jsxs("div",{className:"flex items-center",children:[l.jsx(c,{className:"text-2xl cursor-pointer mr-2",onClick:()=>x(-1)}),l.jsxs("h2",{className:"text-sm font-opensans font-semibold",children:[f," Items"]})]}),l.jsx(u,{onClick:()=>z((e=>!e)),className:"text-xl text-gray-600 cursor-pointer",title:"Sort by price"}),R&&l.jsxs("div",{ref:F,className:"absolute right-2 top-12 bg-white shadow-lg rounded-2xl w-40 p-3 z-50 font-opensans",children:[l.jsxs("span",{className:"flex items-center justify-between text-xs cursor-pointer py-1 hover:text-customOrange "+("high-to-low"===T?"text-customOrange font-semibold":"text-gray-700"),onClick:()=>G("high-to-low"),children:["Price: High â†’ Low","high-to-low"===T&&l.jsx("span",{className:"ml-2 text-customOrange",children:"âœ“"})]}),l.jsx("hr",{className:"my-1 text-gray-200"}),l.jsxs("span",{className:"flex items-center justify-between text-xs cursor-pointer py-1 hover:text-customOrange "+("low-to-high"===T?"text-customOrange font-semibold":"text-gray-700"),onClick:()=>G("low-to-high"),children:["Price: Low â†’ High","low-to-high"===T&&l.jsx("span",{className:"ml-2 text-customOrange",children:"âœ“"})]})]})]}),l.jsx("div",{className:"flex px-2 mb-2 w-full py-4 overflow-x-auto space-x-2 scrollbar-hide",children:Q.map((e=>l.jsx("button",{onClick:()=>(async e=>{j(e),sessionStorage.setItem(v,e),H(!1),p(h({category:f}));const t=`category:${f}:${e}`;p(w({key:t})),sessionStorage.removeItem(`scroll:${t}`),window.scrollTo(0,0),O(!0);try{const t=await p(i({category:f,productType:"All"===e?null:e,lastCursor:null,pageSize:P})).unwrap();(!t.lastCursor||t.items.length<P)&&H(!0)}finally{O(!1)}})(e),className:"flex-shrink-0 h-12 px-4 text-xs font-semibold font-opensans rounded-full border transition-all duration-100 "+(b===e?"bg-customOrange text-white":"bg-white text-black"),children:e},e)))})]}),l.jsx("div",{className:"pt-16 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4",children:K.map((e=>l.jsx(d,{product:e},e.id)))}),!M&&"succeeded"===E.status&&0===K.length&&l.jsxs("div",{className:"text-center font-opensans text-xs text-gray-600 mt-4",children:["No ",f," products yet. Check back soon. ðŸ§¡"]}),M&&l.jsx("div",{className:"flex justify-center my-4",children:l.jsx(m,{strokeColor:"#f9531e",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})})]})]})}export{y as default};
