import{u as e,r as s,ay as t,h as a,k as r,j as n,F as o,L as l,cO as c,S as i,aL as d,aG as x,cP as m,cQ as u,Q as h,aM as f,cR as p,cS as g,R as j,cT as w,cU as b,cV as N,bs as y,bu as v,cW as k,a5 as C,d as S,a as F,y as I,_ as L,c as $,ca as _,ab as T,aa as U,q as A,w as B,g as E}from"./index-CvIXhaMv.js";const O=()=>{const[e,t]=s.useState(!1);s.useEffect((()=>{if(!localStorage.getItem("reviewBannerShown")){t(!0),localStorage.setItem("reviewBannerShown","true");const e=setTimeout((()=>{t(!1)}),1e4);return()=>clearTimeout(e)}}),[]);return n.jsxs("div",{className:"absolute z-10 w-64 bg-customBrown text-white px-2 py-2 rounded-lg shadow-lg flex flex-col items-start space-y-1 transform -translate-x-1/2 translate-y-40 left-1/2 transition-opacity duration-500 "+(e?"opacity-100":"opacity-0 pointer-events-none"),style:{maxWidth:"99%"},children:[n.jsx("span",{className:"font-semibold font-opensans text-sm",children:"Click here to rate vendor!"}),n.jsx("span",{className:"text-xs font-opensans",children:"Shopped from here? Share your experience with other shoppers!ðŸ§¡"}),n.jsx("button",{onClick:()=>{t(!1)},className:"absolute top-1 right-4",children:n.jsx(_,{className:"text-white text-lg"})}),n.jsx("div",{className:"absolute bottom-[-7px] left-1/2 transform -translate-x-1/2 w-4 h-4 bg-customBrown rotate-45"})," "]})},z=()=>{const{id:_}=e(),[z,D]=s.useState(null),[P,R]=s.useState([]),[G,V]=s.useState({}),[M,Q]=s.useState(!0),[W,Y]=s.useState(!1),{currentUser:H}=t(),[q,K]=s.useState(null),[J,X]=s.useState(!1),[Z,ee]=s.useState("All"),[se,te]=s.useState(""),[ae,re]=s.useState(!1),[ne,oe]=s.useState(!1),[le,ce]=s.useState(!1),ie=a(),de=r(),xe=new URLSearchParams(de.search).has("shared");s.useEffect((()=>{Q(!0),D(null),R([]);(async()=>{try{Q(!0);const e=S(F,"vendors",_),s=await I(e);if(s.exists()){const e=s.data();e.id=s.id,D(e),e.productIds&&e.productIds.length>0?await me(e.productIds):R([])}else L.error("Vendor not found!")}catch(e){L.error("Error fetching vendor data: "+e.message)}finally{Q(!1)}})()}),[_]),s.useEffect((()=>{Y(!1);(async()=>{if(H&&z)try{const e=$(F,"follows"),s=S(e,`${H.uid}_${z.id}`);(await I(s)).exists()?Y(!0):Y(!1)}catch(e){}})()}),[H,z]);const me=async e=>{try{const s=$(F,"products");if(!e||0===e.length)return void R([]);const t=[];for(let r=0;r<e.length;r+=10)t.push(e.slice(r,r+10));const a=[];for(const e of t){const t=A(s,B("__name__","in",e),B("published","==",!0)),r=(await E(t)).docs.map((e=>({id:e.id,...e.data()})));a.push(...r)}R(a)}catch(s){L.error("Error fetching products.")}},ue=P.filter((e=>e.name.toLowerCase().includes(se.toLowerCase())&&("All"===Z||e.productType===Z))).sort(((e,s)=>"priceAsc"===q?parseFloat(e.price)-parseFloat(s.price):"priceDesc"===q?parseFloat(s.price)-parseFloat(e.price):0));s.useEffect((()=>(document.body.style.overflow=J?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[J]);const he=e=>{V((s=>{if(s[e]){const{[e]:t,...a}=s;return a}return{...s,[e]:!0}}))};if(M)return n.jsx("div",{children:n.jsx(o,{})});if(!z)return n.jsxs("div",{className:"flex flex-col justify-center items-center h-3/6",children:[n.jsx(l,{className:"w-full h-full",animationData:c,loop:!0,autoplay:!0}),n.jsx("h1",{className:"text-xl text-center font-bold text-red-500",children:"Vendor is not found. You entered a wrong link or the vendor is not available."}),n.jsxs("button",{className:"w-full mt-4 h-12 rounded-full border font-medium flex items-center font-opensans justify-center transition-colors duration-200 bg-customOrange text-white",onClick:()=>{ie(H?"/browse-markets":"/confirm-user-state")},children:[" ","Go Back"]})]});const fe=()=>{te("")},pe=z.ratingCount>0?z.rating/z.ratingCount:0,ge=["All",...new Set(P.map((e=>e.productType)))];return n.jsxs(n.Fragment,{children:[n.jsx(i,{title:`${z.shopName} - My Thrift`,description:`Shop from ${z.shopName} on My Thrift`,image:z.coverImageUrl,url:`https://www.shopmythrift.store/marketstorepage/${_}`}),n.jsxs("div",{className:"p-3 mb-24",children:[n.jsx(O,{}),n.jsx("div",{className:"sticky top-0 bg-white h-20 z-20 flex items-center border-b border-gray-300 w-full",children:ae?n.jsxs("div",{className:"flex items-center w-full relative px-2",children:[n.jsx(d,{onClick:()=>{re(!1),fe()},className:"cursor-pointer text-2xl mr-2"}),n.jsx("input",{type:"text",value:se,onChange:e=>{te(e.target.value)},placeholder:"Search store...",className:"flex-1 border rounded-full font-opensans text-black text-sm border-gray-300 px-3 py-2 font-medium focus:outline-none"}),se&&n.jsx(x,{className:"text-xl text-gray-500 cursor-pointer absolute right-4",onClick:fe})]}):xe?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center",children:n.jsx(m,{onClick:()=>ie("/newhome"),className:"text-2xl cursor-pointer"})}),n.jsx("div",{className:"flex-1 flex justify-center items-center",children:n.jsx("img",{src:"/logo512.png",alt:"Logo",className:"object-contain max-h-[72px]"})}),n.jsx("div",{className:"flex items-center mr-2 relative",children:n.jsx(u,{className:"text-black text-3xl cursor-pointer",onClick:()=>re(!0)})})]}):n.jsxs("div",{className:"flex items-center justify-between w-full ",children:[n.jsx(h,{onClick:()=>ie(-1),className:"cursor-pointer text-3xl"}),n.jsx("h1",{className:"flex-grow text-center font-opensans text-lg font-semibold",children:z.shopName||"Not Found"}),n.jsx(u,{className:"text-black text-3xl cursor-pointer",onClick:()=>re(!0)})]})}),n.jsx("div",{className:"flex justify-center mt-6",children:n.jsx("div",{className:"relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:M?n.jsx(f,{circle:!0,height:128,width:128}):z.coverImageUrl?n.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:z.coverImageUrl,alt:z.shopName}):n.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:"https://images.saatchiart.com/saatchi/1750204/art/9767271/8830343-WUMLQQKS-7.jpg",alt:"Default Image"})})}),n.jsx("div",{className:"flex justify-center mt-2",style:{cursor:"pointer"},onClick:()=>{ie(`/reviews/${_}`)},children:M?n.jsx(f,{width:100,height:24}):n.jsxs(n.Fragment,{children:[n.jsx(p,{className:"text-yellow-400",size:16}),n.jsxs("span",{className:"flex text-xs font-opensans items-center ml-2",children:[pe.toFixed(1),n.jsx(g,{className:"mx-1 text-gray-300 font-opensans dot-size"}),z.ratingCount||0," ratings"]})]})}),n.jsx("div",{className:"w-fit text-center bg-customGreen p-2 flex items-center justify-center rounded-full mt-3 mx-auto",children:n.jsx("div",{className:"mt-2 flex flex-wrap items-center -translate-y-1 justify-center text-textGreen text-xs space-x-1",children:M?n.jsx(f,{width:80,height:24,count:4,inline:!0}):z.categories.map(((e,s)=>n.jsxs(j.Fragment,{children:[s>0&&n.jsx(g,{className:"mx-1 dot-size text-dotGreen"}),n.jsx("span",{children:e})]},s)))})}),n.jsx("div",{className:"flex items-center justify-center mt-3",children:M?n.jsx(f,{width:128,height:40}):n.jsx("button",{className:"w-full h-12 rounded-full border font-medium flex items-center font-opensans justify-center transition-colors duration-200 bg-customOrange text-white",onClick:async()=>{if(H)try{if(oe(!0),!(null==z?void 0:z.id))throw new Error("Vendor ID is undefined");const e=$(F,"follows"),s=S(e,`${H.uid}_${z.id}`);W?(await U(s),L.success("Unfollowed")):(await T(s,{userId:H.uid,vendorId:z.id,createdAt:new Date}),L.success("You will be notified of new products and promos.")),Y(!W)}catch(e){L.error(`Error following/unfollowing: ${e.message}`)}finally{oe(!1)}else X(!0)},disabled:ne,children:ne?n.jsx(w,{className:"animate-spin mr-2"}):W?n.jsxs(n.Fragment,{children:[n.jsx(b,{className:"mr-2"}),"Following"]}):n.jsxs(n.Fragment,{children:[n.jsx(N,{className:"mr-2"}),"Follow"]})})}),n.jsx("p",{className:" text-gray-700 mt-3 text-sm font-opensans text-center",children:M?n.jsx(f,{count:2}):z.description}),n.jsxs("div",{className:"p-2 mt-7",children:[n.jsxs("div",{className:"flex items-center mb-3 justify-between",children:[n.jsx("h1",{className:"font-opensans text-lg  font-semibold",children:"Products"}),n.jsxs("div",{className:"relative",children:[le&&n.jsxs("div",{className:"z-50 absolute bg-white w-44 h-20 rounded-2.5xl shadow-[0_0_10px_rgba(0,0,0,0.1)] -left-24 top-2 p-3 flex flex-col justify-between",children:[n.jsx("span",{className:"text-xs font-opensans ml-2 cursor-pointer "+("priceAsc"===q?"text-customOrange":"text-black"),onClick:()=>{K("priceAsc"),ce(!le)},children:"Low to High"}),n.jsx("hr",{className:"text-slate-300"}),n.jsx("span",{className:"text-xs ml-2 font-opensans cursor-pointer "+("priceDesc"===q?"text-customOrange":"text-black"),onClick:()=>{K("priceDesc"),ce(!le)},children:"High to Low"})]}),n.jsxs("span",{className:"flex text-xs font-opensans items-center",children:["Sort by Price:"," ",n.jsx(y,{className:"text-customOrange cursor-pointer ml-1",onClick:()=>ce(!le)})]})]})]}),n.jsx("div",{className:"flex  mb-4 w-full overflow-x-auto space-x-2 scrollbar-hide",children:ge.map((e=>n.jsx("button",{onClick:()=>(e=>{ee(e)})(e),className:"flex-shrink-0 h-12 px-4 py-2 text-xs font-semibold font-opensans text-black border border-gray-400 rounded-full "+(Z===e?"bg-customOrange text-white":"bg-transparent"),children:e},e)))}),M?n.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:Array.from({length:6}).map(((e,s)=>n.jsx(f,{height:200,width:"100%"},s)))}):ue.length>0?n.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:ue.map((e=>n.jsx(v,{product:e,isFavorite:!!G[e.id],onFavoriteToggle:he,onClick:()=>{ie(`/product/${e.id}`)},showVendorName:!1},e.id)))}):n.jsx("div",{className:"flex justify-center items-center  w-full text-center",children:n.jsxs("p",{className:"font-opensans text-xs text-gray-800",children:["ðŸ“­ ",n.jsx("span",{className:"",children:z.shopName})," hasn't added any products to their online store yet. Check back soon for new items!"]})})]}),J&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:e=>{e.target===e.currentTarget&&X(!1)},children:n.jsxs("div",{className:"bg-white w-9/12 max-w-md rounded-lg px-3 py-4 flex flex-col",onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsxs("div",{className:"flex space-x-4",children:[n.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:n.jsx(k,{className:"text-customRichBrown"})}),n.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Please Log In"})]}),n.jsx(C,{onClick:()=>X(!1),className:"text-black text-xl mb-6 cursor-pointer"})]}),n.jsx("p",{className:"mb-6 text-xs font-opensans text-gray-800 ",children:"You need to be logged in to follow this vendor to recieve notifications. Please log in to your account, or create a new account if you donâ€™t have one, to continue."}),n.jsxs("div",{className:"flex space-x-16",children:[n.jsx("button",{onClick:()=>{ie("/signup"),X(!1)},className:"flex-1 bg-transparent py-2 text-customRichBrown font-medium text-xs font-opensans border-customRichBrown border rounded-full",children:"Sign Up"}),n.jsx("button",{onClick:()=>{ie("/login"),X(!1)},className:"flex-1 bg-customOrange py-2 text-white text-xs font-opensans rounded-full",children:"Login"})]})]})})]})]})};export{z as default};
