import{u as e,k as s,h as t,r,l as a,q as n,e7 as d,w as o,c,a as i,o as l,d as x,j as u,F as m,S as h,Q as p,_ as f,ac as g,y as b}from"./index-CvIXhaMv.js";import{g as j}from"./index-DV9LhBdq.js";const y=e=>Number(e||0).toLocaleString("en-NG",{style:"currency",currency:"NGN",maximumFractionDigits:0});function v(){const{offerId:v}=e(),N=s(),w=t(),I="offerThread"===new URLSearchParams(N.search).get("type"),k=new URLSearchParams(N.search).get("vendorId"),A=new URLSearchParams(N.search).get("productId"),[S,O]=r.useState(null),[R,C]=r.useState(null),[P,$]=r.useState(!0);r.useEffect((()=>{const e=a.currentUser;if(!e)return void w("/login");if(I&&k&&A){const s=n(c(i,"offers"),o("buyerId","==",e.uid),o("vendorId","==",k),o("productId","==",A),d("createdAt","asc")),t=l(s,(async e=>{const s=e.docs.map((e=>({id:e.id,...e.data()})));if(!s.length)return O(null),void $(!1);const t=s[s.length-1];if(O(t),s.forEach((e=>{e.buyerRead||g(x(i,"offers",e.id),{buyerRead:!0}).catch((()=>{}))})),t.productId&&!R)try{const e=await b(x(i,"products",t.productId));e.exists()&&C({id:e.id,...e.data()})}catch(r){}$(!1)}),(e=>{$(!1),f.error("Could not load thread.")}));return()=>t()}const s=x(i,"offers",v),t=l(s,(async e=>{if(!e.exists())return O(null),void $(!1);const t={id:e.id,...e.data()};if(O(t),t.buyerRead||g(s,{buyerRead:!0}).catch((()=>{})),t.productId&&!R)try{const e=await b(x(i,"products",t.productId));e.exists()&&C({id:e.id,...e.data()})}catch(r){}$(!1)}),(e=>{$(!1),f.error("Could not load offer.")}));return()=>t()}),[v,I,k,A,w]);const L=(null==R?void 0:R.price)??(null==S?void 0:S.listPrice)??0,_=e=>(null==e?void 0:e.toDate)?e.toDate().toLocaleString([],{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}):"",B="countered"===(null==S?void 0:S.status)?null==S?void 0:S.counterAmount:"accepted"===(null==S?void 0:S.status)?null==S?void 0:S.amount:null,D=()=>{(null==S?void 0:S.productId)&&null!=B&&w(`/product/${S.productId}?shared=true`,{state:{offerPrice:Number(B)}})};return P?u.jsx(m,{}):S?u.jsxs(u.Fragment,{children:[u.jsx(h,{title:`Offer – ${S.productName||"Item"}`,description:"View your offer and the vendor’s response.",url:I?`https://www.shopmythrift.store/offers/thread?vendorId=${k}&productId=${A}`:`https://www.shopmythrift.store/offers/${v}`}),u.jsxs("div",{className:"flex flex-col h-[100dvh] bg-white",children:[u.jsxs("div",{className:"sticky top-0 z-10 bg-white border-b px-4 py-3 flex items-center",children:[u.jsx(p,{className:"text-2xl text-gray-700 cursor-pointer mr-4",onClick:()=>w("/offers")}),u.jsxs("div",{className:"flex-1",children:[u.jsx("div",{className:"text-lg font-opensans font-semibold",children:S.productName||"Product"}),u.jsx("div",{className:"text-sm text-gray-500 font-opensans",children:S.vendorShopName||"Vendor"})]})]}),u.jsxs("div",{className:"overflow-auto scrollbar-hide",children:[u.jsxs("div",{className:"px-4 py-4",children:[u.jsx("div",{className:"w-64 h-64 rounded-lg overflow-hidden ml-auto",children:u.jsx("img",{src:S.productCover||"/placeholder.png",alt:"product",className:"w-full h-full object-cover"})}),u.jsxs("p",{className:"text-xs text-right font-opensans mt-2",children:["Your offer for"," ",u.jsx("span",{className:"uppercase text-customOrange font-semibold",children:S.productName||"Item"}),"."]})]}),u.jsxs("div",{className:"flex-1 px-4 space-y-6",children:[u.jsx("div",{className:"flex justify-end",children:u.jsxs("div",{children:[u.jsxs("div",{className:"bg-customOrange text-white rounded-lg px-4 py-2 font-opensans max-w-xs",children:[u.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[u.jsx("span",{className:"line-through opacity-80",children:y(L)}),u.jsx("span",{className:"font-semibold",children:y(S.amount)})]}),u.jsxs("div",{children:["I want to get this item for ",y(S.amount)]})]}),u.jsx("div",{className:"mt-1 text-xs text-gray-400 text-right font-opensans",children:_(S.createdAt)})]})}),"countered"===S.status&&S.counterAmount&&u.jsxs("div",{className:"flex",children:[u.jsx(j,{className:"w-10 h-10 text-gray-400 mr-3"}),u.jsxs("div",{children:[u.jsxs("div",{className:"bg-blue-50 text-blue-900 rounded-lg px-4 py-2 font-opensans max-w-xs",children:[u.jsxs("div",{className:"mb-2",children:["Vendor countered at ",y(S.counterAmount),"."," "]}),u.jsx("button",{onClick:D,className:"text-xs px-3 py-1.5 rounded-md bg-customRichBrown text-white font-opensans",children:"Buy now"})]}),u.jsx("div",{className:"mt-1 text-xs text-gray-400 font-opensans",children:_(S.counteredAt)})]})]}),"accepted"===S.status&&u.jsxs("div",{className:"flex",children:[u.jsx(j,{className:"w-10 h-10 text-gray-400 mr-3"}),u.jsxs("div",{children:[u.jsxs("div",{className:"bg-green-50 text-green-900 rounded-lg px-4 py-2 font-opensans max-w-xs",children:[u.jsxs("div",{className:"mb-2",children:["Offer accepted — proceed to checkout."," "]}),u.jsx("button",{onClick:D,className:"text-xs px-3 py-1.5 rounded-md bg-customRichBrown text-white font-opensans",children:"Buy now"})]}),u.jsx("div",{className:"mt-1 text-xs text-gray-400 font-opensans",children:_(S.acceptedAt)})]})]}),"declined"===S.status&&u.jsxs("div",{className:"flex",children:[u.jsx(j,{className:"w-10 h-10 text-gray-400 mr-3"}),u.jsxs("div",{children:[u.jsx("div",{className:"bg-red-50 text-red-900 rounded-lg px-4 py-2 font-opensans max-w-xs",children:"Offer declined."}),u.jsx("div",{className:"mt-1 text-xs text-gray-400 font-opensans",children:_(S.declinedAt)})]})]})]})]}),u.jsx("div",{className:"border-t px-4 py-3",children:(()=>{const e={pending:{bg:"bg-amber-50",text:"text-amber-800",ring:"ring-amber-200",dot:"bg-amber-500",label:"Pending"},countered:{bg:"bg-sky-50",text:"text-sky-800",ring:"ring-sky-200",dot:"bg-sky-500",label:"Countered"},accepted:{bg:"bg-emerald-50",text:"text-emerald-800",ring:"ring-emerald-200",dot:"bg-emerald-500",label:"Accepted"},declined:{bg:"bg-rose-50",text:"text-rose-800",ring:"ring-rose-200",dot:"bg-rose-500",label:"Declined"},expired:{bg:"bg-slate-50",text:"text-slate-700",ring:"ring-slate-200",dot:"bg-slate-400",label:"Expired"}},s=String((null==S?void 0:S.status)||"pending").toLowerCase(),t=e[s]||e.pending;return u.jsx("div",{className:"w-full flex items-center justify-center",children:u.jsxs("span",{className:["inline-flex items-center gap-2 font-opensans px-3 py-1 rounded-full text-[10px] font-semibold","ring-1 shadow-[inset_0_0_0_1px_rgba(255,255,255,0.5)]",t.bg,t.text,t.ring].join(" "),children:[u.jsx("span",{className:`w-1.5 h-1.5 rounded-full ${t.dot} ${"pending"===s?"animate-pulse":""}`}),u.jsx("span",{children:t.label})]})})})()}),u.jsx("div",{className:"px-4 pb-5",children:u.jsxs("div",{className:"mx-auto max-w-md rounded-2xl border border-gray-200 bg-gradient-to-br from-white to-gray-50 p-4 text-center shadow-sm",children:[("accepted"===S.status||"countered"===S.status)&&u.jsxs("p",{className:"text-xs text-gray-800 font-opensans leading-relaxed",children:["Offers that are ",u.jsx("b",{children:"accepted"})," or ",u.jsx("b",{children:"countered"})," with a lower price than your initial offer will have their price"," ",u.jsx("b",{className:"text-customOrange",children:"locked for 6 hours"}),". After this window, the item returns to its initial price. Offers are"," ",u.jsx("b",{children:"unique to your account"}),"."]}),"declined"===S.status&&u.jsxs("p",{className:"text-xs text-gray-800 font-opensans leading-relaxed",children:["A declined offer means the price wasn’t fair for the vendor. If you improve your offer by"," ",u.jsx("b",{className:"text-customOrange",children:"20% or more"}),", they may reconsider — though acceptance isn’t guaranteed."]}),"pending"===S.status&&u.jsx("p",{className:"text-xs text-gray-800 font-opensans leading-relaxed",children:"Your offer is pending. We’ll notify you when the vendor responds. You can always return here to check the status."})]})})]})]}):u.jsx("div",{className:"h-[100dvh] grid place-items-center text-gray-500",children:"Offer not found."})}export{v as default};
