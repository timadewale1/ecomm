import{g as e,q as s,w as t,dL as a,c as r,a as l,j as i,dM as n,dN as o,dO as c,dP as d,dQ as m,dR as u,d as x,A as p,y as f,ab as h,s as g,ac as b,ad as v,aa as j,h as w,r as N,aF as y,M as k,a1 as S,I as C,b as I,dS as D,dT as A,dU as O,dV as P,dW as F,cn as M,dX as L,dY as R,dZ as E,d_ as _,_ as Y,d$ as T,k as $,ay as V,f as H,l as q,T as B,o as U,dJ as z,dK as W,d1 as Z,B as G,az as Q,F as K,S as J,bg as X,Q as ee,e0 as se,e1 as te,e2 as ae,Z as re,aG as le,c5 as ie,e3 as ne,R as oe,e4 as ce,ca as de,an as me,ao as ue,ap as xe,cY as pe,e5 as fe,e6 as he,aq as ge,ar as be}from"./index-CvIXhaMv.js";import{c as ve,j as je,k as we,l as Ne}from"./index-CGdwSzPY.js";import{S as ye,a as ke}from"./swiper-react-Ew1PjN2i.js";/* empty css               */import{R as Se}from"./SimilarProducts-cBCWjwT5.js";import{a as Ce}from"./index-R3h_Od-2.js";import{L as Ie}from"./LinkAccountModal-Nm9KGm0X.js";const De="data:image/svg+xml,%3csvg%20width='102'%20height='102'%20viewBox='0%200%20102%20102'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M14.854%2091.0425L81.2098%2012.7734C83.3056%2012.7734%2087.1465%2012.9647%2087.1465%2018.1444V93.473C87.1465%2095.5688%2085.4492%2097.2661%2083.3534%2097.2661H19.4599C17.3642%2097.2741%2014.854%2095.3934%2014.854%2091.0425Z'%20fill='%23915744'/%3e%3cpath%20d='M14.854%2091.1466V16.3678C14.854%2014.3677%2016.4717%2012.75%2018.4718%2012.75H81.0903C83.0904%2012.75%2084.7081%2014.3677%2084.7081%2016.3678V91.1466C84.7081%2093.1467%2083.0904%2094.7644%2081.0903%2094.7644H18.4718C16.4717%2094.7644%2014.854%2093.1467%2014.854%2091.1466Z'%20fill='%23BE7159'/%3e%3cpath%20d='M22.6709%2087.3845V19.937C22.6709%2018.909%2023.5076%2018.0723%2024.5356%2018.0723H75.8703C76.8982%2018.0723%2077.735%2018.909%2077.735%2019.937V87.3845C77.735%2088.4124%2076.8982%2089.2491%2075.8703%2089.2491H24.5356C23.5076%2089.2491%2022.6709%2088.4204%2022.6709%2087.3845Z'%20fill='white'/%3e%3cpath%20d='M30.7993%2043.3176H69.6071M30.7993%2034.1934H69.6071M30.7993%2052.4418H69.6071M30.7993%2061.574H69.6071M30.7993%2070.6982H69.6071M30.7993%2079.8224H47.3982'%20stroke='%23F9AC93'%20stroke-width='2.39062'%20stroke-miterlimit='10'%20stroke-linecap='round'/%3e%3cpath%20opacity='0.35'%20d='M69.2722%2022.6308V12.7734H58.1318L65.0726%2022.6308H69.2722Z'%20fill='%23212121'/%3e%3cpath%20d='M62.1641%2013.1406L59.5982%2013.1007C57.8928%2013.1007%2057.5741%2011.5867%2057.5103%2011.2679C57.4227%2010.8535%2057.3111%209.93713%2057.2633%209.57056C56.833%205.99259%2055.6058%203.79322%2051.1353%203.28322C47.2625%202.84494%2044.4814%206.82134%2044.4814%2010.6145V10.6463C44.4894%2012.3596%2043.1905%2013.794%2041.4772%2013.794C41.4772%2013.794%2036.4728%2012.9413%2032.8949%2017.0373C32.2255%2017.8023%2031.4207%2020.9579%2031.4127%2021.8424C31.3967%2024.3048%2033.5244%2024.6315%2034.2655%2024.6395C37.5964%2024.6634%2064.73%2024.5757%2067.3278%2024.5757C68.3957%2024.5757%2069.2642%2023.7071%2069.2642%2022.6393V21.197C69.2722%2017.101%2066.2521%2013.1406%2062.1641%2013.1406ZM50.9122%2013.3557C50.5617%2013.3557%2050.2145%2013.2867%2049.8906%2013.1525C49.5668%2013.0184%2049.2725%2012.8217%2049.0246%2012.5738C48.7767%2012.3259%2048.58%2012.0317%2048.4459%2011.7078C48.3117%2011.3839%2048.2427%2011.0368%2048.2427%2010.6862C48.2427%2010.3356%2048.3117%209.98849%2048.4459%209.6646C48.58%209.34072%2048.7767%209.04643%2049.0246%208.79854C49.2725%208.55066%2049.5668%208.35402%2049.8906%208.21986C50.2145%208.08571%2050.5617%208.01666%2050.9122%208.01666C51.6202%208.01666%2052.2992%208.29791%2052.7999%208.79854C53.3005%209.29918%2053.5817%209.97818%2053.5817%2010.6862C53.5817%2011.3942%2053.3005%2012.0732%2052.7999%2012.5738C52.2992%2013.0745%2051.6202%2013.3557%2050.9122%2013.3557Z'%20fill='%23C74218'/%3e%3cpath%20d='M60.706%2012.7427H59.1601C57.4548%2012.7427%2056.7695%2011.4039%2056.5543%2010.9418C56.2435%2010.2644%2056.1559%208.88582%2056.1001%208.51926C55.6538%205.70629%2053.3031%203.47504%2050.4742%203.17222C46.6013%202.74988%2043.3182%205.77801%2043.3182%209.56316V9.59504C43.3262%2011.3083%2042.0273%2012.7427%2040.314%2012.7427H38.7999C36.8366%2012.7427%2034.9536%2013.5226%2033.5653%2014.911C32.1769%2016.2993%2031.397%2018.1823%2031.397%2020.1457V21.588C31.397%2022.6558%2032.2656%2023.5244%2033.3334%2023.5244H66.1646C67.2324%2023.5244%2068.101%2022.6558%2068.101%2021.588V20.1457C68.109%2016.0577%2064.794%2012.7427%2060.706%2012.7427ZM49.749%2012.3124C49.3984%2012.3124%2049.0513%2012.2433%2048.7274%2012.1092C48.4035%2011.975%2048.1092%2011.7784%2047.8614%2011.5305C47.6135%2011.2826%2047.4168%2010.9883%2047.2827%2010.6644C47.1485%2010.3406%2047.0795%209.99342%2047.0795%209.64285C47.0795%209.29228%2047.1485%208.94515%2047.2827%208.62126C47.4168%208.29738%2047.6135%208.0031%2047.8614%207.75521C48.1092%207.50732%2048.4035%207.31068%2048.7274%207.17652C49.0513%207.04237%2049.3984%206.97332%2049.749%206.97332C50.457%206.97332%2051.136%207.25457%2051.6366%207.75521C52.1373%208.25584%2052.4185%208.93485%2052.4185%209.64285C52.4185%2010.3509%2052.1373%2011.0299%2051.6366%2011.5305C51.136%2012.0311%2050.457%2012.3124%2049.749%2012.3124Z'%20fill='%23F9531E'/%3e%3cpath%20d='M62.929%2017.5623H35.7715C34.7356%2017.5623%2034.4646%2016.9806%2034.9985%2016.0961C35.7795%2014.8131%2037.6442%2013.9684%2039.2379%2013.9684C42.6964%2013.9684%2055.1754%2013.5859%2059.5662%2013.5859C61.7098%2013.5859%2062.8254%2014.3031%2063.7578%2015.4984C64.4192%2016.3591%2064.0048%2017.5623%2062.929%2017.5623Z'%20fill='%23FF9C7D'/%3e%3cpath%20d='M45.4058%207.55359C45.852%205.73672%2047.5653%205.21875%2047.5653%205.21875'%20stroke='%23FF9C7D'%20stroke-width='1.68619'%20stroke-miterlimit='10'%20stroke-linecap='round'/%3e%3c/svg%3e",Ae={label:"Piling",value:"Piling",icon:i.jsx(m,{})},Oe=[{label:"Pending",value:"Pending",icon:i.jsx(n,{})},{label:"Declined",value:"Declined",icon:i.jsx(u,{})}],Pe=({orderStatus:e,isStockpile:s,isPickup:t})=>{const a=[{label:"Pending",value:"Pending",icon:i.jsx(n,{})},{label:"Accepted",value:"In Progress",icon:i.jsx(o,{})},{label:t?"Scheduled":"Shipped",value:"Shipped",icon:t?i.jsx(c,{}):i.jsx(ve,{})},{label:"Delivered",value:"Delivered",icon:i.jsx(d,{})}];let r=a;"Declined"===e?r=Oe:s&&["in progress","piling","shipped","delivered"].includes(null==e?void 0:e.toLowerCase())&&(r=[...a.slice(0,2),Ae,...a.slice(2)]);const l=r.findIndex((s=>s.value===e));return i.jsx("div",{className:"overflow-x-auto w-full my-2",children:i.jsx("div",{className:"flex items-center",children:r.map(((e,s)=>{const t=s<=l,a=s===r.length-1,n="Declined"===e.value&&t,o=`\n            flex items-center space-x-1 px-2 py-1 rounded-full border-2\n            ${n?"bg-red-600 border-red-600":t?"border-customOrange bg-white":"border-gray-300 bg-gray-100 opacity-30"}\n          `;return i.jsxs("div",{className:"flex items-center",children:[i.jsxs("div",{className:o,children:[i.jsx("span",{className:n?"text-white":t?"text-customRichBrown":"text-black",children:e.icon}),i.jsx("span",{className:"text-[9px] font-medium "+(n?"text-white":"text-black"),children:e.label})]}),!a&&i.jsx("div",{className:"h-0.5 w-4 "+(n?"bg-red-600":t?"bg-customOrange":"bg-gray-300")})]},s)}))})})};k.setAppElement("#root");const Fe=({showPopup:e,onRequestClose:s,isStockpile:t,currentUser:a,order:r})=>{var n,o,c;const d=w();N.useEffect((()=>{e&&(async()=>{if((null==a?void 0:a.uid)&&(null==r?void 0:r.vendorId))try{const e=x(l,"follows",`${a.uid}_${r.vendorId}`);(await f(e)).exists()?T(!0):T(!1)}catch(e){}})()}),[e,a,r]);const m=(null==(n=r.createdAt)?void 0:n.seconds)?y(1e3*r.createdAt.seconds).add(r.stockpileDuration||2,"weeks").format("dddd, MMM Do"):null,[u,T]=N.useState(!1),[$,V]=N.useState(!1),H=Boolean((null==r?void 0:r.isPickup)??(null==(o=null==r?void 0:r.userInfo)?void 0:o.isPickup));if(!e)return null;const q=(null==(c=r.cartItems)?void 0:c.length)||1,B=(.45*(q-1)).toFixed(2),U=t?[{icon:i.jsx(A,{className:"text-green-600 text-2xl"}),title:"You're Making a Difference",text:q>1?i.jsxs(i.Fragment,{children:["By stockpiling, you've prevented"," ",i.jsxs("span",{className:"font-bold text-green-500",children:[B,"kg"]})," ","of COâ‚‚ from entering the atmosphere. High five for going green ðŸŒ!"]}):"By stockpiling your order, you're helping reduce delivery emissions. Add more items to make an even bigger eco impact ðŸŒ¿!"},{icon:i.jsx(O,{className:"text-amber-800 text-2xl"}),title:"Vendor Is In",text:"Your pile has been received by the vendor. Feel free to keep adding more items."},{icon:i.jsx(P,{className:"text-yellow-500 text-2xl"}),title:"Never Miss a Drop",text:"Follow this vendor to get real-time alerts when they post new gems."},{icon:i.jsx(F,{className:"text-purple-500 text-2xl"}),title:"Pile Expiry Date",text:i.jsxs(i.Fragment,{children:["This pile is valid till"," ",i.jsx("span",{className:"font-bold text-customOrange",children:m}),". We'll ping you when itâ€™s almost time to ship."]})},{icon:i.jsx(M,{className:"text-gray-800 text-2xl"}),title:"You're in Control",text:"Want it shipped earlier? No stress. You can request dispatch anytime before the deadline."}]:[{icon:i.jsx(Ce,{className:"text-blue-500 text-xl"}),title:"Order Received",text:"Your order has been placed and the vendor has been notified. We will keep you in the loop."},H?{icon:i.jsx(L,{className:"text-emerald-600 text-xl"}),title:"Pick-up Code",text:i.jsxs(i.Fragment,{children:["Your order is secured with a unique pick-up code",i.jsx("br",{}),"The vendor will soon inform you of the exact day and time your items will be ready. Please keep the provided pick-up code safeâ€”you'll need it to collect your order."]})}:{icon:i.jsx(R,{className:"text-yellow-500 text-xl"}),title:"Fulfilment Timeline",text:"Orders typically take 3â€“7 days to be fulfilled. Weâ€™re working to shorten that timeline."},{icon:i.jsx(E,{className:"text-green-600 text-xl"}),title:"Buyer Protection",text:"We hold a percentage of your payment. The vendor only gets paid in full once delivery is confirmed."},{icon:i.jsx(_,{className:"text-red-500 text-xl"}),title:"Support",text:"If thereâ€™s any issue with what you received, please contact our support immediately."}];return i.jsx(k,{isOpen:e,onRequestClose:s,shouldCloseOnOverlayClick:!0,className:"fixed bottom-0 left-1/2 transform -translate-x-1/2 w-full  max-h-[90vh] rounded-t-3xl bg-white shadow-lg p-6 z-50 outline-none",overlayClassName:"fixed inset-0 bg-black/30 backdrop-blur-xs flex justify-center items-end z-40",closeTimeoutMS:300,children:i.jsx(S,{children:e&&i.jsxs(C.div,{initial:{y:200,opacity:0},animate:{y:0,opacity:1},exit:{y:200,opacity:0},transition:{type:"spring",stiffness:300,damping:25},children:[i.jsxs("div",{className:"flex justify-between items-center mb-2",children:[i.jsx("h2",{className:"text-xl font-opensans font-bold text-customRichBrown",children:t?"Stockpile Confirmation":"Order Confirmation"}),i.jsx("div",{className:"w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center",children:i.jsx(I,{onClick:s,className:"text-xl cursor-pointer text-gray-600"})})]}),i.jsx("div",{className:"border-b border-gray-200 mb-4"}),i.jsx("div",{className:"space-y-4 ",children:U.map(((e,s)=>i.jsxs("div",{className:"flex gap-3  bg-gray-50 px-2 py-1 rounded-lg items-start",children:[i.jsx("div",{className:"pt-1",children:e.icon}),i.jsxs("div",{children:[i.jsx("p",{className:"font-semibold font-opensans  text-base text-gray-900",children:e.title}),i.jsx("p",{className:"text-xs font-opensans text-gray-700 mt-1",children:e.text})]})]},s)))}),i.jsx("div",{className:"mt-8",children:u?i.jsx("button",{onClick:()=>{s(),d("/newhome")},className:"w-full py-3 mb-3 rounded-md font-opensans font-medium bg-customOrange text-white",children:"Continue Shopping"}):i.jsx("button",{onClick:async()=>{if(a)try{V(!0);const e={id:r.vendorId};(await(async(e,s)=>{if(!(null==s?void 0:s.id))throw new Error("Vendor ID is undefined");const t=x(l,"follows",`${e}_${s.id}`),a=x(l,"vendors",s.id);return await p(e,"follow",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:8,hourLimit:40}),(await f(t)).exists()?(await j(t),{followed:!1}):(await h(t,{userId:e,vendorId:s.id,createdAt:g()}),await b(a,{followersCount:v(1)}),{followed:!0})})(a.uid,e)).followed?(Y.success("Youâ€™re now following this vendor! You will be notified of new items and promos"),T(!0),s()):(Y.success("You have unfollowed this vendor."),T(!1))}catch(e){Y.error(e.message)}finally{V(!1)}else Y.error("Please log in to follow the vendor.")},disabled:$,className:"w-full py-3 mb-3 rounded-md font-opensans font-medium bg-customOrange text-white",children:$?i.jsx("div",{className:"flex justify-center items-center",children:i.jsx(D,{className:"animate-spin mr-2"})}):"Follow Vendor"})})]})})})};function Me({onLink:e,onClose:s}){return i.jsxs("div",{className:"w-full bg-amber-50 border border-amber-200 text-amber-900 px-4 py-3 flex items-center justify-between",children:[i.jsxs("div",{className:"flex items-center gap-2",children:[i.jsx(T,{className:"text-amber-600 text-7xl"}),i.jsxs("div",{className:"text-xs font-satoshi",children:[i.jsx("span",{className:"font-semibold",children:"Youâ€™re signed in as a guest."})," ","Link your email to secure your account and keep your orders safe."]})]}),i.jsx("div",{className:"flex items-center gap-2",children:i.jsx("button",{onClick:e,className:"px-2 py-1.5 font-opensans text-[6px] rounded-full text-white bg-amber-600 hover:bg-amber-700 text-sm font-medium",children:"Update"})})]})}const Le=({isOpen:e,onClose:s,onConfirm:t})=>e?i.jsx("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center px-4",children:i.jsxs("div",{className:"bg-white p-6 rounded-lg max-w-sm w-full",children:[i.jsx("h2",{className:"text-lg font-opensans font-semibold mb-4",children:"Confirm Shipping Request âš ï¸"}),i.jsx("p",{className:"text-sm text-gray-700 font-opensans mb-6",children:"This action cannot be undone. Requesting for shipping means you are ready for delivery. Ensure your items are complete and accurate before proceeding. THIS PILE WILL CLOSE!"}),i.jsxs("div",{className:"flex justify-end gap-3",children:[i.jsx("button",{onClick:s,className:" text-sm border border-customRichBrown text-customRichBrown font-opensans px-4 py-2 rounded",children:"Cancel"}),i.jsx("button",{onClick:t,className:"bg-customOrange font-opensans text-sm text-white px-4 py-2 rounded",children:"I Confirm"})]})]})}):null,Re=({expiresAtMs:e})=>{const[s,t]=N.useState("");return N.useEffect((()=>{const s=()=>{const s=e-Date.now();if(s<=0)t("Expired");else{const e=String(Math.floor(s/6e4)).padStart(2,"0"),a=String(Math.floor(s%6e4/1e3)).padStart(2,"0");t(`${e}:${a}`)}};s();const a=setInterval(s,500);return()=>clearInterval(a)}),[e]),i.jsx(i.Fragment,{children:s})},Ee=({isOpen:e,shareUrl:s,countdown:t,expiresAt:a,onClose:r})=>e?i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-60 z-50 flex items-center justify-center p-4",onClick:r,children:i.jsxs("div",{className:"bg-white rounded-lg p-4 w-[90%] max-w-sm",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"flex items-center  space-x-2 mb-4",children:[i.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(pe,{className:"text-customRichBrown"})}),i.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Link is ready to share!"}),i.jsx(de,{className:"-top-1 left-10 relative",onClick:r})]}),a&&i.jsxs("p",{className:"text-sm font-opensans mb-2 text-gray-900",children:["Expires in"," ",i.jsx("span",{className:"text-customOrange font-bold",children:i.jsx(Re,{expiresAtMs:a.getTime()})})]}),i.jsx("p",{className:"text-xs mb-4 font-opensans text-gray-900",children:"Weâ€™re holding this order for you! As soon as we receive your payment, weâ€™ll send you a confirmation email and the vendor will start processing it. Please note that this order hasnâ€™t been finalized yet."}),i.jsxs("div",{className:"flex items-center border border-customRichBrown rounded-md mt-8 px-3 py-2",children:[i.jsx("p",{className:"truncate w-full font-opensans text-sm",children:s}),i.jsx(fe,{className:"ml-2 text-lg text-gray-600 cursor-pointer hover:text-gray-800",onClick:()=>{navigator.clipboard.writeText(s),Y.success("Copied!")},title:"Copy link"})]})]})}):null,_e=()=>{var n;const o=w(),[d,p]=N.useState([]),[g,v]=N.useState({}),[j,S]=N.useState("All"),[C,I]=N.useState(null),[D,A]=N.useState([]),[O,P]=N.useState([]),[F,M]=N.useState(!0),[L,R]=N.useState(!1),[E,_]=N.useState(null),[T,pe]=N.useState(!1),[fe,Ce]=N.useState(0),[Ae,Oe]=N.useState(null),[_e,Ye]=N.useState(!1),[Te,$e]=N.useState(null),[Ve,He]=N.useState(!1),[qe,Be]=N.useState(null),[Ue,ze]=N.useState(null),[We,Ze]=N.useState(null),[Ge,Qe]=N.useState(!1),[Ke,Je]=N.useState(!1),[Xe,es]=N.useState(null),ss=N.useRef(!1),[ts,as]=N.useState(!1),[rs,ls]=N.useState(null),[is,ns]=N.useState(!1),[os,cs]=N.useState(null),[ds,ms]=N.useState(null),[us,xs]=N.useState(!1),ps=ds?Math.max(0,ds-Date.now()):0,fs=$(),{currentUser:hs}=V();null==(n=fs.state)||n.fromPaymentApprove;const gs=H();N.useEffect((()=>{window.scrollTo(0,0)})),N.useEffect((()=>{var e;(null==(e=fs.state)?void 0:e.draftShareUrl)&&(cs(fs.state.draftShareUrl),ms(new Date(fs.state.draftExpires)),xs(!0),o(fs.pathname,{replace:!0,state:{}}))}),[fs]),N.useEffect((()=>{const e=q.onAuthStateChanged((e=>{Qe(!!e&&!0===e.isAnonymous)}));return()=>e()}),[]),N.useEffect((()=>{if(!C||ss.current)return;(async()=>{try{const i=s(r(l,"orders"),t("userId","==",C)),n=(await e(i)).docs.map((e=>({id:e.id,...e.data()})));n.sort(((e,s)=>s.createdAt.seconds-e.createdAt.seconds));const o=[...new Set(n.map((e=>e.vendorId)))],c=await Promise.all(o.map((e=>f(x(l,"vendors",e))))),d={};c.forEach((e=>{e.exists()&&(d[e.id]={name:e.data().shopName,pickupLat:e.data().pickupLat??null,pickupLng:e.data().pickupLng??null,pickupAddress:e.data().pickupAddress??""})}));const m=n.map((e=>{var s,t,a,r;return{...e,vendorName:(null==(s=d[e.vendorId])?void 0:s.name)||"Unknown Vendor",pickupLat:(null==(t=d[e.vendorId])?void 0:t.pickupLat)||null,pickupLng:(null==(a=d[e.vendorId])?void 0:a.pickupLng)||null,pickupAddress:(null==(r=d[e.vendorId])?void 0:r.pickupAddress)||""}})),u=new Set;m.forEach((e=>e.cartItems.forEach((e=>u.add(e.productId)))));const h=await e(s(r(l,"products"),t(a(),"in",Array.from(u)))),g={};h.forEach((e=>{g[e.id]=e.data()}));const b=m.map((e=>{const s=e.cartItems.map((e=>{var s,t,a;const r=g[e.productId];let l="",i="",n=0,o="",c="";if(r)if(i=r.name,n=r.price,e.subProductId){const a=null==(s=r.subProducts)?void 0:s.find((s=>s.subProductId===e.subProductId));a&&(l=(null==(t=a.images)?void 0:t[0])||"",o=a.color||"",c=a.size||"",a.price&&(n=a.price))}else e.variantAttributes?(l=(null==(a=r.imageUrls)?void 0:a[0])||"",o=e.variantAttributes.color||"",c=e.variantAttributes.size||""):l=r.coverImageUrl||"";return{...e,name:i,price:n,imageUrl:l,color:o,size:c}}));return{...e,cartItems:s}})),v=new Map,j=new Set;for(const e of b)if(e.isStockpile&&e.stockpileDocId){const s=`stockpile-${e.vendorId}-${e.stockpileDocId}`;if(j.has(s))continue;const t=b.filter((s=>s.isStockpile&&s.vendorId===e.vendorId&&s.stockpileDocId===e.stockpileDocId));t.sort(((e,s)=>e.createdAt.seconds-s.createdAt.seconds)),j.add(s);const a=t.flatMap((e=>e.cartItems.map((s=>({...s,_orderId:e.id,_orderCreatedAt:e.createdAt}))))),r=t.map((e=>e.id)),i=t.reduce(((e,s)=>e+parseFloat(s.total||0)),0),n=t.reduce(((e,s)=>e+parseFloat(s.subtotal||0)),0),o=x(l,"stockpiles",e.stockpileDocId),c=await f(o);let d={};c.exists()&&(d=c.data());const m=t[0];v.set(s,{...e,cartItems:a,orderIds:r,combinedTotal:i,combinedSubtotal:n,stockpileDocId:e.stockpileDocId,chosenWeeks:d.chosenWeeks||null,endDate:d.endDate||null,isActive:d.isActive??null,firstOrderStatus:(null==m?void 0:m.progressStatus)||e.progressStatus,firstOrderCreatedAt:(null==m?void 0:m.createdAt)||null,firstOrderRiderInfo:(null==m?void 0:m.riderInfo)||null,firstOrderServiceFee:(null==m?void 0:m.serviceFee)||0})}else v.set(e.id,e);const w=Array.from(v.values()).sort(((e,s)=>s.createdAt.seconds-e.createdAt.seconds));p(w)}catch(i){}finally{M(!1)}})()}),[C]),N.useEffect((()=>{C&&(async()=>{try{const e=await f(x(l,"users",C));if(e.exists()){const s=e.data().location;(null==s?void 0:s.lat)&&(null==s?void 0:s.lng)&&Ze({lat:s.lat,lng:s.lng})}}catch(e){}})()}),[C]);N.useEffect((()=>{if(!C)return;const i=B.fromDate(new Date),n=s(r(l,"draftOrders"),t("ownerId","==",C),t("status","==","PAY_IN_PROGRESS"),t("expiresAt",">",i)),o=U(n,(async i=>{const n=i.docs.map((e=>({id:e.id,...e.data(),_isDraft:!0,progressStatus:"Awaiting Payment"}))),o=await async function(i){const n=Array.from(new Set(i.flatMap((e=>e.cartItems.map((e=>e.productId))))));if(0===n.length)return i;const o=await e(s(r(l,"products"),t(a(),"in",n))),c={};return o.forEach((e=>c[e.id]=e.data())),i.map((e=>({...e,cartItems:e.cartItems.map((e=>{var s,t,a;const r=c[e.productId]||{};return{...e,name:r.name,price:e.price??r.price,imageUrl:r.coverImageUrl||(null==(s=r.imageUrls)?void 0:s[0])||"",color:e.color||(null==(t=e.variantAttributes)?void 0:t.color)||r.color||"",size:e.size||(null==(a=e.variantAttributes)?void 0:a.size)||r.size||""}}))})))}(n);A(o)}));return o}),[C]),N.useEffect((()=>{const e=[...D,...d].sort(((e,s)=>{var t,a;return((null==(t=s.createdAt)?void 0:t.seconds)||s.createdAt)-((null==(a=e.createdAt)?void 0:a.seconds)||e.createdAt)}));P(e)}),[d,D]),N.useEffect((()=>{if(d.length>0){const e=d.find((e=>!0===e.showPopup));if(e){ls(e),as(!0),e.vendorId&&(gs(z(e.vendorId)),gs(W())),gs(Z());try{Object.keys(sessionStorage).filter((e=>e.startsWith("quickMode_"))).forEach((e=>sessionStorage.removeItem(e)))}catch{}}}}),[d,gs]);const{openChat:bs}=G(),vs=()=>{pe(!1)};N.useEffect((()=>{if(d.length>0){const e=d.find((e=>!0===e.showPopup));e&&(ls(e),as(!0))}}),[d]);const js=e=>{hs&&(gs(he({vendorId:e.vendorId})),o(`/store/${e.vendorId}?stockpile=1`))};if(N.useEffect((()=>{const e=Q(q,(e=>{I(e?e.uid:null),R(!0)}));return()=>e()}),[]),!L)return i.jsx(K,{});const ws=({isOpen:e,onClose:s,origin:t,destination:a})=>{var r;const[l,n]=N.useState(Boolean(null==(r=window.google)?void 0:r.maps));N.useEffect((()=>{l||(window.initMap=()=>n(!0))}),[l]);const[o,c]=N.useState(null);N.useEffect((()=>{l&&t&&a&&(new window.google.maps.DirectionsService).route({origin:t,destination:a,travelMode:"DRIVING"},((e,s)=>"OK"===s&&e.routes.length?c(e):void 0))}),[l,t,a]);const d=N.useRef(null),m=N.useRef(null);return N.useEffect((()=>{m.current&&o&&m.current.setDirections(o)}),[o]),N.useEffect((()=>()=>{m.current&&m.current.setMap(null)}),[]),e?i.jsxs(k,{isOpen:!0,onRequestClose:s,ariaHideApp:!1,className:"bg-white w-full h-[75vh] rounded-t-2xl shadow-xl flex flex-col",overlayClassName:"fixed inset-0 bg-black/50 flex items-end z-50",children:[i.jsx("div",{className:"flex-1",children:l?i.jsx("div",{id:"map",style:{height:"100%",width:"100%"},ref:e=>{var s;e&&!d.current&&(s=new window.google.maps.Map(e,{zoom:12,center:t}),d.current=s,m.current=new window.google.maps.DirectionsRenderer({map:s,preserveViewport:!0,suppressMarkers:!1}),o&&m.current.setDirections(o))}}):i.jsx("div",{className:"h-full flex items-center justify-center",children:"LoadingÂ mapâ€¦"})}),i.jsx("button",{onClick:s,className:"absolute font-opensans bottom-4 left-1/2 -translate-x-1/2\r\n                     px-6 py-3 text-base font-medium\r\n                     bg-black/20 backdrop-blur-md border border-white/30\r\n                     rounded-full shadow-md hover:bg-white/30\r\n                     transition-colors duration-200",children:"Close"})]}):null},Ns="All"===(ys=j)?O:"Stockpile"===ys?O.filter((e=>e.isStockpile)):"Pending"===ys?O.filter((e=>!!e._isDraft||(e.isStockpile?"Pending"===e.firstOrderStatus:"Pending"===e.progressStatus))):"Processing"===ys?O.filter((e=>e.isStockpile?"In Progress"===e.firstOrderStatus:"In Progress"===e.progressStatus)):"Delivered"===ys?O.filter((e=>e.isStockpile?"Delivered"===e.firstOrderStatus:"Delivered"===e.progressStatus)):"Shipped"===ys?O.filter((e=>e.isStockpile?"Shipped"===e.firstOrderStatus:"Shipped"===e.progressStatus)):"Declined"===ys?O.filter((e=>e.isStockpile?"Declined"===e.firstOrderStatus:"Declined"===e.progressStatus)):[];var ys;const ks=()=>Oe(null);return i.jsxs("div",{children:[i.jsx(J,{title:"Your Orders - My Thrift",description:"View your orders on My Thrift",url:"https://www.shopmythrift.store/user-orders"}),i.jsx(X,{}),i.jsx(Ie,{open:Ke,onClose:()=>Je(!1),onSubmit:async({email:a,password:i})=>{var n,o,c;const d=q.currentUser;if(!d||!d.isAnonymous)return void Y.error("You're not signed in as a guest.");const m=a.trim().toLowerCase();try{const a=x(l,"users",d.uid),p=await f(a),g=(null==(o=p.exists()?null==(n=p.data())?void 0:n.email:"")?void 0:o.toString().trim().toLowerCase())||"";if(g&&g!==m){const e=e=>{const[s,t]=e.split("@");if(!t)return e;return`${s.length<=2?s[0]+"*":s[0]+"***"+s.slice(-1)}@${t}`};return void Y.error(`Please use the same email you used earlier: ${e(g)}`)}const b=s(r(l,"vendors"),t("email","==",m));if(!(await e(b)).empty)return void Y.error("This email is already used for a Vendor account!");const v=s(r(l,"users"),t("email","==",m)),j=await e(v);if(!j.empty&&"vendor"===(null==(c=j.docs[0].data())?void 0:c.role))return void Y.error("This email is already used for a Vendor account!");if((await me(q,m)).length>0)return void Y.error("This email is already registered. Please sign in and weâ€™ll merge your data.");const w=ue.credential(m,i),N=await xe(d,w),y={uid:N.user.uid,email:m,accountLinked:!0,updatedAt:new Date};await h(a,p.exists()?y:{createdAt:new Date,role:"user",...y},{merge:!0});try{await sendEmailVerification(N.user)}catch(u){}Y.success("Account linked! Weâ€™ve sent a verification email."),Je(!1),Qe(!1)}catch(p){"auth/email-already-in-use"===p.code?Y.error("This email is already in use. Please sign in and link from settings."):"auth/invalid-credential"===p.code?Y.error("Invalid email or password."):Y.error("Could not link account. Please try again.")}}}),Ge&&i.jsx(Me,{onLink:()=>Je(!0),onClose:()=>Qe(!1)}),i.jsx(Ee,{isOpen:us,shareUrl:os,countdown:ps,expiresAt:ds,onClose:()=>xs(!1)}),ts&&rs&&i.jsx(Fe,{showPopup:ts,onRequestClose:async()=>{if(as(!1),rs)try{const e=x(l,"orders",rs.id);await b(e,{showPopup:!1}),ls(null)}catch(e){}},isStockpile:rs.isStockpile,order:rs,currentUser:hs}),i.jsxs("div",{className:"sticky top-0 pb-2 bg-white w-full z-10",children:[i.jsxs("div",{className:"flex p-3 py-3 items-center bg-white h-20 mb-3 pb-2",children:[i.jsx(ee,{className:"text-3xl cursor-pointer",onClick:()=>o("/profile")}),i.jsx("h1",{className:"text-xl font-opensans ml-5 font-semibold",children:"Orders"})]}),i.jsx("div",{className:"border-t border-gray-300 my-2"}),i.jsx("div",{className:"flex px-3 py-2 overflow-x-auto",children:i.jsx("div",{className:"flex space-x-3",children:["All","Stockpile","Pending","Processing","Shipped","Delivered","Declined"].map((e=>i.jsx("button",{onClick:()=>S(e),className:"px-3 py-2 border h-12 rounded-full "+(j===e?"bg-customOrange text-xs font-opensans text-white":"bg-white text-xs font-opensans text-black"),children:e},e)))})})]}),null===C?i.jsxs("div",{className:"flex flex-col items-center justify-center mt-10",children:[i.jsx("div",{className:"bg-gray-200 flex justify-center rounded-full w-32 h-32 p-2",children:i.jsx("img",{src:De,alt:"Order"})}),i.jsxs("div",{className:"mt-20 flex items-center flex-col justify-center",children:[i.jsx("p",{className:"text-gray-600 font-opensans text-center text-xs",children:"Please login to view your order progress status and history."}),i.jsx("button",{className:"text-white font-opensans font-semibold h-11 mt-3 mb-14 bg-customOrange rounded-full w-32",onClick:()=>{o("/login",{state:{from:fs.pathname}})},children:"Login"})]}),Xe&&i.jsx(Se,{product:Xe})]}):i.jsx(i.Fragment,{children:F?i.jsx(K,{}):0===Ns.length?i.jsxs("div",{className:"flex flex-col items-center justify-center mt-10",children:[i.jsx("div",{className:"bg-gray-200 flex justify-center rounded-full w-32 h-32 p-2",children:i.jsx("img",{src:De,alt:"Order"})}),i.jsxs("div",{className:"mt-20",children:[i.jsx("p",{className:"text-gray-600 font-opensans text-center text-xs",children:"No order available"}),i.jsx("button",{className:"text-white font-opensans font-semibold h-12 mt-3 mb-14 bg-customOrange rounded-full w-32",onClick:()=>o("/browse-markets"),children:"Shop Now"})]}),Xe&&i.jsx(Se,{product:Xe})]}):Ns.map((e=>{const s=e.isStockpile,t=e.firstOrderStatus,a=s&&"Declined"===t,r=s&&"Pending"===t;return i.jsx("div",{className:"px-3 py-2",children:i.jsxs("div",{className:"shadow-lg px-3 py-4 rounded-lg "+(e._isDraft?"bg-gray-50 border border-dashed border-gray-300 ":"bg-white"),children:[i.jsxs("div",{className:"flex justify-between  items-start mb-2",children:[i.jsxs("div",{className:"flex flex-col",children:[i.jsx("div",{className:"flex items-center space-x-2",children:e.isStockpile?i.jsx(i.Fragment,{children:"Shipped"===e.firstOrderStatus?i.jsxs(i.Fragment,{children:[i.jsx(ve,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Shipped"})]}):"Declined"===e.firstOrderStatus?i.jsxs(i.Fragment,{children:[i.jsx(u,{className:"text-white bg-gray-200 h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Cancelled"})]}):e._isDraft?i.jsxs(i.Fragment,{children:[i.jsx(se,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Awaiting Payment"})]}):"In Progress"===e.firstOrderStatus?i.jsxs(i.Fragment,{children:[i.jsx(c,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"In Progress"})]}):"Pending"===e.firstOrderStatus?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Pending Approval"})]}):"Delivered"===e.firstOrderStatus?i.jsxs(i.Fragment,{children:[i.jsx(ae,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Delivered"})]}):i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:e.firstOrderStatus||"Status Unknown"})}):i.jsx(i.Fragment,{children:"Shipped"===e.progressStatus?i.jsxs(i.Fragment,{children:[i.jsx(ve,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Shipped"})]}):"Declined"===e.progressStatus?i.jsxs(i.Fragment,{children:[i.jsx(u,{className:"text-white bg-gray-200 h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Cancelled"})]}):"In Progress"===e.progressStatus?i.jsxs(i.Fragment,{children:[i.jsx(c,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"In Progress"})]}):e._isDraft?i.jsxs(i.Fragment,{children:[i.jsx(se,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Awaiting Payment"})]}):"Pending"===e.progressStatus?i.jsxs(i.Fragment,{children:[i.jsx(te,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Pending Approval"})]}):"Delivered"===e.progressStatus?i.jsxs(i.Fragment,{children:[i.jsx(ae,{className:"text-white bg-customOrange h-7 w-7 rounded-full p-1 text-lg"}),i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:"Delivered"})]}):i.jsx("span",{className:"text-sm text-black font-semibold font-opensans",children:e.progressStatus||"Status Unknown"})})}),i.jsx("div",{className:"ml-9 -translate-y-1",children:e._isDraft?e.expiresAt&&i.jsxs("p",{className:"text-xs text-gray-700 font-opensans",children:["This order will expire in"," ",i.jsx("span",{className:"text-xs text-red-500 font-semibold font-opensans",children:i.jsx(Re,{expiresAtMs:e.expiresAt.toDate().getTime()})})]}):i.jsx("span",{className:"text-xs text-gray-700 font-opensans",children:y(1e3*e.createdAt.seconds).format("HH:mm, DD/MM/YYYY")})})]}),e.isStockpile&&(()=>{if(a)return i.jsx(je,{className:"text-red-600 text-2xl cursor-pointer",title:"Stockpile Declined",onClick:()=>{Y.error(`This Stockpile was declined by ${e.vendorName}. You cannot re-pile.`)}});if(r)return i.jsx(we,{className:"text-gray-400 text-2xl cursor-pointer",title:"Stockpile Pending",onClick:()=>{Y(`Stockpile from ${e.vendorName} is still pending approval.`)}});{const s=!1===e.isActive||e._isDraft;return i.jsx(Ne,{className:"text-2xl "+(s?"text-gray-400 cursor-not-allowed opacity-50":"text-customOrange cursor-pointer"),title:s?"Stockpile is inactive, cannot repile":"Add more items to pile",onClick:()=>{s||js(e)}})}})(),e.isPickup&&e.pickupCode&&"Delivered"!==e.progressStatus&&i.jsxs("div",{className:"flex flex-col items-end ml-auto",children:[i.jsx("div",{className:"flex space-x-1 mb-1",children:e.pickupCode.split("").map(((e,s)=>i.jsx("span",{className:"inline-block bg-gray-200 rounded-sm px-1.5 py-0.5 text-base font-opensans font-semibold tracking-wider",children:e},s)))}),(()=>{const s=e.isStockpile?"In Progress"===e.firstOrderStatus:"In Progress"===e.progressStatus;return i.jsxs("button",{disabled:!s,onClick:()=>s?We?e.pickupLat&&e.pickupLng?(Be(We),ze({lat:e.pickupLat,lng:e.pickupLng}),void He(!0)):Y.error("Vendor did not set a pick-up point."):Y.error("We couldnâ€™t find your saved location."):Y.error("You can only view the pickup route once the vendor has accepted your order."),className:`\n            text-[11px] mt-1 flex font-opensans underline\n            ${s?"text-blue-800 hover:text-blue-600":"text-gray-400 cursor-not-allowed"}\n          `,children:["ViewÂ map",i.jsx(re,{className:"text-lg -translate-x-1"})]})})()]})]}),i.jsx("div",{className:"border-t border-gray-300 my-2"}),i.jsx(Pe,{orderStatus:e.firstOrderStatus||e.progressStatus,isStockpile:e.isStockpile,isPickup:e.isPickup}),i.jsx("div",{className:"border-t border-gray-300 my-2"}),e.cartItems?e.cartItems.map(((s,t)=>{const a=s._orderId?d.find((e=>e.id===s._orderId)):null,r="Declined"===(null==a?void 0:a.progressStatus);return i.jsxs("div",{className:"flex flex-col items-start py-2 border-b",children:[i.jsxs("div",{className:"flex items-center justify-between w-full "+(r?"opacity-50":""),children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx("img",{src:s.imageUrl||"https://via.placeholder.com/150",alt:s.name,className:"w-16 h-16 object-cover rounded-lg mr-4",onError:e=>{e.target.src="https://via.placeholder.com/150"}}),i.jsxs("div",{children:[i.jsx("h4",{className:"text-sm font-opensans",children:s.name}),i.jsxs("p",{className:"font-opensans text-md mt-2 text-black font-bold",children:["â‚¦",s.price?s.price.toLocaleString():"0"]})]})]}),r&&i.jsx(le,{className:"text-red-600 text-xl",title:"Order Declined"})]}),t===e.cartItems.length-1&&i.jsx("div",{className:"flex justify-start ml-[77px] mt-2",children:i.jsx("button",{onClick:()=>(e=>{_(e),Ce(0),pe(!0)})(e),className:"bg-customCream bg-opacity-60 text-xs text-customRichBrown font-opensans font-medium border-2 border-customOrange px-2.5 py-1.5 rounded-full ",children:"Tap to view"})})]},t)})):i.jsx("p",{className:"text-xs text-red-500",children:"No products found in this order."}),i.jsx("div",{className:"mt-2",children:e._isDraft?i.jsx("div",{className:"mt-2 flex justify-end",children:i.jsx("button",{onClick:()=>{const s=`${window.location.origin}/pay/${e.id}`;navigator.clipboard.writeText(s),Y.success("Link copied!")},className:"px-2 py-1.5  bg-customOrange text-white rounded-md text-xs font-opensans",children:"Copy Payment Link"})}):i.jsx("div",{className:"mt-2",children:i.jsxs("div",{className:"flex justify-end",children:[i.jsx("span",{className:"text-sm font-opensans font-normal",children:"Order Total:"}),i.jsxs("span",{className:"text-sm font-opensans font-semibold ml-1",children:["â‚¦"," ",e.isStockpile&&e.combinedTotal?Number(e.combinedTotal).toLocaleString():e.total?Number(e.total).toLocaleString():"0"]})]})})})]})},e.id)}))}),T&&E&&(()=>{var e,s,t,a,r,n,o;const c=E.isStockpile,u=E.firstOrderStatus,h=c&&"Declined"===u,g=c&&"Pending"===u;return i.jsxs("div",{className:"fixed inset-0 z-50 bg-black bg-opacity-70 flex items-center justify-center",children:[i.jsxs("div",{className:"bg-white h-full rounded-lg shadow-lg w-full max-w-2xl flex flex-col",children:[i.jsxs("div",{className:"flex-1 overflow-y-auto p-6",children:[i.jsxs("div",{className:"flex items-center justify-between mb-4",children:[i.jsxs("div",{className:"flex items-center",children:[i.jsx(ee,{onClick:vs,className:"text-2xl cursor-pointer"}),i.jsxs("h2",{className:"text-lg font-semibold font-opensans text-center",children:["Order"," ",i.jsx("span",{className:"text-sm font-medium",children:E.isStockpile?E._isDraft?`(${E.id.slice(0,5)}â€¦)`:`(${E.stockpileDocId})`:E._isDraft?`(${E.id.slice(0,5)}â€¦)`:`(${E.id})`})]})]}),i.jsx("div",{className:" ",children:i.jsx(ie,{className:"text-2xl cursor-pointer",onClick:bs,title:"Support"})})]}),i.jsx(ye,{spaceBetween:10,slidesPerView:1,onSlideChange:e=>Ce(e.activeIndex),children:E.cartItems.map(((e,s)=>{var t,a,r;return i.jsx(ke,{children:i.jsxs("div",{className:"relative w-full h-64 rounded-lg overflow-hidden cursor-pointer "+(e._orderId&&"Declined"===(null==(t=d.find((s=>s.id===e._orderId)))?void 0:t.progressStatus)?"opacity-50":""),children:[i.jsx("img",{src:e.imageUrl||"https://via.placeholder.com/150",alt:e.name,onClick:()=>Oe(e.imageUrl),className:"w-full h-full object-cover"}),e._orderId&&"Declined"===(null==(a=d.find((s=>s.id===e._orderId)))?void 0:a.progressStatus)?i.jsxs("div",{className:"absolute bottom-3 right-3 bg-red-600 text-white text-[11px] px-3 py-1 rounded-full font-opensans shadow-lg",children:["Order was declined by"," ",(null==(r=d.find((s=>s.id===e._orderId)))?void 0:r.vendorName)||"Vendor"]}):i.jsx("div",{className:"absolute bottom-3 right-3 bg-black bg-opacity-70 text-white text-[11px] px-3 py-1 rounded-full font-opensans shadow-lg",children:"Tap to View"})]})},s)}))}),E.cartItems.length>1&&i.jsx("div",{className:"flex justify-center mt-2",children:E.cartItems.map(((e,s)=>i.jsx("div",{className:"cursor-pointer mx-0.5 rounded-full transition-all duration-300 "+(s===fe?"bg-customOrange h-2.5 w-2.5":"bg-orange-300 h-2 w-2"),onClick:()=>Ce(s)},s)))}),i.jsxs("div",{className:"mt-4",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(ne,{className:"text-customRichBrown"})}),i.jsx("p",{className:"text-base font-opensans ml-2 text-black font-semibold mt-2",children:"Product Details"})]}),i.jsx("div",{className:"border-b mb-2"}),[{label:"Item Name:",value:E.cartItems[fe].name},{label:"Price:",value:`â‚¦${(null==(e=E.cartItems[fe].price)?void 0:e.toLocaleString())||"0"}`},{label:"Size:",value:E.cartItems[fe].size||"N/A"},{label:"Color:",value:E.cartItems[fe].color||"N/A"},{label:"Quantity:",value:E.cartItems[fe].quantity||1}].map((({label:e,value:s},t)=>i.jsxs(oe.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-center my-2",children:[i.jsx("p",{className:"text-sm font-opensans text-black font-semibold text-left w-1/2",children:e}),i.jsx("p",{className:"text-sm font-opensans text-black text-center w-1/2",children:s})]}),t<4&&i.jsx("div",{className:"border-b my-2"})]},t)))]}),i.jsxs("div",{className:"mt-4",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(ce,{className:"text-customRichBrown"})}),i.jsx("p",{className:"text-base font-opensans ml-2 text-black font-semibold mt-2",children:"Order Details"})]}),i.jsx("div",{className:"border-b mb-2"}),[{label:"Order ID:",value:E._isDraft?`${E.id.slice(0,5)}â€¦`:E.cartItems[fe]._orderId||E.id},{label:"Time Placed:",value:E.cartItems[fe]._orderCreatedAt?y(1e3*E.cartItems[fe]._orderCreatedAt.seconds).format("HH:mm, DD/MM/YYYY"):E.createdAt?y(1e3*E.createdAt.seconds).format("HH:mm, DD/MM/YYYY"):"N/A"},{label:"Vendor Name:",value:E.vendorName},...E.isPickup?[{label:"Pickup Address:",value:E.pickupAddress||"N/A"},{label:"Pickup Code:",value:E.pickupCode||"â€” â€” â€” â€”"}]:[],..."Shipped"===E.progressStatus?[{label:"Rider Name:",value:E.isStockpile?(null==(s=E.firstOrderRiderInfo)?void 0:s.riderName)||"N/A":(null==(t=E.riderInfo)?void 0:t.riderName)||"N/A"},{label:"Rider Number:",value:E.isStockpile?(null==(a=E.firstOrderRiderInfo)?void 0:a.riderNumber)||"N/A":(null==(r=E.riderInfo)?void 0:r.riderNumber)||"N/A"},{label:"Note:",value:E.isStockpile?(null==(n=E.firstOrderRiderInfo)?void 0:n.note)||"N/A":(null==(o=E.riderInfo)?void 0:o.note)||"N/A"}]:[],..."Declined"===E.progressStatus&&E.declineReason?[{label:"Decline Reason:",value:E.declineReason}]:[]].map((({label:e,value:s},t)=>i.jsxs(oe.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-center my-2",children:[i.jsx("p",{className:"text-sm font-opensans text-black font-semibold text-left w-1/2",children:e}),i.jsx("p",{className:"text-sm font-opensans text-black text-center w-1/2",children:s})]}),t<5&&i.jsx("div",{className:"border-t my-2"})]},t)))]}),E.isStockpile&&i.jsxs("div",{className:"mt-6",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(m,{className:"text-customRichBrown"})}),i.jsx("p",{className:"text-base font-opensans ml-2 text-black font-semibold mt-2",children:"Stockpile Info"})]}),i.jsx("div",{className:"border-b mb-2"}),((null==(v=E.orderIds)?void 0:v[fe])||E.id,[{label:"Stockpile ID:",value:E.stockpileDocId||"N/A"},{label:"Chosen Duration:",value:E.chosenWeeks?`${E.chosenWeeks} weeks`:"N/A"},{label:"Expiry Date:",value:E.endDate?y(E.endDate.toDate()).format("DD/MM/YYYY"):"N/A"},{label:"Active:",value:"boolean"==typeof E.isActive?E.isActive?"Yes":"No":"N/A"}].map((({label:e,value:s},t)=>i.jsxs(oe.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-center my-2",children:[i.jsx("p",{className:"text-sm font-opensans text-black font-semibold w-1/2",children:e}),i.jsx("p",{className:"text-sm font-opensans text-black w-1/2 text-right",children:s})]}),t<4&&i.jsx("div",{className:"border-b my-2"})]},t))))]}),i.jsxs("div",{className:"mt-6 ",children:[i.jsxs("div",{className:"flex items-center mb-2",children:[i.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(ce,{className:"text-customRichBrown"})}),i.jsx("p",{className:"text-base font-opensans ml-2 text-black font-semibold mt-2",children:"Order Summary"})]}),i.jsx("div",{className:"border-b mb-2"}),(E._isDraft?[{label:"Order Total:",value:`â‚¦${Number(E.amount||0).toLocaleString()}`}]:(()=>{const e=[{label:"Subtotal:",value:`â‚¦${E.isStockpile?Number(E.combinedSubtotal||0).toLocaleString():Number(E.subtotal||0).toLocaleString()}`}];return E.isStockpile||null==E.deliveryFee||e.push({label:"Delivery Fee:",value:`â‚¦${Number(E.deliveryFee).toLocaleString()}`}),e.push({label:E.isStockpile?"Buyers Protection Fee:":"Service Fee:",value:`â‚¦${E.isStockpile?Number(E.firstOrderServiceFee||0).toLocaleString():Number(E.serviceFee||0).toLocaleString()}`}),e.push({label:"Order Total:",value:`â‚¦${E.isStockpile?Number(E.combinedTotal||0).toLocaleString():Number(E.total||0).toLocaleString()}`}),e})()).map((({label:e,value:s},t,a)=>i.jsxs(oe.Fragment,{children:[i.jsxs("div",{className:"flex justify-between items-center my-2",children:[i.jsx("p",{className:"text-sm font-opensans text-black font-semibold w-1/2",children:e}),i.jsx("p",{className:"text-sm font-opensans text-black w-1/2 text-right",children:s})]}),t<a.length-1&&i.jsx("div",{className:"border-b my-2"})]},t)))]})]}),c&&i.jsxs("div",{className:"w-full border-t p-6 flex justify-between gap-3 bg-white sticky bottom-0 z-10",children:[i.jsx("button",{disabled:g||h||is||(null==E?void 0:E.requestedForShipping)||!1===(null==E?void 0:E.isActive)||E._isDraft,onClick:()=>{g?Y("Order is still pending..."):h?Y.error("Cannot request shipping. Stockpile was declined."):($e(E),Ye(!0))},className:"font-opensans px-2 text-xs rounded-md w-full border "+(h||g||E._isDraft||is||(null==E?void 0:E.requestedForShipping)||!1===(null==E?void 0:E.isActive)?"border-gray-300 text-gray-400 bg-gray-100 cursor-not-allowed":"border-customRichBrown text-customRichBrown bg-transparent text-xs font-medium"),children:is?"Requesting...":(null==E?void 0:E.requestedForShipping)?"Shipping Requested":"Request for Shipping"}),i.jsx("button",{disabled:g||E._isDraft||h||!1===(null==E?void 0:E.isActive),onClick:()=>{g?Y("Stockpile is still pending approval..."):h?Y.error("You cannot repile. Stockpile was declined."):!1===(null==E?void 0:E.isActive)?Y.error("Stockpile is inactive. Cannot add more items."):js(E)},className:"text-sm font-opensans px-4 py-2 rounded-md w-full "+(h||g||E._isDraft||!1===(null==E?void 0:E.isActive)?"bg-gray-300 text-white cursor-not-allowed":"bg-customOrange text-xs font-medium text-white"),children:"Repile"})]})]}),_e&&i.jsx(Le,{isOpen:_e,onClose:()=>Ye(!1),onConfirm:()=>{(async e=>{if(null==e?void 0:e.stockpileDocId){ns(!0);try{const s=x(l,"stockpiles",e.stockpileDocId);await b(s,{requestedForShipping:!0,isActive:!1});const t=await f(s);let a={};t.exists()&&(a=t.data()),gs(W()),Y.success("Shipping request sent successfully!"),_((e=>({...e,requestedForShipping:!0,isActive:a.isActive}))),p((s=>s.map((s=>s.stockpileDocId===e.stockpileDocId?{...s,requestedForShipping:!0,isActive:a.isActive}:s))));const r=ge(be,"notifyVendorShippingRequest");await r({vendorId:e.vendorId,stockpileDocId:e.stockpileDocId,userName:(null==hs?void 0:hs.displayName)||"A Customer"}),gs(W())}catch(s){Y.error("Failed to request shipping. Please try again.")}finally{ns(!1)}}})(Te),Ye(!1)}}),Ae&&i.jsxs("div",{className:"fixed px-12 py-12 inset-0 z-50 bg-black bg-opacity-90 flex items-center justify-center",onClick:ks,children:[i.jsx("img",{src:Ae,alt:"Full View",className:"w-full h-full object-contain"}),i.jsx(de,{onClick:ks,className:"absolute top-5 right-5 text-white text-3xl"})]})]});var v})(),i.jsx(ws,{isOpen:Ve,onClose:()=>He(!1),origin:qe,destination:Ue})]})};export{_e as default};
