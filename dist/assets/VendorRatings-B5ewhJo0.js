import{j as e,u as s,h as t,k as a,r,az as l,S as i,Q as n,a9 as o,aM as c,X as d,cS as x,R as m,a2 as f,a7 as u,d as h,a as g,y as p,_ as j,c as v,q as w,w as y,g as b,A as N,e as k,ac as S,ad as L,l as C}from"./index-CvIXhaMv.js";import{m as R}from"./cartMerge-BMaHK3Vz.js";import{R as A}from"./react-stars-DecT5tWK.js";import{g as D}from"./index-DV9LhBdq.js";import{P}from"./ProgressBar-BRYQFJFA.js";import"./index-BVVzb-MI.js";import"./index-BaqZIR9i.js";const E=({filled:s})=>e.jsx("svg",{width:"38",height:"38",viewBox:"0 0 24 24",fill:s?"#ffd700":"#e0e0e0",xmlns:"http://www.w3.org/2000/svg",style:{marginRight:"8px",borderRadius:"4px"},children:e.jsx("path",{d:"M12 17.3L18.2 21L16.5 14L22 9.3L14.8 8.6L12 2L9.2 8.6L2 9.3L7.5 14L5.8 21L12 17.3Z",stroke:"none",fillRule:"evenodd"})}),U=()=>{const{id:U}=s(),z=t();a();const[F,I]=r.useState([]),[M,$]=r.useState(null),[T,O]=r.useState(!0),[V,q]=r.useState(null),[B,G]=r.useState(!1),[Q,_]=r.useState(""),[W,Y]=r.useState(!1),[K,X]=r.useState(!1),[Z,H]=r.useState("All"),[J,ee]=r.useState(0),[se,te]=r.useState(!1),[ae,re]=r.useState(!0),[le,ie]=r.useState(!1),[ne,oe]=r.useState({5:0,4:0,3:0,2:0,1:0}),[ce,de]=r.useState(!1);r.useEffect((()=>{l(C,(e=>{e?(async e=>{try{const s=(await p(h(g,"users",e))).data();q(s),s.displayName&&s.birthday?de(!0):de(!1)}catch(s){}})(e.uid):(q(null),de(!1))}))}),[]),r.useEffect((()=>{(async()=>{try{const e=h(g,"vendors",U),s=await p(e);if(s.exists()){const e=s.data();$(e)}else j.error("Vendor not found!")}catch(e){j.error("Error fetching vendor data: "+e.message)}finally{re(!1)}})()}),[U]),r.useEffect((()=>{(async()=>{if(V&&U)try{const e=v(g,"orders"),s=w(e,y("userId","==",V.uid),y("vendorId","==",U),y("progressStatus","==","Delivered")),t=await b(s);te(!t.empty)}catch(e){te(!1)}else te(!1)})()}),[V,U]);const xe=async()=>{try{const e=v(g,"vendors",U,"reviews"),s=(await b(e)).docs.map((e=>({id:e.id,...e.data()})));let t=s;"All"!==Z&&(t=s.filter((e=>e.rating===Z)));const a=t.filter((e=>e.reviewText));I(a);const r={5:s.filter((e=>5===e.rating)).length,4:s.filter((e=>4===e.rating)).length,3:s.filter((e=>3===e.rating)).length,2:s.filter((e=>2===e.rating)).length,1:s.filter((e=>1===e.rating)).length};oe(r)}catch(e){}finally{re(!1)}};r.useEffect((()=>{U&&xe()}),[U]),r.useEffect((()=>{U&&xe()}),[U,Z]);const me=["damn","hell","fool","werey","ode","idiot","shit","crap","bastard","bitch","asshole","dick","piss","prick","cunt","fuck","motherfucker","fucker","cock","pussy","twat","whore","slut","nigger","chink","spic","wanker","bollocks","bugger","tosser","shithead","douchebag","jackass","retard"];r.useEffect((()=>(document.body.style.overflow=B||K?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[B,K]);const fe=(null==M?void 0:M.ratingCount)>0?M.rating/M.ratingCount:0,ue=Object.values(ne).reduce(((e,s)=>e+s),0),he=e=>e/ue*100;return e.jsxs(e.Fragment,{children:[e.jsx(i,{title:`Reviews for ${(null==M?void 0:M.shopName)||"Vendor"} - My Thrift`,url:`https://www.shopmythrift.store/reviews/${U}`}),e.jsxs("div",{className:"px-2 py-4",children:[e.jsxs("div",{className:"sticky py-3 top-0 bg-white ",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3 pb-2",children:[e.jsx(n,{className:"text-3xl cursor-pointer",onClick:()=>z(-1)}),e.jsx("h1",{className:"text-xl font-opensans font-semibold flex-grow text-center",children:"Reviews"}),!V||se?e.jsx(o,{className:"text-3xl cursor-pointer",onClick:()=>{V?G(!0):Y(!0)}}):e.jsx("div",{className:"w-8 h-8"})]}),e.jsx("div",{className:"flex justify-between mb-3 w-full overflow-x-auto space-x-2 scrollbar-hide",children:["All",5,4,3,2,1].map((s=>e.jsx("button",{onClick:()=>H(s),className:"flex-shrink-0 h-12 px-3 py-2 text-xs font-bold font-opensans text-black border border-gray-200 rounded-full "+(Z===s?"bg-customOrange text-white":"bg-transparent"),children:"All"===s?s:`${s} stars`},s)))}),e.jsx("div",{className:"border-b border-gray-300 w-screen translate-y-3 relative left-1/2 transform -translate-x-1/2"})]}),e.jsxs("div",{className:"flex space-x-6",children:[e.jsx("div",{className:"flex items-center justify-start my-4",children:e.jsx("div",{className:" rounded-full flex flex-col ",children:ae?e.jsx(c,{square:!0,height:80,width:80}):e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"text-5xl font-opensans font-semibold",children:fe.toFixed(1)}),e.jsx("div",{className:"flex text-xs mt-2",children:Array.from({length:5}).map(((s,t)=>e.jsx(d,{className:t<Math.floor(fe)?"text-yellow-500":"text-gray-300"},t)))}),e.jsx("span",{className:"text-xs mt-1 font-poppins  text-gray-600",children:M.ratingCount})]})})}),e.jsx("div",{className:"my-4  w-full",children:ue>0?[5,4,3,2,1].map((s=>e.jsxs("div",{className:"flex items-center mb-2",children:[e.jsx("span",{className:"w-6 text-xs font-opensans font-light",children:s}),e.jsx(P,{now:he(ne[s]||0),className:"flex-1 mx-2",style:{height:"14px",backgroundColor:"#f5f3f2",borderRadius:"10px",overflow:"hidden"},children:e.jsx("div",{style:{backgroundColor:"#f9531e",height:"100%",width:`${he(ne[s]||0)}%`,borderRadius:"10px"}})})]},s))):e.jsx("p",{className:"text-xs font-opensans text-gray-600",children:"No ratings available yet."})})]}),e.jsxs("div",{className:"p-2 pb-24",children:[F.map((s=>e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center mb-1",children:[s.userPhotoURL?e.jsx("img",{src:s.userPhotoURL,alt:s.userName,className:"w-11 h-11 rounded-full mr-3"}):e.jsx("div",{className:"w-11 h-11 rounded-full bg-gray-200 flex items-center justify-center mr-3",children:e.jsx(D,{className:"text-gray-500 text-xl"})}),e.jsx("div",{children:e.jsx("h2",{className:"font-semibold text-xs",children:s.userName})})]}),e.jsxs("div",{className:"flex space-x-3",children:[e.jsx("div",{className:"flex space-x-1",children:Array.from({length:s.rating},((s,t)=>e.jsx(d,{className:"text-yellow-500"},t)))}),e.jsx("span",{className:"ratings-text font-medium font-opensans text-gray-500",children:new Date(1e3*s.createdAt.seconds).toLocaleDateString()})]}),e.jsx("p",{className:"mt-2 text-black font-opensans text-sm",children:s.reviewText})]},s.id))),e.jsx("div",{className:"fixed bottom-0 left-0 w-full bg-white py-4",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("div",{className:"flex justify-center items-center mb-2",children:[e.jsx(d,{className:"text-yellow-500 text-lg mr-2"}),e.jsx("h2",{className:"text-xs font-opensans font-semibold",children:"Reviews from Verified Buyers"})]}),e.jsx("p",{className:"text-xs font-opensans text-gray-700",children:"All reviews on this page are submitted by verified buyers."})]})})]}),B&&M&&e.jsxs("div",{className:"fixed inset-0 bg-white z-50",children:[e.jsxs("div",{className:"flex items-center px-2 py-4 mb-2",children:[e.jsx(n,{className:"text-3xl cursor-pointer",onClick:()=>G(!1)}),e.jsxs("h1",{className:"text-lg ml-4 font-opensans font-semibold",children:["Rate ",M.shopName]}),e.jsx("div",{})]}),e.jsx("div",{className:"border-b border-gray-300 w-full mb-2"}),e.jsxs("div",{className:"p-3",children:[e.jsx("div",{className:"flex justify-center mb-2 ",children:e.jsx("div",{className:"relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:M.coverImageUrl?e.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:M.coverImageUrl,alt:M.shopName}):e.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:"https://images.saatchiart.com/saatchi/1750204/art/9767271/8830343-WUMLQQKS-7.jpg",alt:""})})}),e.jsx("div",{className:"flex justify-center"}),e.jsx("div",{className:"flex justify-center mt-2",children:e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"text-yellow-400",size:16}),e.jsxs("span",{className:"flex text-xs font-opensans items-center ml-2",children:[fe.toFixed(1),e.jsx(x,{className:"mx-1 text-gray-300 font-opensans dot-size"}),M.ratingCount||0," ratings"]})]})}),e.jsx("div",{className:"w-fit text-center bg-customGreen p-2 flex items-center justify-center rounded-full mt-3 mx-auto",children:e.jsx("div",{className:"mt-2 flex flex-wrap items-center -translate-y-1 justify-center text-textGreen text-xs space-x-1",children:ae?e.jsx(c,{width:80,height:24,count:4,inline:!0}):M.categories.map(((s,t)=>e.jsxs(m.Fragment,{children:[t>0&&e.jsx(x,{className:"mx-1 dot-size text-dotGreen"}),e.jsx("span",{children:s})]},t)))})}),e.jsx("h1",{className:"font-opensans text-sm mt-4 font-semibold",children:"Rate this shop"}),e.jsx("div",{className:"mt-2 mb-3 flex justify-center",children:e.jsx(A,{count:5,onChange:e=>ee(e),size:24,activeColor:"#ffd700",emptyIcon:e.jsx(E,{filled:!1}),filledIcon:e.jsx(E,{filled:!0})})}),e.jsx("textarea",{value:Q,onFocus:()=>{document.querySelector("textarea").scrollIntoView({behavior:"smooth"})},onChange:e=>{const s=e.target.value;_(s),(e=>{const s=e.toLowerCase();return me.some((e=>s.includes(e)))})(s)?O(!1):O(!0)},placeholder:"Describe your experience with this shop (Optional)",className:"w-full p-2 border h-20 text-xs text-gray-900 rounded mb-4 "+(T?"border-gray-300":"border-red-500"),style:{resize:"none"}}),e.jsx("div",{className:"fixed inset-x-0 bottom-0 p-4 bg-white",children:e.jsx("button",{onClick:async()=>{if(T)if(ce)try{if(ie(!0),!U||!V)return j.error("You must be logged in to submit a review."),void ie(!1);if(!J)return j.error("Please select a rating."),void ie(!1);try{await N(V.uid,"review",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:8,hourLimit:40})}catch(e){return ie(!1),void j.error(e.message)}const s=v(g,"vendors",U,"reviews");await k(s,{reviewText:""!==Q.trim()?Q:null,rating:J,userName:V.username||V.displayName,userPhotoURL:V.photoURL||null,createdAt:new Date});const t=h(g,"vendors",U);await S(t,{ratingCount:L(1),rating:L(J)}),G(!1),_(""),ee(0),xe(),j.success("Review added successfully!")}catch(s){j.error("Error adding review, please try again.")}finally{ie(!1)}else j.error("Please complete your profile before submitting a review.");else j.error("Your review contains inappropriate language.")},className:(T?"bg-customOrange":"bg-gray-400")+" text-white font-opensans font-medium h-12 px-6 rounded-full w-full flex items-center justify-center",disabled:le||!T,children:le?e.jsx(f,{strokeColor:"#ffffff",strokeWidth:"5",animationDuration:"0.75",width:"24",visible:!0}):"Post"})})]})]}),e.jsx(u,{open:W,onClose:()=>Y(!1),onComplete:e=>{Y(!1),G(!0)},mergeCart:R,headerText:"Letâ€™s set up your review",openDisclaimer:e=>s=>{s.preventDefault(),s.stopPropagation();const t=`${window.location.origin}${e}`;setDisclaimerUrl(t),setShowDisclaimerModal(!0)}})]})]})};export{U as default};
