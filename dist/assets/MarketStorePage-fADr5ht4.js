import{b as e,r as s,a as t,u as a,d as r,j as n,L as o,R as l,bD as i,A as c,G as d,au as x,ar as m,ad as u,F as f,aY as h,e as p,O as j,h as g,_ as w,H as b,Q as N,aZ as y,D as v,E as k,I as C}from"./index-B6_tP4YQ.js";import{P as S}from"./productnotfound-BYH9w9yZ.js";import{g as F,h as I}from"./index-_8P_0wxn.js";import{P as L}from"./ProductCard-CTMPZt-i.js";import{c as E,d as $}from"./index-YqizTpTw.js";import{i as _,n as A}from"./index-BZTi0IwX.js";import{b as D}from"./index-Czi2OGzl.js";import{L as O}from"./index-CGC7HsBi.js";import{S as P}from"./SEO-CG8nsGhn.js";import"./index-BzTvhx-M.js";import"./userWriteHandler-DCDkCU98.js";const U=()=>{const[e,t]=s.useState(!1);s.useEffect((()=>{if(!localStorage.getItem("reviewBannerShown")){t(!0),localStorage.setItem("reviewBannerShown","true");const e=setTimeout((()=>{t(!1)}),1e4);return()=>clearTimeout(e)}}),[]);return n.jsxs("div",{className:"absolute z-10 w-64 bg-customBrown text-white px-2 py-2 rounded-lg shadow-lg flex flex-col items-start space-y-1 transform -translate-x-1/2 translate-y-40 left-1/2 transition-opacity duration-500 "+(e?"opacity-100":"opacity-0 pointer-events-none"),style:{maxWidth:"99%"},children:[n.jsx("span",{className:"font-semibold font-opensans text-sm",children:"Click here to rate vendor!"}),n.jsx("span",{className:"text-xs font-opensans",children:"Shopped from here? Share your experience with other shoppers!ðŸ§¡"}),n.jsx("button",{onClick:()=>{t(!1)},className:"absolute top-1 right-4",children:n.jsx(A,{className:"text-white text-lg"})}),n.jsx("div",{className:"absolute bottom-[-7px] left-1/2 transform -translate-x-1/2 w-4 h-4 bg-customBrown rotate-45"})," "]})},B=()=>{const{id:A}=e(),[B,T]=s.useState(null),[z,G]=s.useState([]),[R,H]=s.useState({}),[Q,V]=s.useState(!0),[Y,M]=s.useState(!1),{currentUser:W}=t(),[q,K]=s.useState(null),[X,Z]=s.useState(!1),[J,ee]=s.useState("All"),[se,te]=s.useState(""),[ae,re]=s.useState(!1),[ne,oe]=s.useState(!1),[le,ie]=s.useState(!1),ce=a(),de=r(),xe=new URLSearchParams(de.search).has("shared");s.useEffect((()=>{V(!0),T(null),G([]);(async()=>{try{V(!0);const e=p(j,"vendors",A),s=await g(e);if(s.exists()){const e=s.data();e.id=s.id,T(e),e.productIds&&e.productIds.length>0?await me(e.productIds):G([])}else w.error("Vendor not found!")}catch(e){w.error("Error fetching vendor data: "+e.message)}finally{V(!1)}})()}),[A]),s.useEffect((()=>{M(!1);(async()=>{if(W&&B)try{const e=b(j,"follows"),s=p(e,`${W.uid}_${B.id}`);(await g(s)).exists()?M(!0):M(!1)}catch(e){}})()}),[W,B]);const me=async e=>{try{const s=b(j,"products");if(!e||0===e.length)return void G([]);const t=[];for(let r=0;r<e.length;r+=10)t.push(e.slice(r,r+10));const a=[];for(const e of t){const t=v(s,k("__name__","in",e),k("published","==",!0)),r=(await C(t)).docs.map((e=>({id:e.id,...e.data()})));a.push(...r)}G(a)}catch(s){w.error("Error fetching products.")}},ue=z.filter((e=>e.name.toLowerCase().includes(se.toLowerCase())&&("All"===J||e.productType===J))).sort(((e,s)=>"priceAsc"===q?parseFloat(e.price)-parseFloat(s.price):"priceDesc"===q?parseFloat(s.price)-parseFloat(e.price):0));s.useEffect((()=>(document.body.style.overflow=X?"hidden":"unset",()=>{document.body.style.overflow="unset"})),[X]);const fe=e=>{H((s=>{if(s[e]){const{[e]:t,...a}=s;return a}return{...s,[e]:!0}}))};if(Q)return n.jsx("div",{children:n.jsx(o,{})});if(!B)return n.jsxs("div",{className:"flex flex-col justify-center items-center h-3/6",children:[n.jsx(l,{className:"w-full h-full",animationData:S,loop:!0,autoplay:!0}),n.jsx("h1",{className:"text-xl text-center font-bold text-red-500",children:"Vendor is not found. You entered a wrong link or the vendor is not available."}),n.jsxs("button",{className:"w-full mt-4 h-12 rounded-full border font-medium flex items-center font-opensans justify-center transition-colors duration-200 bg-customOrange text-white",onClick:()=>{ce(W?"/browse-markets":"/confirm-user-state")},children:[" ","Go Back"]})]});const he=()=>{te("")},pe=B.ratingCount>0?B.rating/B.ratingCount:0,je=["All",...new Set(z.map((e=>e.productType)))];return n.jsxs(n.Fragment,{children:[n.jsx(P,{title:`${B.shopName} - My Thrift`,description:`Shop from ${B.shopName} on My Thrift`,image:B.coverImageUrl,url:`https://www.shopmythrift.store/marketstorepage/${A}`}),n.jsxs("div",{className:"p-3 mb-24",children:[n.jsx(U,{}),n.jsx("div",{className:"sticky top-0 bg-white h-20 z-20 flex items-center border-b border-gray-300 w-full",children:ae?n.jsxs("div",{className:"flex items-center w-full relative px-2",children:[n.jsx(i,{onClick:()=>{re(!1),he()},className:"cursor-pointer text-2xl mr-2"}),n.jsx("input",{type:"text",value:se,onChange:e=>{te(e.target.value)},placeholder:"Search store...",className:"flex-1 border rounded-full font-opensans text-black text-sm border-gray-300 px-3 py-2 font-medium focus:outline-none"}),se&&n.jsx(_,{className:"text-xl text-gray-500 cursor-pointer absolute right-4",onClick:he})]}):xe?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"flex items-center",children:n.jsx(c,{onClick:()=>ce("/newhome"),className:"text-2xl cursor-pointer"})}),n.jsx("div",{className:"flex-1 flex justify-center items-center",children:n.jsx("img",{src:"/logo512.png",alt:"Logo",className:"object-contain max-h-[72px]"})}),n.jsx("div",{className:"flex items-center mr-2 relative",children:n.jsx(E,{className:"text-black text-3xl cursor-pointer",onClick:()=>re(!0)})})]}):n.jsxs("div",{className:"flex items-center justify-between w-full ",children:[n.jsx(d,{onClick:()=>ce(-1),className:"cursor-pointer text-3xl"}),n.jsx("h1",{className:"flex-grow text-center font-opensans text-lg font-semibold",children:B.shopName||"Not Found"}),n.jsx(E,{className:"text-black text-3xl cursor-pointer",onClick:()=>re(!0)})]})}),n.jsx("div",{className:"flex justify-center mt-6",children:n.jsx("div",{className:"relative w-32 h-32 rounded-full bg-gray-200 flex items-center justify-center",children:Q?n.jsx(x,{circle:!0,height:128,width:128}):B.coverImageUrl?n.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:B.coverImageUrl,alt:B.shopName}):n.jsx("img",{className:"w-32 h-32 rounded-full bg-slate-700 object-cover",src:"https://images.saatchiart.com/saatchi/1750204/art/9767271/8830343-WUMLQQKS-7.jpg",alt:"Default Image"})})}),n.jsx("div",{className:"flex justify-center mt-2",style:{cursor:"pointer"},onClick:()=>{ce(`/reviews/${A}`)},children:Q?n.jsx(x,{width:100,height:24}):n.jsxs(n.Fragment,{children:[n.jsx(F,{className:"text-yellow-400",size:16}),n.jsxs("span",{className:"flex text-xs font-opensans items-center ml-2",children:[pe.toFixed(1),n.jsx(m,{className:"mx-1 text-gray-300 font-opensans dot-size"}),B.ratingCount||0," ratings"]})]})}),n.jsx("div",{className:"w-fit text-center bg-customGreen p-2 flex items-center justify-center rounded-full mt-3 mx-auto",children:n.jsx("div",{className:"mt-2 flex flex-wrap items-center -translate-y-1 justify-center text-textGreen text-xs space-x-1",children:Q?n.jsx(x,{width:80,height:24,count:4,inline:!0}):B.categories.map(((e,s)=>n.jsxs(u.Fragment,{children:[s>0&&n.jsx(m,{className:"mx-1 dot-size text-dotGreen"}),n.jsx("span",{children:e})]},s)))})}),n.jsx("div",{className:"flex items-center justify-center mt-3",children:Q?n.jsx(x,{width:128,height:40}):n.jsx("button",{className:"w-full h-12 rounded-full border font-medium flex items-center font-opensans justify-center transition-colors duration-200 bg-customOrange text-white",onClick:async()=>{if(W)try{if(oe(!0),!(null==B?void 0:B.id))throw new Error("Vendor ID is undefined");const e=b(j,"follows"),s=p(e,`${W.uid}_${B.id}`);Y?(await y(s),w.success("Unfollowed")):(await N(s,{userId:W.uid,vendorId:B.id,createdAt:new Date}),w.success("You will be notified of new products and promos.")),M(!Y)}catch(e){w.error(`Error following/unfollowing: ${e.message}`)}finally{oe(!1)}else Z(!0)},disabled:ne,children:ne?n.jsx(I,{className:"animate-spin mr-2"}):Y?n.jsxs(n.Fragment,{children:[n.jsx(f,{className:"mr-2"}),"Following"]}):n.jsxs(n.Fragment,{children:[n.jsx(h,{className:"mr-2"}),"Follow"]})})}),n.jsx("p",{className:" text-gray-700 mt-3 text-sm font-opensans text-center",children:Q?n.jsx(x,{count:2}):B.description}),n.jsxs("div",{className:"p-2 mt-7",children:[n.jsxs("div",{className:"flex items-center mb-3 justify-between",children:[n.jsx("h1",{className:"font-opensans text-lg  font-semibold",children:"Products"}),n.jsxs("div",{className:"relative",children:[le&&n.jsxs("div",{className:"z-50 absolute bg-white w-44 h-20 rounded-2.5xl shadow-[0_0_10px_rgba(0,0,0,0.1)] -left-24 top-2 p-3 flex flex-col justify-between",children:[n.jsx("span",{className:"text-xs font-opensans ml-2 cursor-pointer "+("priceAsc"===q?"text-customOrange":"text-black"),onClick:()=>{K("priceAsc"),ie(!le)},children:"Low to High"}),n.jsx("hr",{className:"text-slate-300"}),n.jsx("span",{className:"text-xs ml-2 font-opensans cursor-pointer "+("priceDesc"===q?"text-customOrange":"text-black"),onClick:()=>{K("priceDesc"),ie(!le)},children:"High to Low"})]}),n.jsxs("span",{className:"flex text-xs font-opensans items-center",children:["Sort by Price:"," ",n.jsx(D,{className:"text-customOrange cursor-pointer ml-1",onClick:()=>ie(!le)})]})]})]}),n.jsx("div",{className:"flex  mb-4 w-full overflow-x-auto space-x-2 scrollbar-hide",children:je.map((e=>n.jsx("button",{onClick:()=>(e=>{ee(e)})(e),className:"flex-shrink-0 h-12 px-4 py-2 text-xs font-semibold font-opensans text-black border border-gray-400 rounded-full "+(J===e?"bg-customOrange text-white":"bg-transparent"),children:e},e)))}),Q?n.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:Array.from({length:6}).map(((e,s)=>n.jsx(x,{height:200,width:"100%"},s)))}):ue.length>0?n.jsx("div",{className:"grid mt-2 grid-cols-2 gap-2",children:ue.map((e=>n.jsx(L,{product:e,isFavorite:!!R[e.id],onFavoriteToggle:fe,onClick:()=>{ce(`/product/${e.id}`)},showVendorName:!1},e.id)))}):n.jsx("div",{className:"flex justify-center items-center  w-full text-center",children:n.jsxs("p",{className:"font-opensans text-xs text-gray-800",children:["ðŸ“­ ",n.jsx("span",{className:"",children:B.shopName})," hasn't added any products to their online store yet. Check back soon for new items!"]})})]}),X&&n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:e=>{e.target===e.currentTarget&&Z(!1)},children:n.jsxs("div",{className:"bg-white w-9/12 max-w-md rounded-lg px-3 py-4 flex flex-col",onClick:e=>e.stopPropagation(),children:[n.jsxs("div",{className:"flex justify-between items-center mb-4",children:[n.jsxs("div",{className:"flex space-x-4",children:[n.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:n.jsx($,{className:"text-customRichBrown"})}),n.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Please Log In"})]}),n.jsx(O,{onClick:()=>Z(!1),className:"text-black text-xl mb-6 cursor-pointer"})]}),n.jsx("p",{className:"mb-6 text-xs font-opensans text-gray-800 ",children:"You need to be logged in to follow this vendor to recieve notifications. Please log in to your account, or create a new account if you donâ€™t have one, to continue."}),n.jsxs("div",{className:"flex space-x-16",children:[n.jsx("button",{onClick:()=>{ce("/signup"),Z(!1)},className:"flex-1 bg-transparent py-2 text-customRichBrown font-medium text-xs font-opensans border-customRichBrown border rounded-full",children:"Sign Up"}),n.jsx("button",{onClick:()=>{ce("/login"),Z(!1)},className:"flex-1 bg-customOrange py-2 text-white text-xs font-opensans rounded-full",children:"Login"})]})]})})]})]})};export{B as default};
