import{r as e,h as s,j as t,S as a,aJ as r,ah as o,I as i,a2 as n,af as l,_ as d,an as c,l as u,aK as m,g as h,q as f,w,c as p,a as x}from"./index-CvIXhaMv.js";import{C as g,R as y,F as v,a as j}from"./reactstrap.modern-BbKta6iB.js";import"./index-6PUMxdSt.js";import"./index-BVVzb-MI.js";import"./index-BaqZIR9i.js";import"./Transition-DlEawdUv.js";import"./inheritsLoose-BMl3PfwL.js";const b=async e=>{const s={url:"https://shopmythrift.store/reset-password",handleCodeInApp:!0};try{await m(u,e,s),d.success("Password reset email sent successfully!")}catch(t){d.error("Failed to send password reset email. Please try again.")}},N=()=>{const[m,N]=e.useState(""),[T,P]=e.useState(!1),S=s();return t.jsxs(t.Fragment,{children:[t.jsx(a,{title:"Password Reset - My Thrift",description:"Reset your password",url:"https://www.shopmythrift.store/forgetpassword"}),t.jsx("section",{children:t.jsx(g,{children:t.jsx(y,{children:t.jsxs("div",{className:"px-3 ",children:[t.jsx(r,{className:"text-2xl cursor-pointer mb-2",onClick:()=>S(-1)}),t.jsx("h1",{className:"font-ubuntu text-3xl mt-9 font-semibold mb-1",children:"Reset your password"}),t.jsx("h2",{className:"font-ubuntu font-thin text-sm text-gray-400",children:"Enter your email address and we will send you a link"}),t.jsxs(v,{className:"translate-y-5",onSubmit:async e=>{if(e.preventDefault(),!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(m))return void d.error("Invalid email format. Please enter a valid email.");P(!0);const s=m.trim().toLowerCase();try{let e=[];try{e=await c(u,s)}catch(t){if("auth/user-not-found"!==(null==t?void 0:t.code))throw t;e=[]}if(e.includes("password"))return await b(s),void S("/confirm-state");if(e.length>0){if(e.includes("google.com")&&!e.includes("password"))return void d.error("This account uses Google sign-in and has no password. Please continue with Google, or add a password from Account Settings.");if(e.includes("twitter.com")&&!e.includes("password"))return void d.error("This account uses Twitter (X) sign-in and has no password. Please continue with Twitter, or add a password from Account Settings.");const s=e.filter((e=>"password"!==e)).map((e=>e.replace(".com",""))).join(", ");return void d.error(`This account uses social sign-in (${s}). Use your original method or add a password from Account Settings.`)}const{inVendors:a,inUsers:r}=await(async e=>{const s=[{col:"vendors",field:"emailLower"},{col:"vendors",field:"email"},{col:"users",field:"emailLower"},{col:"users",field:"email"}];let t=!1,a=!1;for(const{col:r,field:o}of s)(await h(f(p(x,r),w(o,"==",e)))).empty||("vendors"===r&&(t=!0),"users"===r&&(a=!0));return{inVendors:t,inUsers:a}})(s);if(r)try{return await b(s),void S("/confirm-state")}catch(t){return void d.error("We found your account, but it doesn’t have a password. Please sign in with your original method (e.g., Google or Twitter), or add a password from Account Settings.")}if(a)try{return await b(s),void S("/confirm-state")}catch{return void d.error("This vendor account doesn’t have a password to reset. Please use your original sign-in method or add a password from Account Settings.")}d.error("We couldn’t match this email to an account. If you signed up with Google or Twitter, please use that method instead.")}catch(a){"auth/invalid-email"===(null==a?void 0:a.code)?d.error("That email address looks invalid. Please check and try again."):"auth/too-many-requests"===(null==a?void 0:a.code)?d.error("Too many attempts. Please wait a bit and try again."):d.error("Something went wrong. Please try again later.")}finally{P(!1)}},children:[t.jsxs(j,{className:"relative w-full",children:[t.jsx("div",{className:"absolute inset-y-0 left-0 flex items-center pl-5 pointer-events-none",children:t.jsx(o,{className:"text-2xl text-black"})}),t.jsx("input",{type:"email",placeholder:"Enter your email",value:m,className:"w-full h-12 bg-gray-100 pl-14 text-black font-opensans rounded-md text-base focus:outline-none focus:ring-2 focus:ring-customOrange",onChange:e=>N(e.target.value.toLowerCase())})]}),t.jsxs("div",{className:"flex  text-center flex-col -translate-y-3",children:[t.jsx(i.button,{whileTap:{scale:1.2},type:"submit",className:"bg-customOrange w-full mb-2 h-12 font-poppins font-medium rounded-full text-white mt-4 relative",disabled:T,children:T?t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(n,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"24",visible:!0})}):"Reset"}),t.jsx("p",{className:"text-customOrange text-sm",children:t.jsx(l,{to:"/login",children:"Back to Sign In"})})]})]})]})})})})]})};export{N as default};
