import{d as e,u as s,r as t,b as a,a as o,c as n,bH as r,s as l,j as i,G as c,o as d,F as m,aY as x,e as u,O as h,Q as f,_ as p,aZ as g,C as j,D as w,H as b,E as v,I as N}from"./index-B6_tP4YQ.js";import{P as y}from"./ProductCard-CTMPZt-i.js";import{h as k}from"./userWriteHandler-DCDkCU98.js";import{$ as C}from"./module-rdBSHQ9l.js";import{S as E}from"./SEO-CG8nsGhn.js";import{i as L}from"./index-BZTi0IwX.js";import{T as S}from"./react-BL-HRo_U.js";import{A as I,C as P,a as M,b as F}from"./index-CKWQBTEh.js";import{c as $,d as _}from"./index-YqizTpTw.js";import{L as z}from"./index-CGC7HsBi.js";import{u as T}from"./useDispatch-DS0xcVHe.js";import"./index-BzTvhx-M.js";import"./emotion-unitless.esm-sScrWPmR.js";const W=new P({cloud:{cloudName:"dtaqusjav"}}),q={Mens:["person-happy-american-african-business_osy8q7","handsome-surprised-man-with-beard-choosing-shirt-shop_1_nlw6ok"],Womens:["darkskinned-woman-denim-outfit-looking-camera-pink-background-portrait-curly-girl-green-tee-smiling-isolated-backdrop_yof3qe","charming-woman-boho-suit-lilac-glasses-jumps-happily-portrait-curly-brunette-girl-beige-jacket-dancing-purple-backdrop_mgtlgi"],Kids:["medium-shot-smiley-kids-outdoors_lpgzdw","black-girl-wearing-casual-t-shirt_l3rpel"]},D=()=>{const P=e(),D=s(),H=T(),[O,U]=t.useState(!1),{category:Y}=a(),K=Y||"Mens",{currentUser:Q}=o(),R=n((e=>e.catsection.data[K]))||{vendors:[],products:[],lastVisibleProduct:null,noMoreProducts:!1,loading:!1,error:null},{vendors:V,products:A,lastVisibleProduct:B,noMoreProducts:G,loading:X,error:Z}=R,[J,ee]=t.useState(""),[se,te]=t.useState(A),[ae,oe]=t.useState(V),[ne,re]=t.useState(!1),[le,ie]=t.useState(!1),[ce,de]=t.useState(!1),[me,xe]=t.useState(0),{text:ue,cldImage:he}=(e=>{var s;const t=null==(s=q[e])?void 0:s[me];if(!t)return{text:"",cldImage:null};const a=W.image(t).format("auto").quality("auto").resize(M().gravity(F()).width(1200).height(600));let o="";switch(e){case"Mens":o="Discover the Latest Men's Fashion";break;case"Womens":o="Explore the Latest Women's Fashion";break;case"Kids":o="Adorable Kids Collection";break;default:o="Explore Our Collection"}return{text:o,cldImage:a}})(K);t.useEffect((()=>{A.length||H(r({category:K,loadMore:!1}))}),[K,A.length,H]),t.useEffect((()=>{const e=()=>{de(window.scrollY>100)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]);const fe=t.useCallback((()=>{X||G||H(r({category:K,loadMore:!0}))}),[H,K,X,G]),[pe,ge]=t.useState({});t.useEffect((()=>{l(j,(e=>{e?(async e=>{try{const s=w(b(h,"follows"),v("userId","==",e)),t=await N(s),a={};t.forEach((e=>{a[e.data().vendorId]=!0})),ge(a)}catch(s){p.error("Error fetching followed vendors.")}})(e.uid):ge({})}))}),[]);t.useEffect((()=>{const e=()=>{window.innerHeight+document.documentElement.scrollTop>=document.documentElement.offsetHeight-200&&fe()};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[fe]),t.useEffect((()=>{if(J){const e=J.toLowerCase(),s=A.filter((s=>s.name.toLowerCase().includes(e)));te(s),re(0===s.length)}else te(A),re(!1)}),[J,A]),t.useEffect((()=>{if(J){const e=J.toLowerCase(),s=V.filter((s=>s.shopName.toLowerCase().includes(e)));oe(s)}else oe(V)}),[J,V]);const[je,we]=t.useState(!0),[be,ve]=t.useState(0);t.useEffect((()=>{const e=()=>{const e=window.scrollY;we(e<100),ve(e)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)}),[]),t.useEffect((()=>{const e=setInterval((()=>{xe((e=>{var s;return e===((null==(s=q[K])?void 0:s.length)||1)-1?0:e+1}))}),5e3);return()=>clearInterval(e)}),[K]);return i.jsxs(i.Fragment,{children:[i.jsx(E,{title:`Shop ${K} | My Thrift`,description:`Explore ${K} products on My Thrift`,url:`https://www.shopmythrift.store/category/${K}`}),i.jsxs("div",{className:"mb-14",children:[i.jsx("div",{className:"absolute top-0 z-10 w-full mt-2 flex justify-between p-2",children:le?i.jsxs("div",{className:"flex items-center w-full relative",children:[i.jsx(c,{className:"text-3xl text-white cursor-pointer mr-2",onClick:()=>{ee(""),ie(!1),re(!1),oe(V),te(A)}}),i.jsxs("div",{className:"relative w-full",children:[i.jsx("input",{type:"text",className:"w-full px-3 font-opensans text-black text-sm py-2 rounded-full focus:outline-none pr-8",placeholder:"Search categories...",value:J,onChange:e=>{const s=e.target.value.toLowerCase();ee(s);const t=V.filter((e=>e.shopName.toLowerCase().includes(s))),a=A.filter((e=>e.name.toLowerCase().includes(s)));oe(t),te(a),re(0===t.length&&0===a.length)}}),J&&i.jsx(L,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 text-xl text-gray-400 cursor-pointer",onClick:()=>ee("")})]})]}):i.jsxs(i.Fragment,{children:[i.jsx("button",{onClick:()=>D(-1),children:i.jsx(c,{className:"text-4xl text-white"})}),i.jsx($,{className:"text-3xl text-white",onClick:()=>ie(!0)})]})}),ce&&!le&&i.jsxs("div",{className:"sticky top-0 z-20 w-full flex items-center py-2 px-2 h-20 opacity-95 bg-white shadow-md",children:[i.jsx("button",{onClick:()=>D(-1),className:"p-1 rounded-full",children:i.jsx(c,{className:"text-3xl"})}),i.jsx("div",{className:"flex-grow text-xl font-opensans font-semibold",children:K})]}),i.jsxs("div",{className:"relative h-64 rounded-b-lg w-full",children:[he&&i.jsx(I,{cldImg:he,className:"absolute inset-0 w-full h-full object-cover"}),i.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-50 flex justify-center items-center",children:i.jsx("h1",{className:"text-white text-3xl text-center px-8 font-poppins",children:i.jsx(S,{options:{strings:[ue],autoStart:!0,loop:!0,delay:75}})})})]}),i.jsxs("div",{className:"p-3",children:[ae.length>0&&i.jsxs(i.Fragment,{children:[i.jsx("h2",{className:"text-lg font-opensans font-semibold mb-2 mt-4",children:"Top Vendors"}),i.jsx("div",{className:"flex space-x-8 overflow-x-scroll",children:ae.map((e=>{var s;return i.jsxs("div",{className:"w-full min-w-[250px] max-w-[250px] cursor-pointer",onClick:()=>D(`/store/${e.id}`),children:[i.jsx("img",{src:e.coverImageUrl||"https://images.saatchiart.com/saatchi/1750204/art/9767271/8830343-WUMLQQKS-7.jpg",alt:e.shopName||"Vendor Image",className:"w-full h-36 object-cover rounded-md"}),i.jsxs("div",{className:"flex justify-between items-center",children:[i.jsxs("div",{children:[i.jsx("h3",{className:"mt-2 text-lg font-opensans font-medium",children:(null==(s=e.shopName)?void 0:s.length)>12?`${e.shopName.slice(0,12)}...`:e.shopName}),i.jsxs("div",{className:"flex items-center font-opensans text-xs",children:[i.jsx(d,{className:"text-yellow-500 mr-1"}),i.jsx("span",{children:e.ratingCount>0?(e.rating/e.ratingCount).toFixed(1):0}),i.jsxs("span",{className:"ml-1",children:["(",e.ratingCount||0,")"]})]})]}),i.jsx("button",{className:`flex justify-center items-center w-24 h-9 text-sm ${pe[e.id]?"bg-customOrange text-white border-transparent":"bg-transparent text-black border border-black"} mt-3 px-4 py-2 rounded-md`,onClick:s=>{s.stopPropagation(),(async e=>{if(!Q)return void U(!0);const s=!pe[e];ge((t=>({...t,[e]:s})));try{await k(Q.uid,"follow",{},{collectionName:"usage_metadata",writeLimit:50,minuteLimit:8,hourLimit:40});const t=u(h,"follows",`${Q.uid}_${e}`);s?(await f(t,{userId:Q.uid,vendorId:e,createdAt:new Date}),p.success("You will be notified of new products and promos.")):(await g(t),p.success("Unfollowed."))}catch(t){ge((t=>({...t,[e]:!s}))),p.error(`Error: ${t.message}`)}})(e.id)},children:pe[e.id]?i.jsxs("div",{className:"flex",children:[i.jsx("h2",{className:"text-xs font-opensans",children:"Followed"}),i.jsx(m,{className:"ml-2 mt-0.5 text-xs"})]}):i.jsxs("div",{className:"flex",children:[i.jsx("h2",{className:"text-xs font-opensans font-medium",children:"Follow"}),i.jsx(x,{className:"ml-2 text-xs mt-0.5"})]})})]})]},e.id)}))})]}),se.length>0?i.jsxs(i.Fragment,{children:[i.jsx("h2",{className:"text-lg font-opensans font-semibold mb-2 mt-4",children:"Explore Products"}),i.jsx("div",{className:"grid grid-cols-2 gap-4",children:se.map((e=>i.jsx(y,{product:e},e.id)))})]}):!X&&!ne&&i.jsxs("div",{className:"flex flex-col items-center justify-center mt-4",children:[i.jsx("h2",{className:"text-center text-lg font-opensans font-semibold",children:"Nothing in this category yet"}),i.jsx("p",{className:"font-opensans text-gray-800 text-sm",children:"Please check back later for updates."})]}),X&&i.jsx("div",{className:"flex justify-center my-4",children:i.jsx(C,{strokeColor:"#f9531e",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0})}),Z&&i.jsx("p",{className:"text-red-600 font-semibold mt-4 text-center",children:Z})]}),O&&i.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center",onClick:e=>{e.target===e.currentTarget&&U(!1)},children:i.jsxs("div",{className:"bg-white w-9/12 max-w-md rounded-lg px-3 py-4 flex flex-col",onClick:e=>e.stopPropagation(),children:[i.jsxs("div",{className:"flex justify-between items-center mb-4",children:[i.jsxs("div",{className:"flex space-x-4",children:[i.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:i.jsx(_,{className:"text-customRichBrown"})}),i.jsx("h2",{className:"text-lg font-opensans font-semibold",children:"Please Log In"})]}),i.jsx(z,{onClick:()=>U(!1),className:"text-black text-xl mb-6 cursor-pointer"})]}),i.jsx("p",{className:"mb-6 text-xs font-opensans text-gray-800 ",children:"You need to be logged in to follow this vendor to recieve notifications. Please log in to your account, or create a new account if you donâ€™t have one, to continue."}),i.jsxs("div",{className:"flex space-x-16",children:[i.jsx("button",{onClick:()=>{D("/signup",{state:{from:P.pathname}}),U(!1)},className:"flex-1 bg-transparent py-2 text-customRichBrown font-medium text-xs font-opensans border-customRichBrown border rounded-full",children:"Sign Up"}),i.jsx("button",{onClick:()=>{D("/login",{state:{from:P.pathname}}),U(!1)},className:"flex-1 bg-customOrange py-2 text-white text-xs font-opensans rounded-full",children:"Login"})]})]})})]})]})};export{D as default};
