import{r as e,j as t,d as s,a as r,y as n,aF as a,e as o,c as l,aV as i,M as c,aW as d,b as u,a2 as p,aX as m,_ as x,aq as f,ar as h,aG as b,aY as v,aZ as y,h as g,B as j,Q as N,a_ as k,a$ as w,a4 as S,b0 as I,b1 as D,b2 as P,aM as C,b3 as O,b4 as A,b5 as R,b6 as $,b7 as M,b8 as T,b9 as E,ba as _,bb as F,bc as B,bd as U,be as Y,bf as W,q as L,w as q,g as V,ac as z,s as H,ay as K,i as J,S as G,bg as Z}from"./index-CvIXhaMv.js";import{a as Q}from"./index-DfGOTzdC.js";import{I as X}from"./index-B92ogqTU.js";import{H as ee}from"./index-R3h_Od-2.js";import{I as te,a as se,b as re}from"./index-DV9LhBdq.js";const ne=({orders:o,openModal:l})=>{const[i,c]=e.useState({}),[d,u]=e.useState({});e.useEffect((()=>{(async()=>{var e;const t={};for(const a of o){t[a.id]||(t[a.id]=[]);for(const o of a.cartItems){const l=s(r,"products",o.productId),i=await n(l);if(i.exists()){const s=i.data();let r=[],n=[];if(o.subProductId){const t=null==(e=s.subProducts)?void 0:e.find((e=>e.subProductId===o.subProductId));(null==t?void 0:t.images)&&(r=r.concat(t.images))}if(o.variantAttributes){const e=o.variantAttributes,t=(s.variants||[]).find((t=>t.color===e.color&&t.size===e.size));(null==t?void 0:t.images)&&(n=n.concat(t.images))}r=r.concat(n.filter((e=>!r.includes(e)))),0===r.length&&s.imageUrls&&(r=r.concat(s.imageUrls));const l=r.filter((e=>!t[a.id].includes(e)));t[a.id]=t[a.id].concat(l)}}}c(t)})()}),[o]),e.useEffect((()=>{const e=setInterval((()=>{u((e=>{const t={...e};return o.forEach((s=>{var r;const n=(null==(r=i[s.id])?void 0:r.length)||0;n>0&&(t[s.id]=((e[s.id]||0)+1)%n)})),t}))}),4e3);return()=>clearInterval(e)}),[o,i]);const{today:p,yesterday:m,thisWeek:x,older:f}=(e=>{const t=[],s=[],r=[],n=[];return e.forEach((e=>{const o=a(1e3*e.createdAt.seconds),l=a();o.isSame(l,"day")?t.push(e):o.isSame(l.clone().subtract(1,"day"),"day")?s.push(e):o.isSame(l,"week")?r.push(e):n.push(e)})),{today:t,yesterday:s,thisWeek:r,older:n}})(o),h=(e,s)=>0===s.length?null:t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-right flex text-sm text-black font-opensans mt-3 mb-3",children:e}),t.jsx("ul",{className:"space-y-4",children:s.map((e=>{const s=e.isStockpile,r=s&&!!e.stockpileDuration;s&&e.stockpileDuration;let n="Pending Order ðŸ•œ";s&&(n=r?"New Stockpile ðŸ§¡ ":"Incoming Pile ðŸ§º");const o=e.cartItems.reduce(((e,t)=>e+t.quantity),0);let c;return c=s?r?`${e.userInfo.displayName} wants to create a stockpile for ${e.stockpileDuration} weeks. They added ${o} item(s).`:`${e.userInfo.displayName} wants to add more items to their existing pile. They added ${o} item(s).`:`You have an order from ${e.userInfo.displayName} (Order ID: ${e.id}) for ${o} items. Please review and process the order.`,t.jsxs("li",{className:"p-2.5 bg-gray-100 rounded-lg flex cursor-pointer",onClick:()=>l(e),children:[i[e.id]&&i[e.id].length>0?t.jsx("img",{src:i[e.id][d[e.id]||0],alt:"Product",className:"w-12 h-12 p-0.5 border-dashed border-customBrown border-[1px] border-opacity-80 object-cover rounded mr-3 flex-shrink-0"}):t.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded mr-3 flex-shrink-0"}),t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-semibold text-black font-opensans text-xs",children:n}),t.jsx("span",{className:"text-xs font-semibold text-black font-opensans",children:a(1e3*e.createdAt.seconds).format("hh:mm A")})]}),t.jsx("p",{className:"text-xs text-left text-gray-700 font-opensans mt-2 whitespace-pre-line",children:c})]})]},e.id)}))})]},e);return t.jsxs("div",{children:[h("Today",p),h("Yesterday",m),h("This Week",x),h("Older",f)]})},ae=async(e,t,a,i,c,d,u=null,p=null)=>{try{if(!e)throw new Error("User ID is undefined or null. Cannot send notification.");if(!t)throw new Error("Order ID is undefined or null. Cannot send notification.");const m=s(r,"orders",t);if(!(await n(m)).exists())throw new Error("Order document does not exist.");if(!["Pending","In Progress","Shipped","Declined","Delivered"].includes(a))throw new Error("Invalid order status. Cannot send notification.");"Declined"!==a&&(u=null),"Shipped"!==a&&(p=null);const x={userId:e,vendorName:i||"Unknown Vendor",vendorCoverImage:c||"",productImage:d||"",message:`Your order with ${i||"Unknown Vendor"} has been updated to: ${a}`,orderId:t,declineReason:u,riderInfo:p,createdAt:new Date,seen:!1,type:"order"};await o(l(r,"notifications"),x),await Q.post("https://us-central1-ecommerce-ba520.cloudfunctions.net/sendNotification",{userId:e,orderId:t,newStatus:a,vendorName:i,vendorCoverImage:c,productImage:d,declineReason:u,riderInfo:p})}catch(m){}},oe=async(e,t,s,n="order")=>{try{const a=l(r,"vendors",e,"activityNotes");await o(a,{title:t,note:s,type:n,timestamp:new Date})}catch(a){}},le=({orders:o,openModal:l,moveToShipped:b})=>{const[v,y]=e.useState({}),[g,j]=e.useState({}),[N,k]=e.useState(null),[w,S]=e.useState(!1),[I,D]=e.useState(""),[P,C]=e.useState(!1),[O,A]=e.useState(""),[R,$]=e.useState(""),[M,T]=e.useState(!1),[E,_]=e.useState(null),[F,B]=e.useState(!1),[U,Y]=e.useState(""),[W,L]=e.useState(""),[q,V]=e.useState("");e.useEffect((()=>(document.body.style.overflow=w?"hidden":"",()=>{document.body.style.overflow=""})),[w]),e.useEffect((()=>{(async()=>{var e;const t={};for(const a of o){t[a.id]||(t[a.id]=[]);for(const o of a.cartItems){const l=s(r,"products",o.productId),i=await n(l);if(i.exists()){const s=i.data();let r=[],n=[],l=null,c=null;if(o.subProductId&&(l=null==(e=s.subProducts)?void 0:e.find((e=>e.subProductId===o.subProductId)),l&&l.images&&(r=r.concat(l.images))),o.variantAttributes){const e=o.variantAttributes,t=l?l.variants:s.variants;t&&(c=t.find((t=>!!t.attributes&&Object.keys(e).every((s=>e[s]===t.attributes[s])))),c&&c.images&&(n=n.concat(c.images)))}r=r.concat(n.filter((e=>!r.includes(e)))),0===r.length&&s.imageUrls&&(r=r.concat(s.imageUrls));const d=r.filter((e=>!t[a.id].includes(e)));t[a.id]=t[a.id].concat(d)}}}y(t)})()}),[o]),e.useEffect((()=>{const e=setInterval((()=>{j((e=>{const t={...e};return o.forEach((s=>{var r;const n=(null==(r=v[s.id])?void 0:r.length)||0;n>0&&(t[s.id]=((e[s.id]||0)+1)%n)})),t}))}),4e3);return()=>clearInterval(e)}),[o,v]);const z=()=>{S(!1),D(""),A(""),$("")},H=async()=>{var e,t,a,l,i;const c=o.find((e=>e.id===E));if(c){if(c.isPickup){if(!W||!q)return void x.error("Please select both Available Day(s) and Time Block.")}else if(!I||!O)return void x.error("Please fill in both Rider's Name and Rider's Number.");B(!0);try{if(c.isPickup){const e=f(h,"scheduleOrderPickup"),{data:t}=await e({orderId:c.id,pickupDays:W,pickupTime:q,pickupNote:U});return t.alreadyScheduled?x.success("Pickup window was already set ðŸ‘"):x.success("Pickup window saved! âœ…"),await ae(c.userId,c.id,"Pickup Scheduled",c.vendorName,null,null,null,{pickupDays:W,pickupTime:q}),await oe(c.vendorId,"Pickup Confirmed ðŸšš",`Pickup window set for ${W} during ${q} for order ${c.id}.`,"order"),void C(!1)}const o=f(h,"shipVendorOrder"),{data:d}=await o({orderId:c.id,riderName:I,riderNumber:O,note:R});if(d.alreadyShipped)return x.success("Order is already marked as shipped âœ…"),void S(!1);let u=c.vendorName,p=null;if(!u&&c.vendorId){const e=await n(s(r,"vendors",c.vendorId));e.exists()&&(u=e.data().shopName,p=e.data().coverImageUrl)}let m=null;if(null==(e=c.cartItems)?void 0:e.length){const e=c.cartItems[0],o=await n(s(r,"products",e.productId));if(o.exists()){const s=o.data();m=e.subProductId?(null==(l=null==(a=null==(t=s.subProducts)?void 0:t.find((t=>t.subProductId===e.subProductId)))?void 0:a.images)?void 0:l[0])??null:(null==(i=s.imageUrls)?void 0:i[0])??null}}await ae(c.userId,c.id,"Shipped",u,p,m,null,{riderName:I,riderNumber:O,note:R}),await oe(c.vendorId,"Order Shipped ðŸšš",`Order has been shipped. Rider's name is ${I}, and they are reachable at ${O}.`,"order"),x.success("Order marked as shipped!"),S(!1)}catch(d){x.error(c.isPickup?"Failed to set pickup window. Please try again.":"Failed to move order to shipping. Please try again.")}finally{B(!1)}}else x.error("Order not found â€“ please refresh the page.")},{today:K,yesterday:J,thisWeek:G,older:Z}=(e=>{const t=[],s=[],r=[],n=[];return e.forEach((e=>{const o=a(1e3*e.createdAt.seconds),l=a();o.isSame(l,"day")?t.push(e):o.isSame(l.clone().subtract(1,"day"),"day")?s.push(e):o.isSame(l,"week")?r.push(e):n.push(e)})),{today:t,yesterday:s,thisWeek:r,older:n}})(o),Q=(e,x)=>x.length>0&&t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-right flex text-sm text-black font-opensans mt-3 mb-3",children:e}),t.jsx("ul",{className:"space-y-4",children:x.map((e=>{var c,d,u,p;return t.jsx("li",{className:"p-2 bg-gray-100 rounded-lg flex items-start cursor-pointer",onClick:()=>l(e),children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-semibold text-black font-opensans text-xs",children:"In Progress Order"}),t.jsx("span",{className:"text-xs font-semibold text-black font-opensans",children:a(1e3*e.createdAt.seconds).format("hh:mm A")})]}),t.jsxs("div",{className:"flex items-center mt-2 justify-center",children:[v[e.id]&&v[e.id].length>0?t.jsx("img",{src:v[e.id][g[e.id]||0],alt:"Product",className:"w-12 h-12 p-0.5 border-dashed border-customBrown border border-opacity-80 object-cover rounded mr-3"}):t.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded mr-3"}),t.jsxs("p",{className:"text-xs text-left text-gray-700 font-opensans mt-2",children:["Order from ",e.userInfo.displayName," for"," ",e.cartItems.reduce(((e,t)=>e+t.quantity),0)," ","item(s)."," ",e.isPickup?t.jsx(t.Fragment,{children:"Please provide your preferred pickup window this lets your customer know exactly when to come by and collect their items."}):t.jsxs(t.Fragment,{children:["Once youâ€™ve completed packaging and shipped this order, please update the status to"," ",t.jsx("span",{className:"font-semibold",children:"â€œShippedâ€"})," to keep the customer informed."]}),(null==(p=null==(u=null==(d=null==(c=e.kwikJob)?void 0:c.data)?void 0:d.pickups)?void 0:u[0])?void 0:p.result_tracking_link)&&t.jsx("span",{className:"ml-1 font-bold",children:t.jsxs("a",{href:e.kwikJob.data.pickups[0].result_tracking_link,target:"_blank",rel:"noopener noreferrer",className:"text-xs text-black font-opensans",onClick:e=>e.stopPropagation(),children:["This order will be picked up by our rider"," ",t.jsx("span",{className:"text-xs text-customOrange underline font-opensans",children:"Track Rider"})]})})]})]}),t.jsxs("div",{className:"relative flex justify-end mt-2",children:[t.jsxs("button",{onClick:t=>{t.stopPropagation(),k(N===e.id?null:e.id)},className:"bg-transparent border-blue-300 border text-blue-300 font-medium font-opensans text-xs rounded-md px-2.5 py-2 flex items-center",children:["In progress ",t.jsx(i,{className:"ml-1"})]}),N===e.id&&t.jsxs("div",{className:"absolute z-50 bg-white w-36 rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 mt-6 right-0 p-3",onClick:e=>e.stopPropagation(),children:[t.jsx("span",{className:"text-xs text-customRichBrown block text-left font-opensans font-semibold ml-2",children:"Move to"}),t.jsx("hr",{className:"my-2 text-slate-300"}),e.isPickup?t.jsx("button",{onClick:()=>{var t;k(null),t=e.id,_(t),L(""),V(""),C(!0)},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1",children:"Set Pickup Window"}):t.jsx("button",{onClick:()=>{k(null),(async e=>{var t,a,l,i;const c=o.find((t=>t.id===e));if(c){if(_(e),c.isPickup)return L(""),V(""),void C(!0);try{const e=s(r,"vendors",c.vendorId),o=await n(e);"platform"===(null==(a=o.exists()?null==(t=o.data())?void 0:t.deliveryPreference:"")?void 0:a.toLowerCase())?(D("My Thrift  Logistics"),A("08105911662"),T(!0)):(null==(i=null==(l=c.kwikJob)?void 0:l.data)?void 0:i.contactUs)?(D("Kwik Delivery"),A(c.kwikJob.data.contactUs.phone_no),T(!0)):(D(""),A(""),T(!1))}catch(d){D(""),A(""),T(!1)}S(!0)}})(e.id)},className:"block w-full text-left text-sm text-black font-opensans px-2 py-1",children:"Shipped"})]})]})]})},e.id)}))}),t.jsxs(c,{isOpen:w,onRequestClose:z,className:"modal-content-rider h-auto",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(d,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Delivery Details"})]}),t.jsx(u,{className:"text-xl relative -top-2",onClick:z})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[t.jsx("h1",{className:"text-xs font-opensans text-black font-medium",children:"Rider's Name"}),t.jsx("input",{type:"text",placeholder:"Rider's Name",value:I,disabled:M,onChange:e=>D(e.target.value),className:"w-full p-2 border text-xs rounded h-10 focus:outline-none"}),t.jsx("h1",{className:"text-xs font-opensans  text-black font-medium",children:"Rider's Number"}),t.jsx("input",{type:"number",placeholder:"Enter Rider's Phone Number",value:O,disabled:M,onChange:e=>A(e.target.value.slice(0,11)),className:"w-full p-2 border text-xs h-10 rounded focus:outline-none"}),t.jsx("textarea",{placeholder:"Add a short note here (optional)",value:R,onChange:e=>$(e.target.value),className:"w-full p-2 border text-xs h-20  rounded focus:outline-none"})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:H,className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full flex items-center",disabled:F,children:F?t.jsx(p,{strokeColor:"white",width:"20"}):"Send"})})]}),P&&t.jsxs(c,{isOpen:!0,onRequestClose:()=>C(!1),className:"modal-content-rider h-auto",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(m,{className:"text-customRichBrown text-xl"}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Set Pickup Window"})]}),t.jsx(u,{className:"text-xl relative -top-2",onClick:()=>C(!1)})]}),t.jsx("h1",{className:"text-xs font-opensans font-medium text-black mb-1",children:"Available Day(s)"}),t.jsxs("select",{value:W,onChange:e=>L(e.target.value),className:"w-full p-2 border text-xs rounded h-10 mb-3 focus:outline-none",children:[t.jsx("option",{value:"",children:"Chooseâ€¦"}),t.jsx("option",{value:"Monâ€“Wed",children:"Mon, Tue & Wed"}),t.jsx("option",{value:"Thuâ€“Fri",children:"Thu & Fri"}),t.jsx("option",{value:"Weekends",children:"Weekends (Sat & Sun)"}),t.jsx("option",{value:"EverydayExceptSun",children:"Everyday except Sunday"})]}),t.jsx("h1",{className:"text-xs font-opensans font-medium text-black mb-1",children:"Time Block"}),t.jsxs("select",{value:q,onChange:e=>V(e.target.value),className:"w-full p-2 border text-xs rounded h-10 mb-6 focus:outline-none",children:[t.jsx("option",{value:"",children:"Chooseâ€¦"}),t.jsx("option",{value:"Morning",children:"8 am â€“ 12 noon"}),t.jsx("option",{value:"Afternoon",children:"12 pm â€“ 5 pm"}),t.jsx("option",{value:"Evening",children:"5 pm â€“ 8 pm"})]}),t.jsx("h1",{className:"text-xs font-opensans font-medium text-black mb-1",children:"Pickup Note (optional)"}),t.jsx("textarea",{placeholder:"e.g. opposite the market under the garage...",value:U,onChange:e=>Y(e.target.value),className:"w-full p-2 border text-base font-opensans rounded h-24 focus:outline-none resize-none"}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{disabled:!W||!q||F,onClick:H,className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full flex items-center",children:F?t.jsx(p,{strokeColor:"white",width:"20"}):"Send"})})]})]},e);return t.jsxs("div",{children:[Q("Today",K),Q("Yesterday",J),Q("This Week",G),Q("Older",Z)]})},ie=({orders:o,openModal:l})=>{const[i,c]=e.useState({}),[d,u]=e.useState({});e.useEffect((()=>{(async()=>{var e;const t={};for(const a of o){t[a.id]||(t[a.id]=[]);for(const o of a.cartItems){const l=s(r,"products",o.productId),i=await n(l);if(i.exists()){const s=i.data();let r=[],n=[],l=null,c=null;if(o.subProductId&&(l=null==(e=s.subProducts)?void 0:e.find((e=>e.subProductId===o.subProductId)),l&&l.images&&(r=r.concat(l.images))),o.variantAttributes){const e=o.variantAttributes,t=l?l.variants:s.variants;t&&(c=t.find((t=>!!t.attributes&&Object.keys(e).every((s=>e[s]===t.attributes[s])))),c&&c.images&&(n=n.concat(c.images)))}r=r.concat(n.filter((e=>!r.includes(e)))),0===r.length&&s.imageUrls&&(r=r.concat(s.imageUrls));const d=r.filter((e=>!t[a.id].includes(e)));t[a.id]=t[a.id].concat(d)}}}c(t)})()}),[o]),e.useEffect((()=>{const e=setInterval((()=>{u((e=>{const t={...e};return o.forEach((s=>{var r;const n=(null==(r=i[s.id])?void 0:r.length)||0;n>0&&(t[s.id]=((e[s.id]||0)+1)%n)})),t}))}),4e3);return()=>clearInterval(e)}),[o,i]);const{today:p,yesterday:m,thisWeek:x,older:f}=(e=>{const t=[],s=[],r=[],n=[];return e.forEach((e=>{const o=a(1e3*e.createdAt.seconds),l=a();o.isSame(l,"day")?t.push(e):o.isSame(l.clone().subtract(1,"day"),"day")?s.push(e):o.isSame(l,"week")?r.push(e):n.push(e)})),{today:t,yesterday:s,thisWeek:r,older:n}})(o),h=(e,s)=>s.length>0&&t.jsxs("div",{children:[t.jsx("h2",{className:"font-semibold text-right flex text-sm text-black font-opensans mt-3 mb-3",children:e}),t.jsx("ul",{className:"space-y-4",children:s.map((e=>{var s;return t.jsx("li",{className:"p-2 bg-gray-100 rounded-lg flex items-start cursor-pointer",onClick:()=>l(e),children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between items-center",children:[t.jsx("span",{className:`font-semibold text-xs font-opensans ${"Delivered"===e.progressStatus?"bg-green-700  text-white px-2 py-1 rounded-md":""} text-black`,children:"Delivered"===e.progressStatus?"Fulfilled Order":"Shipped Order"}),t.jsx("span",{className:"text-xs font-semibold text-black font-opensans",children:a(1e3*e.createdAt.seconds).format("hh:mm A")})]}),t.jsxs("div",{className:"flex items-center mt-2 justify-center",children:[i[e.id]&&i[e.id].length>0?t.jsx("img",{src:i[e.id][d[e.id]||0],alt:"Product",className:"w-12 h-12 p-0.5 border-dashed border-customBrown border border-opacity-80 object-cover rounded mr-3"}):t.jsx("div",{className:"w-12 h-12 bg-gray-200 rounded mr-3"}),t.jsxs("p",{className:"text-xs text-left text-gray-700 font-opensans mt-2",children:["Order from ",e.userInfo.displayName," (Order ID:"," ",e.id,") for"," ",e.cartItems.reduce(((e,t)=>e+t.quantity),0)," ","item(s)."," ",e.isPickup?t.jsx(t.Fragment,{children:"This is a pickup order. Please ask the customer to present their unique PIN code when they arrive"}):"Delivered"===e.progressStatus?"This order has been delivered to the customer.":t.jsxs(t.Fragment,{children:['"This order has been shipped to the customer."',"Shipped"===e.progressStatus&&(null==(s=e.kwikJob)?void 0:s.data)&&t.jsx("span",{className:"block text-xs text-customOrange font-bold mt-1",children:"You can mark the order as delivered once youâ€™ve handed the package to the rider. Thank you!"})]})]})]})]})},e.id)}))})]},e);return t.jsxs("div",{children:[h("Today",p),h("Yesterday",m),h("This Week",x),h("Older",f)]})},ce=({orders:e,openModal:s})=>{const{today:r,yesterday:n,thisWeek:o,older:l}=(e=>{const t=[],s=[],r=[],n=[];return e.forEach((e=>{const o=a(1e3*e.createdAt.seconds),l=a();o.isSame(l,"day")?t.push(e):o.isSame(l.clone().subtract(1,"day"),"day")?s.push(e):o.isSame(l,"week")?r.push(e):n.push(e)})),{today:t,yesterday:s,thisWeek:r,older:n}})(e),i=(e,r)=>r.length>0&&t.jsxs(t.Fragment,{children:[t.jsx("h2",{className:"font-semibold text-right flex text-sm text-black font-opensans mt-3 mb-3",children:e}),t.jsx("ul",{className:"space-y-4",children:r.map((e=>t.jsx("li",{className:"p-2.5 bg-gray-100 rounded-lg flex items-start cursor-pointer",onClick:()=>s(e),children:t.jsxs("div",{className:"flex-1",children:[t.jsxs("div",{className:"flex justify-between",children:[t.jsx("span",{className:"font-semibold text-black font-opensans text-xs",children:"Declined Order"}),t.jsx("span",{className:"text-xs font-semibold text-black font-opensans",children:a(1e3*e.createdAt.seconds).format("hh:mm A")})]}),t.jsxs("div",{className:"flex items-center mt-2 justify-center",children:[t.jsx("div",{className:"w-28 h-12 flex items-center justify-center bg-red-100 rounded-md mr-3",children:t.jsx(b,{className:"text-red-500 text-3xl"})}),t.jsxs("p",{className:"text-xs flex text-left text-gray-700 font-opensans mt-2",children:["Order from ",e.userInfo.displayName," (Order ID:"," ",e.id,") for"," ",e.cartItems.reduce(((e,t)=>e+t.quantity),0)," ","items was declined by you. click to see reason why."]})]})]})},e.id)))})]});return t.jsxs("div",{children:[i("Today",r),i("Yesterday",n),i("This Week",o),i("Older",l)]})},de=({orders:o,openModal:l})=>{const[i,c]=e.useState([]),[d,u]=e.useState({}),[p,m]=e.useState([]),[x,f]=e.useState({}),[h,b]=e.useState({});return e.useEffect((()=>{if(!o)return;const e=o.filter((e=>!0===e.isStockpile&&e.stockpileDocId)).reduce(((e,t)=>{const s=`${t.vendorId}-${t.stockpileDocId}`;return e[s]||(e[s]=[]),e[s].push(t),e}),{}),t=Object.keys(e).map((t=>{const s=e[t];s.sort(((e,t)=>e.createdAt.seconds-t.createdAt.seconds));const r=s[0],n=s.length-1,a=s.reduce(((e,t)=>e+parseFloat(t.total||0)),0),o=s.reduce(((e,t)=>e+parseFloat(t.subtotal||0)),0);return{...r,repileCount:n,combinedTotal:a,combinedSubtotal:o,stockpileDocId:r.stockpileDocId,chosenWeeks:r.chosenWeeks||null,endDate:r.endDate||null,startDate:r.startDate||null,cartItems:s.flatMap((e=>e.cartItems.map((t=>({...t,_orderId:e.id,_orderCreatedAt:e.createdAt})))))}}));t.sort(((e,t)=>t.createdAt.seconds-e.createdAt.seconds));(async()=>{const e=await Promise.all(t.map((async e=>{if(e.stockpileDocId)try{const t=s(r,"stockpiles",e.stockpileDocId),a=await n(t);if(a.exists()){const t=a.data();return{...e,startDate:t.startDate||e.startDate,endDate:t.endDate||e.endDate,chosenWeeks:t.chosenWeeks||e.chosenWeeks,isActive:t.isActive}}}catch(t){}return e})));c(e)})()}),[o]),e.useEffect((()=>{const e={};i.forEach((t=>{const s=t.chosenWeeks;null!=s&&(e[s]||(e[s]=[]),e[s].push(t))}));const t=Object.keys(e).map((e=>Number(e))).sort(((e,t)=>e-t));u(e),m(t)}),[i]),e.useEffect((()=>{(async()=>{var e;const t={};for(const a of i)if(a.cartItems&&a.cartItems.length>0){const o=a.cartItems[0],l=s(r,"products",o.productId),i=await n(l);if(i.exists()){const s=i.data();let r=[],n=[];if(o.subProductId){const t=null==(e=s.subProducts)?void 0:e.find((e=>e.subProductId===o.subProductId));(null==t?void 0:t.images)&&(r=r.concat(t.images))}if(o.variantAttributes){const e=o.variantAttributes,t=(s.variants||[]).find((t=>t.color===e.color&&t.size===e.size));(null==t?void 0:t.images)&&(n=n.concat(t.images))}r=r.concat(n.filter((e=>!r.includes(e)))),0===r.length&&s.imageUrls&&(r=r.concat(s.imageUrls)),t[a.id]=r}}f(t)})()}),[i]),e.useEffect((()=>{const e=setInterval((()=>{b((e=>{const t={...e};return i.forEach((s=>{var r;const n=(null==(r=x[s.id])?void 0:r.length)||0;n>0&&(t[s.id]=((e[s.id]||0)+1)%n)})),t}))}),4e3);return()=>clearInterval(e)}),[i,x]),t.jsx("div",{children:p.map((e=>t.jsxs("div",{className:"mb-6",children:[t.jsxs("h2",{className:"text-sm text-left font-semibold font-opensans text-gray-800 mt-3 mb-3",children:[e," Weeks Stockpile"]}),d[e].map((e=>{var s,r,n,o,i;const c="Delivered"===e.progressStatus,d="Shipped"===e.progressStatus,u=e.deliveredAt?a(e.deliveredAt.toDate?e.deliveredAt.toDate():e.deliveredAt).format("DD/MM/YYYY"):null,p=t.jsxs("span",{children:[t.jsx("span",{className:"font-semibold text-customOrange",children:null==(s=e.userInfo)?void 0:s.displayName})," ","is currently stockpiling."]}),m=t.jsxs("span",{children:["You have shipped"," ",t.jsx("span",{className:"font-semibold text-customOrange",children:null==(r=e.userInfo)?void 0:r.displayName})," ","'s stockpile."]}),f=t.jsxs("span",{className:"flex items-center space-x-1",children:[t.jsxs("span",{children:[t.jsx("span",{className:"font-semibold text-customOrange",children:null==(n=e.userInfo)?void 0:n.displayName})," ","'s stockpile has been ",t.jsx("strong",{children:"marked delivered by you"}),u&&t.jsxs(t.Fragment,{children:[" ","on ",t.jsx("strong",{children:u}),"."]})]}),t.jsx(v,{className:"text-green-600 relative -top-6 text-4xl"})]});return t.jsxs("div",{className:"p-2 bg-gray-100 rounded-lg flex items-center cursor-pointer mb-3",onClick:()=>l(e),children:[t.jsx("div",{className:"w-16 h-16 flex-shrink-0 mr-3",children:x[e.id]&&x[e.id].length>0?t.jsx("img",{src:x[e.id][h[e.id]||0],alt:"Product",className:"w-full h-full object-cover rounded"}):t.jsx("div",{className:"w-full h-full bg-gray-200 rounded"})}),t.jsxs("div",{className:"flex-1 text-left",children:[t.jsx("p",{className:"text-xs text-gray-900 font-opensans",children:c?f:d?m:p}),!c&&!d&&e.endDate&&t.jsxs("p",{className:"text-xs font-opensans mt-1",children:["Valid until:"," ",a((null==(o=e.endDate)?void 0:o.toDate)?e.endDate.toDate():e.endDate).format("DD/MM/YYYY")]}),d&&e.shippedAt&&t.jsxs("p",{className:"text-xs font-opensans mt-1",children:["Mark as Shipped on:"," ",a((null==(i=e.shippedAt)?void 0:i.toDate)?e.shippedAt.toDate():e.shippedAt).format("DD/MM/YYYY")]}),!c&&e.repileCount>0&&t.jsx("p",{className:"text-xs bg-customOrange px-2 py-1 rounded-xl w-20 text-center text-white font-opensans mt-1",children:`+${e.repileCount} repile${e.repileCount>1?"s":""}`})]})]},e.stockpileDocId)}))]},e)))})};var ue,pe={exports:{}};const me=y((ue||(ue=1,pe.exports=function(e){var t={};function s(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=e,s.c=t,s.d=function(e,t,r){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(s.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(r,n,function(t){return e[t]}.bind(null,n));return r},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/dist/",s(s.s=3)}([function(e,t,s){e.exports=s(5)()},function(e,t,s){function r(e){return function(){return e}}var n=function(){};n.thatReturns=r,n.thatReturnsFalse=r(!1),n.thatReturnsTrue=r(!0),n.thatReturnsNull=r(null),n.thatReturnsThis=function(){return this},n.thatReturnsArgument=function(e){return e},e.exports=n},function(e,t,s){e.exports=s(8)},function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0});var r,n=(r=s(4))&&r.__esModule?r:{default:r};t.default=n.default},function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),n=i(s(0)),a=s(2),o=i(a),l=i(s(11));function i(e){return e&&e.__esModule?e:{default:e}}var c=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.values=Array(e.length).fill("").map((function(t,s){return e.initialValue.toString()[s]||""})),s.elements=[],s.currentIndex=0,s.onPaste=s.onPaste.bind(s),s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentDidMount",value:function(){this.props.focus&&this.props.length&&this.elements[0].focus()}},{key:"clear",value:function(){this.elements.forEach((function(e){return e.clear()})),this.values=this.values.map((function(){})),this.elements[0].focus()}},{key:"focus",value:function(){this.props.length&&this.elements[0].focus()}},{key:"onItemChange",value:function(e,t,s){var r=this.props,n=r.length,a=r.onComplete,o=r.onChange,l=s;this.values[s]=e,1===e.length&&s<n-1&&(l+=1,this.elements[l].focus());var i=this.values.join("");if(t||o(i,l),i.length===n){if(t&&s<n-1)return;a(i,l)}}},{key:"onBackspace",value:function(e){e>0&&this.elements[e-1].focus()}},{key:"onPaste",value:function(e){var t=this.props.length;e.length===t&&this.elements.forEach((function(t,s){return t.update(e[s],!0)}))}},{key:"render",value:function(){var e=this;return o.default.createElement("div",{style:this.props.style,className:"pincode-input-container"},this.values.map((function(t,s){return o.default.createElement(l.default,{initialValue:t,ref:function(t){return e.elements[s]=t},key:s,disabled:e.props.disabled,onBackspace:function(){return e.onBackspace(s)},secret:e.props.secret||!1,onChange:function(t,r){return e.onItemChange(t,r,s)},type:e.props.type,inputMode:e.props.inputMode,validate:e.props.validate,inputStyle:e.props.inputStyle,inputFocusStyle:e.props.inputFocusStyle,autoSelect:e.props.autoSelect,onPaste:0===s?e.onPaste:null,regexCriteria:e.props.regexCriteria,ariaLabel:e.props.ariaLabel,placeholder:e.props.placeholder,secretDelay:e.props.secretDelay})})))}}]),t}(a.Component);c.propTypes={initialValue:n.default.oneOfType([n.default.string,n.default.number]),length:n.default.number.isRequired,type:n.default.string,onComplete:n.default.func,validate:n.default.func,secret:n.default.bool,disabled:n.default.bool,focus:n.default.bool,onChange:n.default.func,inputMode:n.default.string,style:n.default.object,inputStyle:n.default.object,inputFocusStyle:n.default.object,autoSelect:n.default.bool,regexCriteria:n.default.any,ariaLabel:n.default.string,placeholder:n.default.string},c.defaultProps={initialValue:"",type:"numeric",secret:!1,validate:null,focus:!1,disabled:!1,onChange:function(){},onComplete:function(){},inputMode:void 0,style:{},inputStyle:{},inputFocusStyle:{},autoSelect:!0,regexCriteria:/^[a-zA-Z0-9]+$/,ariaLabel:"",placeholder:""},t.default=c},function(e,t,s){var r=s(1),n=s(6),a=s(7);e.exports=function(){function e(e,t,s,r,o,l){l!==a&&n(!1,"Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types")}function t(){return e}e.isRequired=e;var s={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t};return s.checkPropTypes=r,s.PropTypes=s,s}},function(e,t,s){e.exports=function(e,t,s,r,n,a,o,l){if(!e){var i;if(void 0===t)i=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[s,r,n,a,o,l],d=0;(i=new Error(t.replace(/%s/g,(function(){return c[d++]})))).name="Invariant Violation"}throw i.framesToPop=1,i}}},function(e,t,s){e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,s){var r=s(9),n=s(10),a=s(1),o="function"==typeof Symbol&&Symbol.for,l=o?Symbol.for("react.element"):60103,i=o?Symbol.for("react.call"):60104,c=o?Symbol.for("react.return"):60105,d=o?Symbol.for("react.portal"):60106,u=o?Symbol.for("react.fragment"):60107,p="function"==typeof Symbol&&Symbol.iterator;function m(e){for(var t=arguments.length-1,s="Minified React error #"+e+"; visit http://facebook.github.io/react/docs/error-decoder.html?invariant="+e,r=0;r<t;r++)s+="&args[]="+encodeURIComponent(arguments[r+1]);throw(t=Error(s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings.")).name="Invariant Violation",t.framesToPop=1,t}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}};function f(e,t,s){this.props=e,this.context=t,this.refs=n,this.updater=s||x}function h(e,t,s){this.props=e,this.context=t,this.refs=n,this.updater=s||x}function b(){}f.prototype.isReactComponent={},f.prototype.setState=function(e,t){"object"!=typeof e&&"function"!=typeof e&&null!=e&&m("85"),this.updater.enqueueSetState(this,e,t,"setState")},f.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},b.prototype=f.prototype;var v=h.prototype=new b;function y(e,t,s){this.props=e,this.context=t,this.refs=n,this.updater=s||x}v.constructor=h,r(v,f.prototype),v.isPureReactComponent=!0;var g=y.prototype=new b;g.constructor=y,r(g,f.prototype),g.unstable_isAsyncReactComponent=!0,g.render=function(){return this.props.children};var j={current:null},N=Object.prototype.hasOwnProperty,k={key:!0,ref:!0,__self:!0,__source:!0};function w(e,t,s){var r,n={},a=null,o=null;if(null!=t)for(r in void 0!==t.ref&&(o=t.ref),void 0!==t.key&&(a=""+t.key),t)N.call(t,r)&&!k.hasOwnProperty(r)&&(n[r]=t[r]);var i=arguments.length-2;if(1===i)n.children=s;else if(1<i){for(var c=Array(i),d=0;d<i;d++)c[d]=arguments[d+2];n.children=c}if(e&&e.defaultProps)for(r in i=e.defaultProps)void 0===n[r]&&(n[r]=i[r]);return{$$typeof:l,type:e,key:a,ref:o,props:n,_owner:j.current}}function S(e){return"object"==typeof e&&null!==e&&e.$$typeof===l}var I=/\/+/g,D=[];function P(e,t,s,r){if(D.length){var n=D.pop();return n.result=e,n.keyPrefix=t,n.func=s,n.context=r,n.count=0,n}return{result:e,keyPrefix:t,func:s,context:r,count:0}}function C(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function O(e,t,s,r){var n=typeof e;"undefined"!==n&&"boolean"!==n||(e=null);var a=!1;if(null===e)a=!0;else switch(n){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case l:case i:case c:case d:a=!0}}if(a)return s(r,e,""===t?"."+A(e,0):t),1;if(a=0,t=""===t?".":t+":",Array.isArray(e))for(var o=0;o<e.length;o++){var u=t+A(n=e[o],o);a+=O(n,u,s,r)}else if("function"==typeof(u=null==e?null:"function"==typeof(u=p&&e[p]||e["@@iterator"])?u:null))for(e=u.call(e),o=0;!(n=e.next()).done;)a+=O(n=n.value,u=t+A(n,o++),s,r);else"object"===n&&m("31","[object Object]"==(s=""+e)?"object with keys {"+Object.keys(e).join(", ")+"}":s,"");return a}function A(e,t){return"object"==typeof e&&null!==e&&null!=e.key?(s=e.key,r={"=":"=0",":":"=2"},"$"+(""+s).replace(/[=:]/g,(function(e){return r[e]}))):t.toString(36);var s,r}function R(e,t){e.func.call(e.context,t,e.count++)}function $(e,t,s){var r=e.result,n=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?M(e,r,s,a.thatReturnsArgument):null!=e&&(S(e)&&(t=n+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(I,"$&/")+"/")+s,e={$$typeof:l,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}),r.push(e))}function M(e,t,s,r,n){var a="";null!=s&&(a=(""+s).replace(I,"$&/")+"/"),t=P(t,a,r,n),null==e||O(e,"",$,t),C(t)}var T={Children:{map:function(e,t,s){if(null==e)return e;var r=[];return M(e,r,null,t,s),r},forEach:function(e,t,s){if(null==e)return e;t=P(null,null,t,s),null==e||O(e,"",R,t),C(t)},count:function(e){return null==e?0:O(e,"",a.thatReturnsNull,null)},toArray:function(e){var t=[];return M(e,t,null,a.thatReturnsArgument),t},only:function(e){return S(e)||m("143"),e}},Component:f,PureComponent:h,unstable_AsyncComponent:y,Fragment:u,createElement:w,cloneElement:function(e,t,s){var n=r({},e.props),a=e.key,o=e.ref,i=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,i=j.current),void 0!==t.key&&(a=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(d in t)N.call(t,d)&&!k.hasOwnProperty(d)&&(n[d]=void 0===t[d]&&void 0!==c?c[d]:t[d])}var d=arguments.length-2;if(1===d)n.children=s;else if(1<d){c=Array(d);for(var u=0;u<d;u++)c[u]=arguments[u+2];n.children=c}return{$$typeof:l,type:e.type,key:a,ref:o,props:n,_owner:i}},createFactory:function(e){var t=w.bind(null,e);return t.type=e,t},isValidElement:S,version:"16.2.0",__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED:{ReactCurrentOwner:j,assign:r}},E=Object.freeze({default:T}),_=E&&T||E;e.exports=_.default?_.default:_},function(e,t,s){var r=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null==e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},s=0;s<10;s++)t["_"+String.fromCharCode(s)]=s;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(n){return!1}}()?Object.assign:function(e,t){for(var s,l,i=o(e),c=1;c<arguments.length;c++){for(var d in s=Object(arguments[c]))n.call(s,d)&&(i[d]=s[d]);if(r){l=r(s);for(var u=0;u<l.length;u++)a.call(s,l[u])&&(i[l[u]]=s[l[u]])}}return i}},function(e,t,s){e.exports={}},function(e,t,s){Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var s=0;s<t.length;s++){var r=t[s];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,s,r){return s&&e(t.prototype,s),r&&e(t,r),t}}(),n=l(s(0)),a=s(2),o=l(a);function l(e){return e&&e.__esModule?e:{default:e}}var i={padding:0,margin:"0 2px",textAlign:"center",border:"1px solid",background:"transparent",width:"50px",height:"50px"},c={outline:"none",boxShadow:"none"},d=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t);var s=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return s.state={value:s.validate(e.initialValue),showSecret:s.props.secret,focus:!1},s.onChange=s.onChange.bind(s),s.onKeyDown=s.onKeyDown.bind(s),s.onFocus=s.onFocus.bind(s),s.onBlur=s.onBlur.bind(s),s.onPaste=s.onPaste.bind(s),s.secretTimeout=null,s.inputTimeout=null,s}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,e),r(t,[{key:"componentWillUnmount",value:function(){clearTimeout(this.secretTimeout),clearTimeout(this.inputTimeout)}},{key:"onKeyDown",value:function(e){8!==e.keyCode||this.state.value&&this.state.value.length||this.props.onBackspace()}},{key:"clear",value:function(){this.setState({value:""})}},{key:"setSecretDelayed",value:function(e){var t=this;this.setState({showSecret:!1}),this.secretTimeout=setTimeout((function(){t.setState({showSecret:!!e})}),this.props.secretDelay)}},{key:"update",value:function(e){var t=this,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=this.validate(e);(this.state.value!==r||s)&&r.length<2&&(this.setState({value:r}),this.inputTimeout=setTimeout((function(){t.props.onChange(r,s)}),0))}},{key:"onChange",value:function(e){this.update(e.target.value)}},{key:"focus",value:function(){this.input.focus()}},{key:"onFocus",value:function(e){this.props.autoSelect&&e.target.select(),this.setState({focus:!0})}},{key:"onBlur",value:function(){this.setState({focus:!1})}},{key:"onPaste",value:function(e){if(this.props.onPaste){var t=e.clipboardData.getData("text");this.props.onPaste(t)}}},{key:"validate",value:function(e){if(this.props.secretDelay&&this.setSecretDelayed(e),this.props.validate)return this.props.validate(e);if("numeric"===this.props.type){var t=e.charCodeAt(0);return t>="0".charCodeAt(0)&&t<="9".charCodeAt(0)?e:""}return this.props.regexCriteria.test(e)?e.toUpperCase():""}},{key:"render",value:function(){var e=this,t=this.state,s=t.focus,r=t.value,n=this.props,a=n.type,l=n.inputMode,d=n.inputStyle,u=n.inputFocusStyle,p="numeric"===a?"tel":a||"text";return o.default.createElement("input",{disabled:this.props.disabled?"disabled":void 0,className:"pincode-input-text",onChange:this.onChange,onKeyDown:this.onKeyDown,placeholder:this.props.placeholder?this.props.placeholder:r,"aria-label":this.props.ariaLabel?this.props.ariaLabel:r,maxLength:"1",autoComplete:"off",type:this.state.showSecret?"password":p,inputMode:l||"text",pattern:"numeric"===this.props.type?"[0-9]*":"^[a-zA-Z0-9]+$",ref:function(t){return e.input=t},onFocus:this.onFocus,onBlur:this.onBlur,onPaste:this.onPaste,style:Object.assign({},i,d,s?Object.assign({},c,u):{}),value:r})}}]),t}(a.Component);d.propTypes={initialValue:n.default.string,onChange:n.default.func.isRequired,onBackspace:n.default.func.isRequired,onPaste:n.default.func,secret:n.default.bool,secretDelay:n.default.number,disabled:n.default.bool,type:n.default.string,inputMode:n.default.string,validate:n.default.func,inputStyle:n.default.object.isRequired,inputFocusStyle:n.default.object.isRequired,autoSelect:n.default.bool,regexCriteria:n.default.any,ariaLabel:n.default.string,placeholder:n.default.string},d.defaultProps={secret:!1,type:"numeric",inputMode:void 0,disabled:!1,validate:void 0,autoSelect:!1,onPaste:void 0,regexCriteria:/^[a-zA-Z0-9]+$/,ariaLabel:"",placeholder:""},t.default=d}])),pe.exports)),xe=({isOpen:o,onClose:i,order:m,fetchVendorRevenue:v,setTotalRevenue:y})=>{const[K,J]=e.useState({}),[G,Z]=e.useState({}),[Q,ne]=e.useState(""),[le,ie]=e.useState(!0),[ce,de]=e.useState(!1),[ue,pe]=e.useState(""),[xe,fe]=e.useState(!1),[he,be]=e.useState(null),[ve,ye]=e.useState(!1),[ge,je]=e.useState(""),[Ne,ke]=e.useState(""),[we,Se]=e.useState(!1),[Ie,De]=e.useState(!1),[Pe,Ce]=e.useState(!1),[Oe,Ae]=e.useState(!1),[Re,$e]=e.useState(!1),[Me,Te]=e.useState(!1),[Ee,_e]=e.useState(!1),[Fe,Be]=e.useState(!1),[Ue,Ye]=e.useState(""),[We,Le]=e.useState(""),[qe,Ve]=e.useState(""),[ze,He]=e.useState(!1),[Ke,Je]=e.useState(!1),[Ge,Ze]=e.useState(""),[Qe,Xe]=e.useState(!1);null==m||m.userId;const et=g(),[tt,st]=e.useState(!1),[rt,nt]=e.useState([]),[at,ot]=e.useState(!1),[lt,it]=e.useState(""),[ct,dt]=e.useState(null),[ut,pt]=e.useState((null==m?void 0:m.vendorName)||"Your Vendor Name"),[mt,xt]=e.useState(null),[ft,ht]=e.useState({accountName:"",accountNumber:"",bankName:""}),[bt,vt]=e.useState(!1);e.useEffect((()=>{o&&m&&(async()=>{if(!m.vendorName&&m.vendorId){const e=s(r,"vendors",m.vendorId),t=await n(e);if(t.exists()){const e=t.data().shopName||"Unknown Vendor";pt(e)}}else m.vendorName&&pt(m.vendorName)})()}),[o,m]),e.useEffect((()=>{o&&m&&(async()=>{var e,t,a,o;const l={},i={};for(const c of m.cartItems){const t=s(r,"products",c.productId),a=await n(t);if(a.exists()){const t=a.data();if(c.subProductId){const s=null==(e=t.subProducts)?void 0:e.find((e=>e.subProductId===c.subProductId));s&&(l[c.subProductId]=s.images[0],i[c.subProductId]={name:t.name,price:t.price,color:s.color,size:s.size})}else c.variantAttributes?(l[c.productId]=t.imageUrls[0],i[c.productId]={name:t.name,price:t.price,color:c.variantAttributes.color,size:c.variantAttributes.size}):(l[c.productId]=t.imageUrls[0],i[c.productId]={name:t.name,price:t.price})}}if(J(l),Z(i),m.vendorId){const e=s(r,"vendors",m.vendorId),l=await n(e);if(l.exists()){const e=l.data();ne(e.deliveryMode||"Not Specified"),dt(e.deliveryPreference||null),ht({accountName:(null==(t=null==e?void 0:e.bankDetails)?void 0:t.accountName)||"",accountNumber:(null==(a=null==e?void 0:e.bankDetails)?void 0:a.accountNumber)||"",bankName:(null==(o=null==e?void 0:e.bankDetails)?void 0:o.bankName)||""}),!m.vendorName&&(null==e?void 0:e.shopName)&&pt(e.shopName)}}ie(!1)})()}),[o,m]),e.useEffect((()=>{if(m&&m.endDate){const e=setInterval((()=>{const e=m.endDate.toDate?m.endDate.toDate():m.endDate,t=a(),s=a(e).diff(t);be(s>0?s:0)}),1e3);return()=>clearInterval(e)}}),[m]),e.useEffect((()=>{let e=!0;return(async()=>{if(!m)return;if("1"===localStorage.getItem(yt(m)))e&&st(!0);else try{const t=await jt(r,m);e&&st(t),t&&localStorage.setItem(yt(m),"1")}catch{}})(),()=>{e=!1}}),[m]),e.useEffect((()=>{o&&m&&m.isStockpile&&(async()=>{if(m.isStockpile&&m.stockpileDocId){const e=l(r,"orders"),t=m.vendorId&&m.stockpileDocId?L(e,q("vendorId","==",m.vendorId),q("stockpileDocId","==",m.stockpileDocId)):null;if(t){const e=(await V(t)).docs.map((e=>({id:e.id,...e.data()})));e.sort(((e,t)=>e.createdAt.seconds-t.createdAt.seconds)),nt(e)}}})()}),[o,m]);const yt=e=>(null==e?void 0:e.isStockpile)?`smsSent:stockpile:${e.stockpileDocId}`:`smsSent:order:${e.id}`,gt=(e,t)=>(null==t?void 0:t.isStockpile)?s(e,"stockpiles",t.stockpileDocId):s(e,"orders",t.id),jt=async(e,t)=>{var s;const r=gt(e,t),a=await n(r),o=a.exists()?a.data():{};return Boolean(null==(s=null==o?void 0:o.shippingSms)?void 0:s.sent)},Nt=e=>String(e||"").trim().split(/\s+/)[0]||"",kt=e=>{const t=String(e||"").replace(/[^\d]/g,"");return t?t.startsWith("234")?t:t.startsWith("0")?"234"+t.slice(1):t:""},wt=e=>{const t=String(e||"").replace(/\D/g,"");if(!t)return"";let s=t;return s.startsWith("234")&&(s=s.slice(3)),s.startsWith("0")&&(s=s.slice(1)),s},St=async({customerUid:e,phone:t,isStockpile:s=!1,weeks:r=null,orderId:n=null,stockpileId:a=null,storeName:o="My Thrift",shippingFee:l=0,bank:i={accountName:"",accountNumber:"",bankName:""}})=>{const c=wt(t);if(!c||10!==c.length)throw new Error("Invalid phone number");const d=s?(({weeks:e,storeName:t,fee:s,bank:r})=>`Hi! Your ${e?`${e}-week`:""} stockpile from ${t} is ready. Delivery is N${Number(s||0).toLocaleString()}. Kindly pay to ${`${(null==r?void 0:r.bankName)||""} ${(null==r?void 0:r.accountNumber)||""} (${(null==r?void 0:r.accountName)||""})`.trim()} and reply DONE.`)({weeks:r,storeName:o,fee:l,bank:i}):(({orderId:e,storeName:t,fee:s,bank:r})=>`Hi! Your order from ${t} is ready to ship. Delivery will cost N${Number(s||0).toLocaleString()}. Please pay to ${`${(null==r?void 0:r.bankName)||""} ${(null==r?void 0:r.accountNumber)||""} (${(null==r?void 0:r.accountName)||""})`.trim()} and reply DONE.`)({orderId:n,storeName:o,fee:l,bank:i}),u={message:d,receiverNumber:c,receiverId:e},p=(d.slice(0,60),await fetch("https://mythrift-sms.fly.dev/sendMessage",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer 6c6b5c1502a0b86a159661a2ca7d2ba9c03dd7e81e71f2d00b5c065d2ac28af9"},body:JSON.stringify(u)}));if(!p.ok){await p.text().catch((()=>""));throw new Error(`SMS gateway error: ${p.status}`)}return!0},It=(e,t)=>{const s=`https://wa.me/${e}`,r=t?`${s}?text=${encodeURIComponent(t)}`:s;window.open(r,"_blank","noopener,noreferrer")},Dt=()=>{Be(!1)},Pt=rt.reduce(((e,t)=>{if("accepted"!==t.vendorStatus)return e;const s=parseFloat(t.subtotal);return e+(isNaN(s)?0:s)}),0);e.useEffect((()=>{o&&m&&(async()=>{try{if(!(null==m?void 0:m.id))return;const e=s(r,"orders",m.id),t=await n(e);if(!t.exists())return;const a=t.data(),{orderReference:o,vendorId:l}=a;if(!o||!l)return;const i="9cac075ea03553597625b06532dc88a6",c="https://prod.mythriftpayments.site/api/v1".replace(/\/$/,"")+`/transaction-percentages?vendorId=${encodeURIComponent(l)}&orderReference=${encodeURIComponent(o)}`,d=await fetch(c.toString(),{method:"GET",headers:{Authorization:`Bearer ${i}`}}),u=await d.text();let p;try{p=JSON.parse(u)}catch{p=u}if(!d.ok)return;if(!p||!0!==p.status||!p.data)return;const{"forty-percent":x,"sixty-percent":f}=p.data;xt({vendor40Pay:x,vendor60Pay:f})}catch(e){}})()}),[o,m,r]);const Ct=!!(null==m?void 0:m.endDate)&&0===he,{openChat:Ot}=j();if(!m)return null;const At=m.isStockpile&&"Pending"===m.progressStatus,{userInfo:Rt,cartItems:$t,progressStatus:Mt,note:Tt,createdAt:Et,subtotal:_t,riderInfo:Ft={}}=m,Bt="self"===(ct||"").toLowerCase(),Ut="In Progress"===Mt,Yt=(Bt||m.isPickup)&&(!m.isStockpile||Ct);return t.jsx(c,{isOpen:o,onRequestClose:i,contentLabel:"Order Details",ariaHideApp:!1,className:"modal-content-order",overlayClassName:"modal-overlay",children:t.jsxs("div",{className:"relative h-full pb-12 px-3 overflow-y-auto space-y-4",children:[t.jsxs("div",{className:"sticky -top-1 bg-white z-10 py-4 flex justify-between items-center",children:[t.jsx(N,{className:"text-2xl cursor-pointer",onClick:i}),t.jsx("h1",{className:"font-opensans text-black font-semibold text-base",children:m.isStockpile?"Stockpile Details":"Order Details"}),t.jsxs("div",{className:"flex items-center gap-3",children:[Yt&&t.jsx("button",{type:"button",title:"Message on WhatsApp",onClick:()=>{if(!Ut)return void x.error("WhatsApp message is only available when order is In Progress");if(!(null==Rt?void 0:Rt.phoneNumber))return void x.error("Missing customer phone number");const e=kt(Rt.phoneNumber);e?m.isPickup?It(e):Je(!0):x.error("Invalid customer phone number")},disabled:!Ut,className:"p-1 rounded "+(Ut?"hover:bg-green-50 active:scale-[.98]":"opacity-50 cursor-not-allowed"),children:t.jsx(k,{className:"text-green-600 text-2xl"})}),"Declined"===Mt?t.jsx(te,{className:"text-xl text-customRichBrown cursor-pointer",onClick:()=>{Xe(!0)}}):t.jsx(w,{className:"text-xl cursor-pointer "+("Delivered"===Mt?"opacity-50 cursor-not-allowed":""),onClick:()=>{"Pending"===Mt||"Shipped"===Mt||"In Progress"===Mt?vt(!0):"Delivered"===Mt&&x.error("Cannot call, order is already delivered")}})]})]}),t.jsxs(c,{isOpen:bt,onRequestClose:()=>vt(!1),contentLabel:"Call Confirmation",ariaHideApp:!1,className:"modal-content-reason",overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(S,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Call Confirmation"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>vt(!1)})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"As you prepare to speak with a potential customer, remember to be friendly and approachable. You can call them to:"}),t.jsxs("div",{className:"text-xs text-gray-700 font-opensans mb-6 space-y-4",children:[t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold font-opensans text-sm text-black",children:"1. Confirm their Order:"}),t.jsx("p",{className:"font-opensans text-xs",children:"Ensure they are aware of the details of their order and that everything is correct."})]}),t.jsx("hr",{className:"my-2 border-gray-200"}),t.jsxs("div",{children:[t.jsx("p",{className:"font-semibold font-opensans text-sm text-black",children:"2. Notify them about Order Status:"}),t.jsx("p",{className:"font-opensans text-xs",children:"Provide updates on their order status to keep them informed and engaged."})]})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"Always maintain a polite tone throughout the conversation, as this reflects our commitment to excellent customer service. Please adhere to our communication guidelines to create a positive experience for our customers."}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>{vt(!1),window.open(`tel:${Rt.phoneNumber}`,"_self")},className:"bg-customOrange text-white font-opensans py-2 px-8 rounded-full",children:"Proceed"})})]}),t.jsxs(c,{isOpen:Ke,onRequestClose:()=>Je(!1),contentLabel:"Send WhatsApp Message",ariaHideApp:!1,className:"w-full h-[75vh] rounded-t-xl px-4 py-6 bg-white fixed bottom-0",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(k,{className:"text-green-600"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:m.isStockpile?"Send Stockpile Ready Message":"Send Shipping Invoice"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>Je(!1)})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-opensans font-semibold text-black mb-1",children:"Store Name"}),t.jsx("input",{type:"text",className:"w-full p-2 border text-base font-opensans h-10 rounded bg-gray-100 cursor-not-allowed",value:ut||"",readOnly:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block font-semibold text-xs font-opensans text-black mb-1",children:"Shipping Fee (â‚¦)"}),t.jsx("input",{type:"number",inputMode:"numeric",placeholder:"Enter delivery fee",value:lt,onChange:e=>it(e.target.value.replace(/[^\d]/g,"")),className:"w-full p-2 border text-base font-opensans h-10 rounded focus:outline-none"})]}),t.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[t.jsxs("div",{children:[t.jsx("label",{className:"block font-semibold text-xs font-opensans text-black mb-1",children:"Account Name"}),t.jsx("input",{type:"text",value:ft.accountName,onChange:e=>ht((t=>({...t,accountName:e.target.value}))),className:"w-full p-2 border text-base font-opensans h-10 rounded focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-semibold font-opensans text-black mb-1",children:"Account Number"}),t.jsx("input",{type:"text",value:ft.accountNumber,onChange:e=>ht((t=>({...t,accountNumber:e.target.value.replace(/[^\d]/g,"")}))),maxLength:12,className:"w-full p-2 border text-base font-opensans h-10 rounded focus:outline-none"})]}),t.jsxs("div",{children:[t.jsx("label",{className:"block text-xs font-semibold font-opensans text-black mb-1",children:"Bank Name"}),t.jsx("input",{type:"text",value:ft.bankName,onChange:e=>ht((t=>({...t,bankName:e.target.value}))),className:"w-full p-2 border text-base font-opensans h-10 rounded focus:outline-none"})]})]})]}),t.jsxs("div",{className:"flex flex-col items-center   justify-center",children:[t.jsx("button",{onClick:()=>{if(!(null==Rt?void 0:Rt.phoneNumber))return void x.error("Missing customer phone number");if(!lt)return void x.error("Enter a shipping fee");const e=kt(Rt.phoneNumber);if(!e)return void x.error("Invalid customer phone number");const t=m.isStockpile?(({customerName:e,weeks:t,stockpileId:s,storeName:r,shippingFee:n,bank:a})=>[`Hello ${Nt(e)||"there"},`,"",`Your stockpile of ${t} weeks is up.`,`Stockpile ID: ${s}`,"","",`The delivery fee is â‚¦${Number(n||0).toLocaleString()}.`,"","PAYMENT DETAILS",` Account Name: ${(null==a?void 0:a.accountName)||""}`,` Account Number: ${(null==a?void 0:a.accountNumber)||""}`,` Bank: ${(null==a?void 0:a.bankName)||""}`,"",'Once payment is made, kindly reply "DONE" and share your receipt for confirmation.',"","Thank you for shopping with My Thrift ðŸ§¡"].join("\n"))({customerName:null==Rt?void 0:Rt.displayName,weeks:m.stockpileDuration||"â€”",stockpileId:m.stockpileDocId,storeName:ut||"Your Store",shippingFee:lt,bank:ft,addressOnFile:(null==Rt?void 0:Rt.address)||""}):(({customerName:e,orderId:t,storeName:s,shippingFee:r,bank:n})=>[`Hello ${Nt(e)||"there"},`,"",`Your order on My Thrift (Order ID: ${t}) is ready to be shipped from ${s}.`,"",`The delivery fee to your location is â‚¦${Number(r||0).toLocaleString()}.`,"","PAYMENT DETAILS ",` Account Name: ${n.accountName}`,` Account Number: ${n.accountNumber}`,` Bank: ${n.bankName}`,"","",'Once payment is made, kindly reply "DONE" here and share your receipt for confirmation.',"","Thank you for shopping with My Thrift ðŸ§¡"].join("\n"))({customerName:null==Rt?void 0:Rt.displayName,orderId:m.id,storeName:ut||"Your Store",shippingFee:lt,bank:ft});It(e,t),Je(!1),it("")},className:"bg-green-600 text-sm mt-6 text-white font-opensans py-2 font-semibold px-8 rounded-full",children:"Send via WhatsApp"}),t.jsx("button",{type:"button",disabled:at||tt,onClick:async()=>{if(!(null==Rt?void 0:Rt.phoneNumber))return void x.error("Missing customer phone number");const e=Number(lt||0);if(e)if(tt)x.error("SMS already sent for this "+(m.isStockpile?"stockpile":"order"));else{try{if(await jt(r,m))return localStorage.setItem(yt(m),"1"),st(!0),void x.error("SMS already sent for this "+(m.isStockpile?"stockpile":"order"))}catch{}ot(!0);try{await St({customerUid:m.userId,phone:Rt.phoneNumber,isStockpile:Boolean(m.isStockpile),weeks:m.stockpileDuration||null,orderId:m.id,stockpileId:m.stockpileDocId||null,storeName:ut||"Your Store",shippingFee:e,bank:{accountName:ft.accountName||"",accountNumber:ft.accountNumber||"",bankName:ft.bankName||""}});const s=wt(Rt.phoneNumber);try{await(async(e,t,{toNumber:s})=>{const r=gt(e,t);await z(r,{shippingSms:{sent:!0,sentAt:H(),to:s||null,orderId:t.id||null,stockpileId:t.stockpileDocId||null,byVendor:t.vendorId||null}})})(r,m,{toNumber:s})}catch(t){}localStorage.setItem(yt(m),"1"),st(!0),x.success("SMS sent"),Je(!1),it("")}catch(t){x.error((null==t?void 0:t.message)||"Failed to send SMS")}finally{ot(!1)}}else x.error("Enter a shipping fee")},className:"text-[10px]  mt-3 font-opensans underline text-gray-600 flex justify-center hover:text-gray-800 disabled:opacity-50",children:tt?"SMS already sent":at?"Sending SMSâ€¦":"Number not on WhatsApp? Send SMS"})]})]}),t.jsxs("div",{className:"border border-black rounded-lg py-4 px-3",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(I,{className:"text-customRichBrown"})}),t.jsx("p",{className:"text-sm font-opensans font-medium text-customRichBrown",children:"Declined"===Mt?"Decline Reason":"Customer Details"})]}),t.jsx("div",{className:"space-y-4",children:"Declined"===Mt?t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(D,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:m.declineReason||"No reason provided"})]}):t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(P,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Name:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:le?t.jsx(C,{width:100}):(null==Rt?void 0:Rt.displayName)||"Unknown User"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(O,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Email:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow "+("Delivered"===Mt?"blur-sm":""),children:le?t.jsx(C,{width:150}):Rt.email||"Not Available"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(w,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Phone:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow "+("Delivered"===Mt?"blur-sm":""),children:le?t.jsx(C,{width:120}):Rt.phoneNumber||"Not Available"})]}),!(m.isPickup||"platform"===(ct||"").toLowerCase())&&t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(A,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Location:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow "+("Delivered"===Mt?"blur-sm":""),children:le?t.jsx(C,{width:200}):Rt.address||"Not Available"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(R,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:m.isStockpile?"Stockpile ID:":"Order ID:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:m.isStockpile?m.stockpileDocId:m.id})]}),m.isStockpile&&m.stockpileDuration&&"Pending"!==m.progressStatus&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx($,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Duration:"}),t.jsxs("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:[m.stockpileDuration||"Not Available"," weeks"]})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(M,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Start Date:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:m.startDate?a(m.startDate.toDate()).format("DD/MM/YYYY"):"Not Available"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(M,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"End Date:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:m.endDate?a(m.endDate.toDate()).format("DD/MM/YYYY"):"Not Available"})]})]}),Tt&&t.jsxs("div",{className:"flex items-start space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(D,{className:"text-gray-500 text-xl mt-1"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Note:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:Tt})]})]})})]}),!m.isPickup&&("Shipped"===m.progressStatus||"Delivered"===m.progressStatus)&&t.jsxs("div",{className:"border border-black rounded-lg py-4 px-3 mt-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-3",children:[t.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(d,{className:"text-customRichBrown"})}),t.jsx("p",{className:"text-sm font-opensans font-medium text-customRichBrown",children:"Rider Details"})]}),t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(P,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Rider Name:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:(null==Ft?void 0:Ft.riderName)||"Not Available"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(w,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Rider Phone:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:(null==Ft?void 0:Ft.riderNumber)||"Not Available"})]}),t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(D,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"text-gray-500 text-sm font-opensans",children:"Note:"}),t.jsx("p",{className:"ml-6 font-opensans text-black text-sm flex-grow",children:(null==Ft?void 0:Ft.note)||"None"})]})]})]}),t.jsx("div",{className:"bg-white rounded-lg space-y-6",children:$t.map(((e,s)=>{var r,n,o,l,i,c;return t.jsxs("div",{className:"text-sm text-gray-700 mb-4",children:[le?t.jsx(C,{height:240}):K[e.subProductId||e.productId]&&t.jsx("img",{src:K[e.subProductId||e.productId],alt:"Product Image",className:"w-full h-60 p-1 border-opacity-45 border-dashed border-customBrown border-2 object-cover rounded mb-4"}),t.jsxs("div",{className:"border border-black rounded-lg py-4 px-3",children:[t.jsxs("div",{className:"flex items-center mb-4",children:[t.jsx("div",{className:"w-8 h-8 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(T,{className:"text-customRichBrown text-xl"})}),t.jsxs("p",{className:"ml-2 text-base font-opensans font-medium text-customRichBrown",children:["Product ",s+1]})]}),t.jsxs("div",{className:"space-y-3 mt-4",children:[t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(T,{className:"text-orange-700 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Product Name:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm flex-grow",children:le?t.jsx(C,{width:100}):(null==(r=G[e.subProductId||e.productId])?void 0:r.name)||"Unknown Product"})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(E,{className:"text-green-500 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Price:"}),t.jsx("p",{className:"ml-10 font-opensans bg-green-100 px-2 h-6 text-black text-sm flex justify-center items-center rounded-md",children:le?t.jsx(C,{width:60}):`â‚¦${(null==(n=G[e.subProductId||e.productId])?void 0:n.price.toLocaleString())||"N/A"}`})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(_,{className:"text-blue-800 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Quantity:"}),t.jsx("p",{className:"ml-10 font-opensans bg-blue-100 px-2 h-6 rounded-md text-black text-sm flex justify-center items-center",children:le?t.jsx(C,{width:20}):e.quantity})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(F,{className:"text-orange-700 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Color:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm flex-grow",children:le?t.jsx(C,{width:80}):(null==(o=G[e.subProductId])?void 0:o.color)||(null==(l=e.variantAttributes)?void 0:l.color)||"N/A"})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(se,{className:"text-blue-800 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Size:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm flex-grow",children:le?t.jsx(C,{width:50}):(null==(i=G[e.subProductId])?void 0:i.size)||(null==(c=e.variantAttributes)?void 0:c.size)||"N/A"})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(M,{className:"text-indigo-700 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Status:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm",children:t.jsx("span",{className:""+("Pending"===m.progressStatus?"text-black px-2 bg-yellow-100 h-6 rounded-md flex justify-center items-center":"In Progress"===m.progressStatus?"text-black px-2 bg-blue-100 h-6 rounded-md flex justify-center items-center":"Shipped"===m.progressStatus?"text-black px-2 bg-green-100 h-6 rounded-md flex justify-center items-center":"Delivered"===m.progressStatus?"text-white px-2 bg-green-600 h-6 rounded-md flex justify-center items-center":"text-black px-2 bg-red-100 h-6 rounded-md flex justify-center items-center"),children:le?t.jsx(C,{width:50}):t.jsxs(t.Fragment,{children:["Delivered"===m.progressStatus&&t.jsx(B,{className:"mr-1 text-yellow-300"}),m.progressStatus]})})})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(d,{className:"text-orange-700 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Delivery Mode:"}),t.jsx("p",{className:"ml-4 font-opensans text-black text-sm flex-grow",children:le?t.jsx(C,{width:100}):m.isPickup?"Pick-up":m.isStockpile?m.isActive?"Delivery when stockpile has ended":"Delivery":"platform"===ct?"Delivery handled by My Thrift logistics partners":"self"===ct?"Delivery handled by you":m.deliveryInfo?`${Q} with Kwik Logistics`:Q||"Not Specified"})]}),m.isStockpile&&t.jsxs(t.Fragment,{children:[t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(R,{className:"text-gray-500 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Order ID:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm flex-grow",children:e._orderId||m.id})]}),t.jsxs("div",{className:"flex items-center pb-3 border-b border-gray-100",children:[t.jsx(M,{className:"text-indigo-700 text-xl"}),t.jsx("p",{className:"ml-3 text-gray-500 text-sm font-opensans",children:"Created At:"}),t.jsx("p",{className:"ml-10 font-opensans text-black text-sm flex-grow",children:e._orderCreatedAt?a(e._orderCreatedAt.toDate()).format("MMMM DD [at] hh:mm A"):a(1e3*m.createdAt.seconds).format("MMMM DD [at] hh:mm A")})]})]})]})]})]},s)}))}),!(m.isStockpile||m.stockpileDuration)&&t.jsxs("div",{className:"border border-black rounded-lg py-4 px-3",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(U,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base text-customRichBrown font-semibold",children:"Balance"})]}),(()=>{var e;const s=null==(e=Rt.rewardType)?void 0:e.match(/^DISCOUNT_(\d{1,2})$/),r=s?Number(s[1]):null;return r&&r>=5&&r<=50?t.jsxs("div",{className:"flex items-center space-x-2 pb-2 border-b border-gray-100",children:[t.jsx(Y,{className:"text-green-500 text-3xl"}),t.jsxs("p",{className:"ml-6 font-opensans text-black text-xs flex-grow",children:["There's an active ",r,"% order discount! Dont worry Weâ€™ll credit your wallet the full payment for these item(s)."]})]}):null})(),t.jsxs("div",{className:"space-y-2 mt-3",children:[t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-green-300 text-lg"}),t.jsx("p",{className:"font-opensans text-xs text-gray-700",children:"Subtotal:"})]}),t.jsxs("p",{className:"font-opensans text-xs font-semibold text-gray-700",children:["â‚¦",Number(_t||0).toLocaleString()]})]}),t.jsxs("div",{className:"flex items-start gap-2 rounded-md bg-green-50 border border-green-200 p-3",children:[t.jsx(te,{className:"text-green-700 text-lg shrink-0"}),t.jsxs("p",{className:"text-[9px] leading-1 text-green-900 font-opensans",children:["We pay out ",t.jsx("span",{className:"font-semibold",children:"100% of orders immediately to your wallet"})," â€” no hold of funds. To protect customers, if an order is delayed for a long period of time or thereâ€™s an anomaly (e.g., non-delivery, item not as described, or fraud indicators), we may intervene and take appropriate actions on the order after review."]})]})]})]}),m.isStockpile&&m.stockpileDuration&&t.jsxs("div",{className:"border border-black rounded-lg py-4 px-3 mt-4",children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(U,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base text-customRichBrown font-semibold",children:"Stockpile value"})]}),!At&&t.jsx("div",{className:"space-y-2 mt-3",children:t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-green-300 text-lg"}),t.jsx("p",{className:"font-opensans text-xs text-gray-700",children:"Subtotal:"})]}),t.jsxs("p",{className:"font-opensans text-xs font-semibold text-gray-700",children:["â‚¦",Number(Pt).toLocaleString()]})]})}),At&&t.jsx("div",{className:"space-y-2 mt-3",children:t.jsxs("div",{className:"flex items-center justify-between border-b border-gray-100 pb-2",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(W,{className:"text-green-300 text-lg"}),t.jsx("p",{className:"font-opensans text-xs text-gray-700",children:"Subtotal:"})]}),t.jsxs("p",{className:"font-opensans text-xs font-semibold text-gray-700",children:["â‚¦",Number(m.subtotal||0).toLocaleString()]})]})})]}),m.isStockpile&&"In Progress"===m.progressStatus&&t.jsxs("div",{className:"flex flex-col items-center mt-4",children:[!(m.requestedForShipping||!m.isActive||Ct)&&t.jsxs("div",{className:"mb-2 bg-gray-200 text-gray-700 text-[10px] px-3 py-1 rounded-full font-opensans",children:["available in ",(()=>{if(null===he||0===he)return"";const e=a.duration(he);return`${e.days()}d ${e.hours()}h ${e.minutes()}m ${e.seconds()}s`})()]}),t.jsx("button",{onClick:()=>Be(!0),className:"font-opensans px-16 py-2 text-base rounded-full transition-opacity duration-300\n        "+(m.requestedForShipping||!m.isActive||Ct?"bg-customOrange text-white":"bg-gray-300 text-gray-500 cursor-not-allowed"),disabled:!(m.requestedForShipping||!m.isActive||Ct),children:"Move to Shipping"})]}),m.isPickup&&t.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border-l-4 font-opensans text-xs border-yellow-400 text-yellow-800  rounded",children:[t.jsx("span",{className:"font-semibold",children:"Pickup PIN Required:"}),"This order can only be marked as delivered once the customer provides their unique PIN. Always verify the code before handing over items."]}),t.jsx("div",{className:"flex justify-between mt-4",children:"Pending"===m.progressStatus&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>de(!0),className:"bg-transparent font-medium text-customOrange text-sm font-opensans py-2.5 px-14 rounded-full border-customBrown border",children:Re?t.jsx(p,{strokeColor:"orange",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Decline"}),t.jsx("button",{onClick:async()=>{var e,t,a,o,l,c;fe(!0);try{const d=s(r,"orders",m.id),u=await n(d);if(!u.exists())return void x.error("Order not found");const p=u.data(),b=f(h,"acceptVendorOrder"),v=await b({orderId:m.id}),{alreadyAccepted:y,vendor60Pay:g,isStockpile:j,stockpileDuration:N}=v.data||{};if(y)return x.success("Order already accepted âœ…"),void i();let k=null,w=null;const S=await n(s(r,"vendors",m.vendorId));if(S.exists()&&(k=S.data().coverImageUrl||null),null==(e=m.cartItems)?void 0:e.length){const e=m.cartItems[0],i=await n(s(r,"products",e.productId));if(i.exists()){const s=i.data();w=e.subProductId?(null==(o=null==(a=null==(t=s.subProducts)?void 0:t.find((t=>t.subProductId===e.subProductId)))?void 0:a.images)?void 0:o[0])||null:(null==(l=s.imageUrls)?void 0:l[0])||null}}if(await ae(p.userId,m.id,"In Progress",(null==(c=S.data())?void 0:c.shopName)||"Vendor",k,w,null,null),!j&&g){const e=`â‚¦${Number(g).toLocaleString()}`;await oe(m.vendorId,"Youâ€™ve Been Credited ðŸ’°",`Youâ€™ve received ${e} as the 100% payout for order ID: ${m.id}.`,"transactions")}else j&&await oe(m.vendorId,"Stockpile Payment in Full ðŸ’°",`You have been paid in full for the stockpile order (ID: ${m.id}).`,"transactions");x.success("Order accepted successfully"),i()}catch(d){x.error("Failed to accept the order")}finally{fe(!1)}},className:"text-sm font-medium text-white font-opensans py-2.5 px-14 rounded-full bg-customOrange",disabled:xe,children:xe?t.jsx(p,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Accept"})]})}),t.jsxs("div",{className:"flex justify-between mt-4",children:["Shipped"===Mt&&!m.isStockpile&&t.jsxs(t.Fragment,{children:[t.jsx("button",{onClick:()=>{Ce(!0)},className:"bg-transparent font-medium text-customOrange text-xs font-opensans py-2.5 px-8 rounded-full border-customBrown border",children:"Contact Us"}),t.jsx("button",{onClick:()=>{m.isPickup?ye(!0):De(!0)},className:"text-xs font-medium text-white font-opensans py-2.5 px-8 rounded-full bg-customOrange",disabled:we,children:we?t.jsx(p,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Mark as Delivered"})]}),"Shipped"===Mt&&m.isStockpile&&t.jsx("div",{className:"w-full flex justify-center",children:t.jsx("button",{onClick:()=>De(!0),className:"text-xs font-medium text-white font-opensans py-2.5 px-8 rounded-full bg-customOrange",disabled:we,children:we?t.jsx(p,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Mark Stockpile as Delivered"})})]}),m.isPickup&&ve&&t.jsxs(c,{isOpen:!0,onRequestClose:()=>ye(!1),className:"modal-content-otp bg-white rounded-lg p-6 mt-60 mx-auto w-11/12 max-w-sm",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"mb-4 text-center",children:[t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Enter Pickup PIN"}),t.jsx("p",{className:"text-xs font-opensans text-gray-600 mt-1",children:"Ask the customer for the 4-digit code to enable you mark as delivered."})]}),t.jsx("div",{className:"flex justify-center mb-2",children:t.jsx(me,{length:4,focus:!0,type:"numeric",style:{padding:"10px"},inputStyle:{borderColor:"#ddd",borderRadius:"4px",width:"2.5rem",height:"2.5rem",margin:"0 4px",fontSize:"1.5rem",textAlign:"center"},onChange:e=>{je(e),Ne&&ke("")}})}),Ne&&t.jsx("p",{className:"text-red-500 font-opensans text-xs text-center mb-2",children:Ne}),t.jsx("div",{className:"flex justify-center mt-4",children:t.jsx("button",{onClick:async()=>{if(4===ge.length){Se(!0);try{const e=f(h,"markOrderDelivered");(await e({orderId:m.id,pin:ge})).data.invalidPin?ke("Incorrect PIN, please try again."):(x.success("Order marked as delivered!"),ye(!1),i())}catch(e){x.error("Failed to validate PIN. Try again.")}finally{Se(!1)}}else ke("Please enter the 4-digit code.")},className:"bg-customOrange text-white font-opensans py-2 px-8 rounded-full",disabled:we,children:we?t.jsx(p,{strokeColor:"white",width:"20"}):"Confirm"})})]}),t.jsxs(c,{isOpen:ce,onRequestClose:()=>de(!1),className:"modal-content-reason "+("Other"===ue?"h-auto":"h-[50%]"),overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(b,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Reason for decline"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>de(!1)})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[["Out of stock","Delivery Timing","Can't deliver to Location","Other"].map(((e,s)=>t.jsxs("div",{className:"cursor-pointer flex items-center text-gray-800 mb-1 "+(ue===e?"border-customOrange":"border-gray-200"),onClick:()=>{pe(e),"Other"!==e&&Ze("")},children:[t.jsx("div",{className:"w-5 h-5 rounded-full border-2 flex justify-center items-center mr-3 "+(ue===e?"border-customOrange":"border-customOrange border-opacity-80"),children:ue===e&&t.jsx("div",{className:"w-3 h-3 rounded-full bg-orange-500"})}),t.jsx("span",{className:"font-opensans text-black",children:e})]},s))),"Other"===ue&&t.jsx("input",{type:"text",placeholder:"Other reason...",className:"border px-2 h-20 text-xs rounded w-full",value:Ge,onChange:e=>Ze(e.target.value)})]}),t.jsx("div",{className:"flex justify-end mt-4",children:t.jsx("button",{onClick:()=>{ue&&("Other"!==ue||Ge)?(async()=>{var e,t,a,o,l,c;if(!ue&&""===Ge)return void x.error("Select a reason or type one.");const d="Other"===ue?Ge:ue;$e(!0);try{const u=f(h,"declineVendorOrder"),{data:p}=await u({orderId:m.id,declineReason:d});if(p.alreadyDeclined)return x.success("Order already declined"),void i();const b=await n(s(r,"vendors",m.vendorId)),v=b.exists()?b.data().coverImageUrl??null:null;let y=null;if(null==(e=m.cartItems)?void 0:e.length){const e=m.cartItems[0],i=await n(s(r,"products",e.productId));if(i.exists()){const s=i.data();y=e.subProductId?(null==(o=null==(a=null==(t=s.subProducts)?void 0:t.find((t=>t.subProductId===e.subProductId)))?void 0:a.images)?void 0:o[0])||null:(null==(l=s.imageUrls)?void 0:l[0])||null}}await ae(m.userId,m.id,"Declined",(null==(c=b.data())?void 0:c.shopName)||"Vendor",v,y,d,null),await oe(m.vendorId,"Order Declined ðŸ›‘",`Order with ID: ${m.id} was declined. Reason: ${d}.`,"order"),x.success("Order declined successfully"),i()}catch(u){x.error("Failed to decline the order")}finally{$e(!1)}})():x.error("Please select or enter a reason for decline.")},className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full",disabled:Re,children:Re?t.jsx(p,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Send"})})]}),t.jsxs(c,{isOpen:Fe,onRequestClose:Dt,className:"modal-content-rider h-auto",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(d,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Delivery Details"})]}),t.jsx(u,{className:"text-xl relative -top-2",onClick:Dt})]}),t.jsxs("div",{className:"space-y-3 mb-4",children:[t.jsx("h1",{className:"text-xs font-opensans text-black font-medium",children:"Rider's Name"}),t.jsx("input",{type:"text",placeholder:"Rider's Name",value:Ue,onChange:e=>Ye(e.target.value),className:"w-full p-2 border text-xs rounded h-10 focus:outline-none"}),t.jsx("h1",{className:"text-xs font-opensans text-black font-medium",children:"Rider's Number"}),t.jsx("input",{type:"number",placeholder:"Enter Rider's Phone Number",value:We,onChange:e=>Le(e.target.value.slice(0,11)),className:"w-full p-2 border text-xs h-10 rounded focus:outline-none"}),t.jsx("textarea",{placeholder:"Add a short note here (optional)",value:qe,onChange:e=>Ve(e.target.value),className:"w-full p-2 border text-xs h-20 rounded focus:outline-none"})]}),t.jsx("div",{className:"flex justify-end mt-2",children:t.jsx("button",{onClick:async()=>{Te(!0);try{if(!rt||0===rt.length)throw new Error("No stockpile orders available.");const e=rt[0];for(const n of rt){if("Declined"===n.progressStatus)continue;const t=s(r,"orders",n.id);n.id===e.id?await z(t,{progressStatus:"Shipped",riderInfo:{riderName:Ue,riderNumber:We,note:qe},shippedAt:H()}):await z(t,{progressStatus:"Shipped"})}if(m.stockpileDocId){const e=s(r,"stockpiles",m.stockpileDocId);await z(e,{isActive:!1})}await oe(e.vendorId,"Stockpile Shipped",`Stockpile (ID: ${m.stockpileDocId}) has been shipped. Rider: ${Ue}`,"order");const t=f(h,"notifyUserStockpileUpdate");await t({eventType:"shipping",userEmail:e.userInfo.email,userName:e.userInfo.displayName,orderId:e.id,stockpileDocId:e.stockpileDocId,vendorName:ut,riderInfo:{riderName:Ue,riderNumber:We,note:qe},userPhone:e.userInfo.phoneNumber}),x.success("Stockpile moved to Shipping successfully."),Be(!1),i()}catch(e){x.error("Failed to move stockpile to Shipping.")}finally{Te(!1)}},className:"bg-customOrange text-white font-opensans py-2 px-12 rounded-full flex items-center",disabled:Me||ze,children:Me?t.jsx(p,{strokeColor:"white",width:"20"}):"Send"})})]}),t.jsxs(c,{isOpen:Ie,onRequestClose:()=>De(!1),contentLabel:"Confirm Delivery",ariaHideApp:!1,className:"modal-content-reason",overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(S,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Confirm Delivery"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>De(!1)})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"Please confirm that the order has been successfully delivered to the customer. Here are some points to ensure successful delivery:"}),t.jsxs("ul",{className:"list-disc pl-2 text-xs text-gray-700 font-opensans font-medium space-y-2",children:[t.jsxs("li",{className:"flex",children:[t.jsx(re,{className:"text-green-800 mr-4 text-4xl"})," You have spoken to the rider/logistics company, and they have confirmed that the order has been delivered."]}),t.jsxs("li",{className:"flex ",children:[t.jsx(re,{className:"text-green-800 mr-4 text-4xl"}),"You received delivery confirmation or a signed proof of delivery from the logistics provider."]})]}),t.jsxs("p",{className:"text-xs text-gray-700 font-opensans mt-4",children:["For more details on marking an order as delivered, please refer to our",t.jsx("span",{onClick:()=>{et("/delivery-guidelines")},className:"text-customOrange underline cursor-pointer",children:"Order Delivery Guide"}),"."]}),t.jsxs("div",{className:"flex mt-4 items-center mb-4",children:[t.jsx("input",{type:"checkbox",checked:Oe,onChange:()=>Ae(!Oe),className:"mr-2"}),t.jsx("span",{className:"text-xs font-opensans text-red-500",children:"I confirm that the order has been delivered and accept full responsibility for this action."})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>{m.isStockpile?(async()=>{var e,t,a,o,l;Se(!0);try{const c=f(h,"markStockpileDelivered"),{data:d}=await c({stockpileDocId:m.stockpileDocId});if(d.alreadyDelivered)return x.success("Stockpile already delivered âœ…"),void i();const u=rt.find((e=>e.id===d.primaryOrderId))||rt[0];let p=m.vendorName,b=null;if(!p&&m.vendorId){const e=await n(s(r,"vendors",m.vendorId));if(e.exists()){const t=e.data();p=t.shopName||"Unknown Vendor",b=t.coverImageUrl||null}}let g=null;if(null==(e=u.cartItems)?void 0:e.length){const e=u.cartItems[0],i=await n(s(r,"products",e.productId));if(i.exists()){const s=i.data();g=e.subProductId?(null==(o=null==(a=null==(t=s.subProducts)?void 0:t.find((t=>t.subProductId===e.subProductId)))?void 0:a.images)?void 0:o[0])||null:(null==(l=s.imageUrls)?void 0:l[0])||null}}await ae(d.userId,u.id,"Delivered",p,b,g),await oe(d.vendorId,"Stockpile Delivered ðŸ˜Š","Youâ€™ve marked this entire stockpile as delivered. If this was a mistake, reach out immediately!","order"),localStorage.removeItem(`vendorRevenue_${d.vendorId}`),localStorage.removeItem(`vendorRevenue_time_${d.vendorId}`),v(d.vendorId).then((e=>y(e))).catch((()=>{})),x.success("Stockpile marked as delivered. Congrats!"),i()}catch(c){x.error("Failed to mark stockpile as delivered")}finally{Se(!1),De(!1)}})():(async()=>{var e,t,a,o,l;if(Oe){Se(!0);try{const c=f(h,"markOrderDelivered"),{data:d}=await c({orderId:m.id});if(d.alreadyDelivered)return x.success("Order is already delivered âœ…"),void i();let u=m.vendorName,p=null,b=!1;if(!u&&m.vendorId){const e=await n(s(r,"vendors",m.vendorId));if(e.exists()){const t=e.data();u=t.shopName||"Unknown Vendor",p=t.coverImageUrl||null,b="platform"===(t.deliveryPreference||"").toLowerCase()}}let g=null;if(null==(e=m.cartItems)?void 0:e.length){const e=m.cartItems[0],i=await n(s(r,"products",e.productId));if(i.exists()){const s=i.data();g=e.subProductId?(null==(o=null==(a=null==(t=s.subProducts)?void 0:t.find((t=>t.subProductId===e.subProductId)))?void 0:a.images)?void 0:o[0])||null:(null==(l=s.imageUrls)?void 0:l[0])||null}}m.kwikJob||await ae(m.userId,m.id,"Delivered",u,p,g),await oe(m.vendorId,"Order Delivered ðŸ˜Š","You marked this order as delivered.","order"),localStorage.removeItem(`vendorRevenue_${m.vendorId}`),localStorage.removeItem(`vendorRevenue_time_${m.vendorId}`),v(m.vendorId).then(y).catch((()=>{})),x.success("Order marked as delivered!"),i()}catch(c){x.error("Failed to mark as delivered. Please try again.")}finally{Se(!1),De(!1)}}})()},className:"bg-customOrange text-white font-opensans py-2 px-8 rounded-full",disabled:!Oe||we,children:we?t.jsx(p,{strokeColor:"white",strokeWidth:"5",animationDuration:"0.75",width:"20",visible:!0}):"Confirm"})})]}),t.jsxs(c,{isOpen:Qe,onRequestClose:()=>Xe(!1),contentLabel:"Decline Info",ariaHideApp:!1,className:"modal-content-reason",overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(X,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Declined Order"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>Xe(!1)})]}),t.jsx("div",{children:t.jsx("p",{className:"font-opensans text-sm text-black font-medium",children:"Order was declined by you (Vendor). This process cannot be reversed!"})})]}),t.jsxs(c,{isOpen:Ee,onRequestClose:()=>_e(!1),contentLabel:"About Charges",ariaHideApp:!1,className:"modal-content-charge",overlayClassName:"modal-overlay backdrop-blur-sm",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(ee,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"About Charges"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>_e(!1)})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"Please note that the charges reflected in the total amount after tax are incurred due to processing fees from our payment partners (Paystack). If you have any questions or concerns, please contact support. My Thrift does not take any percentage from your stipend."}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>_e(!1),className:"bg-customOrange text-white font-opensans py-1.5 text-xs px-6 rounded-full",children:"I Understand"})})]}),t.jsxs(c,{isOpen:Pe,onRequestClose:()=>Ce(!1),contentLabel:"Contact Support",ariaHideApp:!1,className:"modal-content-reason",overlayClassName:"modal-overlay",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("div",{className:"w-7 h-7 bg-rose-100 flex justify-center items-center rounded-full",children:t.jsx(S,{className:"text-customRichBrown"})}),t.jsx("h2",{className:"font-opensans text-base font-semibold",children:"Contact Support"})]}),t.jsx(u,{className:"text-black text-xl cursor-pointer",onClick:()=>Ce(!1)})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"If you are facing issues with this order, please contact us. Recommended reasons to call:"}),t.jsxs("ul",{className:"text-xs text-gray-700 font-opensans mb-6 list-disc pl-5 space-y-1",children:[t.jsx("li",{children:"- Order mishandling or damage."}),t.jsx("li",{children:"- Rider missing or unresponsive."}),t.jsx("li",{children:"- Issues with the delivery location."}),t.jsx("li",{children:"- Delivery delayed beyond the expected timeframe."})]}),t.jsx("p",{className:"text-xs text-gray-700 font-opensans mb-6",children:"Need help? Start a live chat with our support team."}),t.jsx("div",{className:"flex justify-end",children:t.jsx("button",{onClick:()=>{Ot(),Ce(!1)},className:"bg-customOrange text-white font-opensans py-2 px-8 rounded-full",children:"Chat Now"})})]})]})})},fe=()=>{const{currentUser:s}=K(),[r,n]=e.useState("Pending"),[a,o]=e.useState(!1),[l,i]=e.useState(null),[c,d]=e.useState(0),u=J((e=>{var t;return null==(t=e.orders)?void 0:t.orders})),p=null==u,m=e.useMemo((()=>{if(!u||!(null==s?void 0:s.uid))return[];let e=[];return e="Stockpiles"===r?u.filter((e=>!0===e.isStockpile&&e.vendorId===s.uid&&"accepted"===e.vendorStatus)):"Shipped"===r?u.filter((e=>!e.isStockpile&&["Shipped","Delivered"].includes(e.progressStatus))):u.filter((e=>e.progressStatus===r)),e.sort(((e,t)=>{var s,r,n,a;const o=(null==(r=null==(s=e.createdAt)?void 0:s.toMillis)?void 0:r.call(s))||0;return((null==(a=null==(n=t.createdAt)?void 0:n.toMillis)?void 0:a.call(n))||0)-o}))}),[u,r,null==s?void 0:s.uid]),x=e=>{i(e),o(!0)};return t.jsxs(t.Fragment,{children:[t.jsx(G,{title:"Vendor Orders - My Thrift",description:"Orders on your My Thrift store",url:"https://www.shopmythrift.store/vendor-orders"}),t.jsxs("div",{className:"p-3 bg-white min-h-screen flex flex-col items-center",children:[t.jsx(Z,{}),t.jsxs("div",{className:"bg-customDeepOrange rounded-xl w-full h-28 text-center mb-4 flex items-center justify-center relative",children:[t.jsx("div",{className:"absolute top-0 right-0",children:t.jsx("img",{src:"./Vector.png",alt:"icon",className:"w-16 h-20"})}),t.jsxs("div",{className:"flex flex-col",children:[t.jsxs("h1",{className:"font-opensans font-normal text-white text-sm capitalize",children:[r," Orders"]}),t.jsx("p",{className:"text-4xl font-opensans font-semibold text-white mt-2",children:m.length})]})]}),t.jsx("div",{className:"tabs flex flex-wrap justify-center gap-5 mb-1",children:["Pending","Stockpiles","In Progress","Shipped","Declined"].map((e=>t.jsxs("button",{onClick:()=>n(e),className:"relative pb-2 text-xs font-normal font-opensans "+(r===e?"border-b-2 border-customDeepOrange text-customDeepOrange":"text-gray-500"),children:[e,"Stockpiles"===e&&t.jsx("span",{className:"absolute -top-2.5 -right-4 bg-customOrange text-[10px] text-white px-1 rounded-md font-bold",children:"Beta"})]},e)))}),t.jsx("div",{className:"orders-list pb-16 w-full px-4 space-y-3 text-center",children:p?t.jsx(C,{count:2,height:60,className:"mb-4"}):m.length>0?"Pending"===r?t.jsx(ne,{orders:m,openModal:x}):"Stockpiles"===r?t.jsx(de,{orders:m,openModal:e=>{i(e),o(!0)}}):"In Progress"===r?t.jsx(le,{orders:m,openModal:x}):"Shipped"===r?t.jsx(ie,{orders:m,openModal:x}):t.jsx(ce,{orders:m,openModal:x}):t.jsx("div",{className:"text-gray-500 text-sm mt-6",children:(()=>{switch(r){case"Pending":return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"ðŸ“¦ No pending orders at the moment. Keep an eye here â€“ your next sale could be just around the corner!"});case"Stockpiles":return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"ðŸ“¦ No stockpile orders yet. Encourage customers to stockpile, support eco friendly fashionðŸŒ´."});case"In Progress":return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"ðŸš§ All caught up! No orders in progress right now."});case"Shipped":return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"ðŸ“¦ No shipped or delivered orders to track currently. Your fulfilled orders will show here."});case"Declined":return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"ðŸ™ No declined orders in the list. Keep providing great service!"});default:return t.jsx("div",{className:"text-center translate-y-20 text-gray-700 text-xs font-normal font-opensans",children:"No orders found."})}})()})}),t.jsx(xe,{isOpen:a,onClose:()=>{i(null),o(!1)},order:l,fetchVendorRevenue:async e=>{try{const t="9cac075ea03553597625b06532dc88a6",s="https://prod.mythriftpayments.site/api/v1",r=await fetch(`${s}/vendorRevenue/${e}`,{method:"GET",headers:{Authorization:`Bearer ${t}`,Accept:"application/json"}});if(!r.ok)throw new Error("Failed to fetch vendor revenue");const n=await r.json();return d(n.revenue),n.revenue}catch(t){throw t}},setTotalRevenue:d})]})]})};export{fe as default};
